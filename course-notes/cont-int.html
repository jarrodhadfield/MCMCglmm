<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Continuous Random Interactions | MCMCglmm Course Notes</title>
  <meta name="description" content="Extended documentation and course notes for the MCMCglmm R package." />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Continuous Random Interactions | MCMCglmm Course Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Extended documentation and course notes for the MCMCglmm R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Continuous Random Interactions | MCMCglmm Course Notes" />
  
  <meta name="twitter:description" content="Extended documentation and course notes for the MCMCglmm R package." />
  

<meta name="author" content="Jarrod Hadfield" />


<meta name="date" content="2026-01-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cat-int.html"/>
<link rel="next" href="multi.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/rglWebGL-binding-1.3.31/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.3.31/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.3.31/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/utils.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/buffer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/shaders.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/shadersrc.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/textures.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/projection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/mouse.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/init.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/pieces.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/draw.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/controls.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/selection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/rglTimer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/pretty.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/axes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/animation.src.js"></script>
<script src="libs/CanvasMatrix4-1.3.31/CanvasMatrix.src.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bayesian.html"><a href="bayesian.html"><i class="fa fa-check"></i><b>2</b> Bayesian Analysis and MCMC</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian.html"><a href="bayesian.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="bayesian.html"><a href="bayesian.html#likelihood"><i class="fa fa-check"></i><b>2.2</b> Likelihood</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bayesian.html"><a href="bayesian.html#maximum-likelihood-ml"><i class="fa fa-check"></i><b>2.2.1</b> Maximum Likelihood (ML)</a></li>
<li class="chapter" data-level="2.2.2" data-path="bayesian.html"><a href="bayesian.html#restricted-maximum-likelihood-reml"><i class="fa fa-check"></i><b>2.2.2</b> Restricted Maximum Likelihood (REML)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bayesian.html"><a href="bayesian.html#prior-distribution"><i class="fa fa-check"></i><b>2.3</b> Prior Distribution</a></li>
<li class="chapter" data-level="2.4" data-path="bayesian.html"><a href="bayesian.html#posterior-distribution"><i class="fa fa-check"></i><b>2.4</b> Posterior Distribution</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="bayesian.html"><a href="bayesian.html#marginal-posterior-distribution"><i class="fa fa-check"></i><b>2.4.1</b> Marginal Posterior Distribution</a></li>
<li class="chapter" data-level="2.4.2" data-path="bayesian.html"><a href="bayesian.html#intervals-sec"><i class="fa fa-check"></i><b>2.4.2</b> Credible Intervals</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="bayesian.html"><a href="bayesian.html#MCMC"><i class="fa fa-check"></i><b>2.5</b> MCMC</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="bayesian.html"><a href="bayesian.html#starting-values"><i class="fa fa-check"></i><b>2.5.1</b> Starting values</a></li>
<li class="chapter" data-level="2.5.2" data-path="bayesian.html"><a href="bayesian.html#metropolis-hastings-updates"><i class="fa fa-check"></i><b>2.5.2</b> Metropolis-Hastings updates</a></li>
<li class="chapter" data-level="2.5.3" data-path="bayesian.html"><a href="bayesian.html#gibbs-sampling"><i class="fa fa-check"></i><b>2.5.3</b> Gibbs Sampling</a></li>
<li class="chapter" data-level="2.5.4" data-path="bayesian.html"><a href="bayesian.html#diagnostics-sec"><i class="fa fa-check"></i><b>2.5.4</b> MCMC Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="bayesian.html"><a href="bayesian.html#Vprior-sec"><i class="fa fa-check"></i><b>2.6</b> Priors for Residual Variances</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="bayesian.html"><a href="bayesian.html#IP-sec"><i class="fa fa-check"></i><b>2.6.1</b> Improper Priors</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="bayesian.html"><a href="bayesian.html#transform-sec"><i class="fa fa-check"></i><b>2.7</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>3</b> Linear and Generalised Linear Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="glm.html"><a href="glm.html#linear-model-lm"><i class="fa fa-check"></i><b>3.1</b> Linear Model (LM)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="glm.html"><a href="glm.html#lm-sec"><i class="fa fa-check"></i><b>3.1.1</b> Linear Predictors</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="glm.html"><a href="glm.html#generalised-linear-model-glm"><i class="fa fa-check"></i><b>3.2</b> Generalised Linear Model (GLM)</a></li>
<li class="chapter" data-level="3.3" data-path="glm.html"><a href="glm.html#poisson-glm"><i class="fa fa-check"></i><b>3.3</b> Poisson GLM</a></li>
<li class="chapter" data-level="3.4" data-path="glm.html"><a href="glm.html#overdispersion"><i class="fa fa-check"></i><b>3.4</b> Overdispersion</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="glm.html"><a href="glm.html#multiplicative-overdispersion"><i class="fa fa-check"></i><b>3.4.1</b> Multiplicative Overdispersion</a></li>
<li class="chapter" data-level="3.4.2" data-path="glm.html"><a href="glm.html#addod-sec"><i class="fa fa-check"></i><b>3.4.2</b> Additive Overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="glm.html"><a href="glm.html#prediction-in-glm"><i class="fa fa-check"></i><b>3.5</b> Prediction in GLM</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="glm.html"><a href="glm.html#posterior-predictive-distribution"><i class="fa fa-check"></i><b>3.5.1</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="glm.html"><a href="glm.html#binom-sec"><i class="fa fa-check"></i><b>3.6</b> Binomial and Bernoulli GLM</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="glm.html"><a href="glm.html#overdispersion-1"><i class="fa fa-check"></i><b>3.6.1</b> Overdispersion</a></li>
<li class="chapter" data-level="3.6.2" data-path="glm.html"><a href="glm.html#binom-pred-sec"><i class="fa fa-check"></i><b>3.6.2</b> Prediction</a></li>
<li class="chapter" data-level="3.6.3" data-path="glm.html"><a href="glm.html#bernoulli-sec"><i class="fa fa-check"></i><b>3.6.3</b> Bernoulli GLM</a></li>
<li class="chapter" data-level="3.6.4" data-path="glm.html"><a href="glm.html#probit-link"><i class="fa fa-check"></i><b>3.6.4</b> Probit link</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="glm.html"><a href="glm.html#ordinal-data"><i class="fa fa-check"></i><b>3.7</b> Ordinal Data</a></li>
<li class="chapter" data-level="3.8" data-path="glm.html"><a href="glm.html#non-zero-binomial-data"><i class="fa fa-check"></i><b>3.8</b> Non-zero Binomial Data</a></li>
<li class="chapter" data-level="3.9" data-path="glm.html"><a href="glm.html#complete-separation"><i class="fa fa-check"></i><b>3.9</b> Complete Separation</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="glm.html"><a href="glm.html#gelman-prior-sec"><i class="fa fa-check"></i><b>3.9.1</b> The <span class="citation">Gelman, Jakulin, et al. (2008)</span> prior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ranef.html"><a href="ranef.html"><i class="fa fa-check"></i><b>4</b> Random effects</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ranef.html"><a href="ranef.html#GLMM"><i class="fa fa-check"></i><b>4.1</b> Generalised Linear Mixed Model (GLMM)</a></li>
<li class="chapter" data-level="4.2" data-path="ranef.html"><a href="ranef.html#ranpred-sec"><i class="fa fa-check"></i><b>4.2</b> Prediction with Random Effects</a></li>
<li class="chapter" data-level="4.3" data-path="ranef.html"><a href="ranef.html#overdispersed-binomial-as-a-bernoulli-glmm"><i class="fa fa-check"></i><b>4.3</b> Overdispersed Binomial as a Bernoulli GLMM</a></li>
<li class="chapter" data-level="4.4" data-path="ranef.html"><a href="ranef.html#ICC"><i class="fa fa-check"></i><b>4.4</b> Intra-class Correlations</a></li>
<li class="chapter" data-level="4.5" data-path="ranef.html"><a href="ranef.html#PXprior-sec"><i class="fa fa-check"></i><b>4.5</b> Priors for Random Effect Variances</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="ranef.html"><a href="ranef.html#f-and-folded-t-priors"><i class="fa fa-check"></i><b>4.5.1</b> <span class="math inline">\(F\)</span> and folded-<span class="math inline">\(t\)</span> priors</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ranef.html"><a href="ranef.html#Vprior-gen-sec"><i class="fa fa-check"></i><b>4.6</b> Prior Generators</a></li>
<li class="chapter" data-level="4.7" data-path="ranef.html"><a href="ranef.html#priors-on-functions-of-variances"><i class="fa fa-check"></i><b>4.7</b> Priors on Functions of Variances</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="ranef.html"><a href="ranef.html#intra-class-correlation"><i class="fa fa-check"></i><b>4.7.1</b> Intra-class Correlation</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ranef.html"><a href="ranef.html#fix-or-rand"><i class="fa fa-check"></i><b>4.8</b> Fixed or Random?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cat-int.html"><a href="cat-int.html"><i class="fa fa-check"></i><b>5</b> Categorical Random Interactions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cat-int.html"><a href="cat-int.html#vstruct-sec"><i class="fa fa-check"></i><b>5.1</b> Variance Structures</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cat-int.html"><a href="cat-int.html#textttidh-variance-structure"><i class="fa fa-check"></i><b>5.1.1</b> <span class="math inline">\(\texttt{idh}\)</span> Variance Structure</a></li>
<li class="chapter" data-level="5.1.2" data-path="cat-int.html"><a href="cat-int.html#us-sec"><i class="fa fa-check"></i><b>5.1.2</b> <span class="math inline">\(\texttt{us}\)</span> Variance Structure</a></li>
<li class="chapter" data-level="5.1.3" data-path="cat-int.html"><a href="cat-int.html#other-variance-structures"><i class="fa fa-check"></i><b>5.1.3</b> Other Variance Structures</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="cat-int.html"><a href="cat-int.html#linking-functions"><i class="fa fa-check"></i><b>5.2</b> Linking Functions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="cat-int.html"><a href="cat-int.html#textttstr-covariances-between-random-terms"><i class="fa fa-check"></i><b>5.2.1</b> <span class="math inline">\(\texttt{str}\)</span>: covariances between random terms</a></li>
<li class="chapter" data-level="5.2.2" data-path="cat-int.html"><a href="cat-int.html#multim-sec"><i class="fa fa-check"></i><b>5.2.2</b> <span class="math inline">\(\texttt{mm}\)</span>: multi-membership models</a></li>
<li class="chapter" data-level="5.2.3" data-path="cat-int.html"><a href="cat-int.html#textttcovu-covariances-between-random-and-residual-terms"><i class="fa fa-check"></i><b>5.2.3</b> <span class="math inline">\(\texttt{covu}\)</span>: covariances between random and residual terms</a></li>
<li class="chapter" data-level="5.2.4" data-path="cat-int.html"><a href="cat-int.html#texttttheta_scale-scaled-linear-predictor"><i class="fa fa-check"></i><b>5.2.4</b> <span class="math inline">\(\texttt{theta_scale}\)</span>: scaled linear predictor</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="cat-int.html"><a href="cat-int.html#VCVprior-sec"><i class="fa fa-check"></i><b>5.3</b> Priors for Covariance Matrices</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="cat-int.html"><a href="cat-int.html#marginal-priors-for-variances"><i class="fa fa-check"></i><b>5.3.1</b> Marginal Priors for Variances</a></li>
<li class="chapter" data-level="5.3.2" data-path="cat-int.html"><a href="cat-int.html#VCVprior-r-sec"><i class="fa fa-check"></i><b>5.3.2</b> Marginal Priors for Covariances and Correlations</a></li>
<li class="chapter" data-level="5.3.3" data-path="cat-int.html"><a href="cat-int.html#full-joint-prior"><i class="fa fa-check"></i><b>5.3.3</b> Full joint prior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cont-int.html"><a href="cont-int.html"><i class="fa fa-check"></i><b>6</b> Continuous Random Interactions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cont-int.html"><a href="cont-int.html#random-regression"><i class="fa fa-check"></i><b>6.1</b> Random Regression</a></li>
<li class="chapter" data-level="6.2" data-path="cont-int.html"><a href="cont-int.html#het-res"><i class="fa fa-check"></i><b>6.2</b> Heterogeneous (Residual) Variances</a></li>
<li class="chapter" data-level="6.3" data-path="cont-int.html"><a href="cont-int.html#autoc-sec"><i class="fa fa-check"></i><b>6.3</b> Autocorrelation</a></li>
<li class="chapter" data-level="6.4" data-path="cont-int.html"><a href="cont-int.html#vstab-sec"><i class="fa fa-check"></i><b>6.4</b> Variance stabilisation</a></li>
<li class="chapter" data-level="6.5" data-path="cont-int.html"><a href="cont-int.html#antedependence-and-autoregressive-models"><i class="fa fa-check"></i><b>6.5</b> Antedependence and Autoregressive Models</a></li>
<li class="chapter" data-level="6.6" data-path="cont-int.html"><a href="cont-int.html#user-defined-sec"><i class="fa fa-check"></i><b>6.6</b> User-defined Design Matrices</a></li>
<li class="chapter" data-level="6.7" data-path="cont-int.html"><a href="cont-int.html#splines"><i class="fa fa-check"></i><b>6.7</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multi.html"><a href="multi.html"><i class="fa fa-check"></i><b>7</b> Multi-response models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="multi.html"><a href="multi.html#relaxing-the-univariate-assumptions-of-causality"><i class="fa fa-check"></i><b>7.1</b> Relaxing the univariate assumptions of causality</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="multi.html"><a href="multi.html#textttcovu-covariances-between-random-and-residual-terms-1"><i class="fa fa-check"></i><b>7.1.1</b> <span class="math inline">\(\texttt{covu}\)</span>: covariances between random and residual terms</a></li>
<li class="chapter" data-level="7.1.2" data-path="multi.html"><a href="multi.html#texttttheta_scale-scaled-linear-predictor-1"><i class="fa fa-check"></i><b>7.1.2</b> <span class="math inline">\(\texttt{theta_scale}\)</span>: scaled linear predictor</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="multi.html"><a href="multi.html#multinomial-models"><i class="fa fa-check"></i><b>7.2</b> Multinomial Models</a></li>
<li class="chapter" data-level="7.3" data-path="multi.html"><a href="multi.html#zero-inflated-models"><i class="fa fa-check"></i><b>7.3</b> Zero-inflated Models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="multi.html"><a href="multi.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.3.1</b> Posterior predictive checks</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="multi.html"><a href="multi.html#Hurdle"><i class="fa fa-check"></i><b>7.4</b> Hurdle Models</a></li>
<li class="chapter" data-level="7.5" data-path="multi.html"><a href="multi.html#ZAP"><i class="fa fa-check"></i><b>7.5</b> Zero-altered Models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pedigree.html"><a href="pedigree.html"><i class="fa fa-check"></i><b>8</b> Pedigrees and Phylogenies</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pedigree.html"><a href="pedigree.html#pedigree-and-phylogeny-formats"><i class="fa fa-check"></i><b>8.1</b> Pedigree and phylogeny formats</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="pedigree.html"><a href="pedigree.html#pedigrees"><i class="fa fa-check"></i><b>8.1.1</b> Pedigrees</a></li>
<li class="chapter" data-level="8.1.2" data-path="pedigree.html"><a href="pedigree.html#phylogenies"><i class="fa fa-check"></i><b>8.1.2</b> Phylogenies</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="pedigree.html"><a href="pedigree.html#the-animal-model-and-the-phylogenetic-mixed-model"><i class="fa fa-check"></i><b>8.2</b> The animal model and the phylogenetic mixed model</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="measurement.html"><a href="measurement.html"><i class="fa fa-check"></i><b>9</b> Measurement Error, Meta-analysis an Missing Values</a>
<ul>
<li class="chapter" data-level="9.1" data-path="measurement.html"><a href="measurement.html#error-in-the-response"><i class="fa fa-check"></i><b>9.1</b> Error in the Response</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="measurement.html"><a href="measurement.html#meta-sec"><i class="fa fa-check"></i><b>9.1.1</b> Meta-analysis</a></li>
<li class="chapter" data-level="9.1.2" data-path="measurement.html"><a href="measurement.html#interval-estimation"><i class="fa fa-check"></i><b>9.1.2</b> Interval Estimation</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="measurement.html"><a href="measurement.html#error-in-the-predictors"><i class="fa fa-check"></i><b>9.2</b> Error in the Predictors</a></li>
<li class="chapter" data-level="9.3" data-path="measurement.html"><a href="measurement.html#missing-values"><i class="fa fa-check"></i><b>9.3</b> Missing Values</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="path.html"><a href="path.html"><i class="fa fa-check"></i><b>10</b> Path Analysis &amp; Antedependence Structures</a>
<ul>
<li class="chapter" data-level="10.1" data-path="path.html"><a href="path.html#path-anlaysis"><i class="fa fa-check"></i><b>10.1</b> Path Anlaysis</a></li>
<li class="chapter" data-level="10.2" data-path="path.html"><a href="path.html#ante-sec"><i class="fa fa-check"></i><b>10.2</b> Antedependence</a></li>
<li class="chapter" data-level="10.3" data-path="path.html"><a href="path.html#scaling"><i class="fa fa-check"></i><b>10.3</b> Scaling</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="technical-details.html"><a href="technical-details.html"><i class="fa fa-check"></i><b>11</b> Technical Details</a>
<ul>
<li class="chapter" data-level="11.1" data-path="technical-details.html"><a href="technical-details.html#model-form"><i class="fa fa-check"></i><b>11.1</b> Model Form</a></li>
<li class="chapter" data-level="11.2" data-path="technical-details.html"><a href="technical-details.html#MCMC-app"><i class="fa fa-check"></i><b>11.2</b> MCMC Sampling Schemes</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="technical-details.html"><a href="technical-details.html#updating-the-latent-variables-bf-l"><i class="fa fa-check"></i><b>11.2.1</b> Updating the latent variables <span class="math inline">\({\bf l}\)</span></a></li>
<li class="chapter" data-level="11.2.2" data-path="technical-details.html"><a href="technical-details.html#updating-the-location-vector-boldsymboltheta-leftboldsymbolmathbfbeta-bf-uright"><i class="fa fa-check"></i><b>11.2.2</b> Updating the location vector <span class="math inline">\(\boldsymbol{\theta} = \left[{\boldsymbol{\mathbf{\beta}}}^{&#39;}\; {\bf u}^{&#39;}\right]^{&#39;}\)</span></a></li>
<li class="chapter" data-level="11.2.3" data-path="technical-details.html"><a href="technical-details.html#updating-the-variance-structures-bf-g-and-bf-r"><i class="fa fa-check"></i><b>11.2.3</b> Updating the variance structures <span class="math inline">\({\bf G}\)</span> and <span class="math inline">\({\bf R}\)</span></a></li>
<li class="chapter" data-level="11.2.4" data-path="technical-details.html"><a href="technical-details.html#ordinal-models"><i class="fa fa-check"></i><b>11.2.4</b> Ordinal Models</a></li>
<li class="chapter" data-level="11.2.5" data-path="technical-details.html"><a href="technical-details.html#path-analyses"><i class="fa fa-check"></i><b>11.2.5</b> Path Analyses</a></li>
<li class="chapter" data-level="11.2.6" data-path="technical-details.html"><a href="technical-details.html#deviance-and-dic"><i class="fa fa-check"></i><b>11.2.6</b> Deviance and DIC</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="technical-details.html"><a href="technical-details.html#parameter-expansion"><i class="fa fa-check"></i><b>11.3</b> Parameter Expansion</a></li>
<li class="chapter" data-level="11.4" data-path="technical-details.html"><a href="technical-details.html#priors-for-corg-and-corgh-structures"><i class="fa fa-check"></i><b>11.4</b> Priors for <code>corg</code> and <code>corgh</code> structures</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCMCglmm Course Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cont-int" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Continuous Random Interactions<a href="cont-int.html#cont-int" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In Chapter <a href="cat-int.html#cat-int">5</a> we saw how we could define a set of random effects by specifying a linear model within a variance function and then interacting this term with a categorical predictor. In that Chapter, we used the random term <code>~us(virus):line</code> in order to model <span class="math inline">\(\texttt{virus}\)</span> by <span class="math inline">\(\texttt{line}\)</span> interactions. Since the variance function model involved a categorical predictor (<code>virus</code>), and the intercept is omitted by default, it was not really necessary to fully engage with the idea that the variance function is taking a model formula - most users familiar with covariance matrices will be happy that <code>~us(virus):line</code> specifies the covariance matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{line}}}}=
\left[
\begin{array}{ccc}
\sigma^{2}_{\color{blue}{\texttt{France}}}&amp;\sigma_{\color{blue}{\texttt{France}, \texttt{Spain}}}&amp;\sigma_{\color{blue}{\texttt{France}, \texttt{Greece}}}\\
\sigma_{\color{blue}{\texttt{France}, \texttt{Spain}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Spain}}}&amp;\sigma_{\color{blue}{\texttt{Spain}, \texttt{Greece}}}\\
\sigma_{\color{blue}{\texttt{France}, \texttt{Greece}}}&amp;\sigma_{\color{blue}{\texttt{Spain}, \texttt{Greece}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Greece}}}\\
\end{array}
\right]\]</span></p>
<p>However, we are also free to use continuous covariates in the variance function model, or even a mixture of continuous and categorical predictors. Although the resulting covariance matrix is interpreted in the same way, it can be less intuitive.</p>
<div id="random-regression" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Random Regression<a href="cont-int.html#random-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As an example, we’ll use a longitudinal data set on chicken growth (See Figure <a href="cont-int.html#fig:ChickWeight">6.1</a>).</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="cont-int.html#cb199-1" tabindex="-1"></a><span class="fu">data</span>(ChickWeight)</span>
<span id="cb199-2"><a href="cont-int.html#cb199-2" tabindex="-1"></a><span class="fu">head</span>(ChickWeight)</span></code></pre></div>
<pre><code>## Grouped Data: weight ~ Time | Chick
##   weight Time Chick Diet
## 1     42    0     1    1
## 2     51    2     1    1
## 3     59    4     1    1
## 4     64    6     1    1
## 5     76    8     1    1
## 6     93   10     1    1</code></pre>
<p>The data consist of body weights (<code>weight</code>) for 50 chicks (<code>Chick</code>) measured up to 12 times over a 3 week period. The variable <code>Time</code> is the number of days since hatching, and <code>Diet</code> is a four level factor indicating the type of protein diet the chicks received. The data are plotted in Figure <a href="cont-int.html#fig:ChickWeight">6.1</a>.</p>
<div class="figure"><span style="display:block;" id="fig:ChickWeight"></span>
<img src="_bookdown_files/fig/ChickWeight-1.png" alt="Weight data of 50 chicks from hatching until three weeks old. Chicks in the first two rows were fed on $  exttt{Diet 1}$, and chicks in rows 3 to 5 were fed on $ exttt{Diet 2}$ to $ exttt{4}$, respectively." width="864" />
<p class="caption">
Figure 6.1: Weight data of 50 chicks from hatching until three weeks old. Chicks in the first two rows were fed on $ exttt{Diet 1}$, and chicks in rows 3 to 5 were fed on $ exttt{Diet 2}$ to $ exttt{4}$, respectively.
</p>
</div>
<p>Growth curves tend to be sigmoidal and so one of the non-linear growth curves such as the Gompertz or logistic may fit the data well. However, these can be tricky to use and an alternative is to try and capture the form of the curve using polynomials. We’ll start with a quadratic function at the population level and and fit chick effects as random<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="cont-int.html#cb201-1" tabindex="-1"></a>prior.weight <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">IW</span>(<span class="dv">1</span>, <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">F</span>(<span class="dv">2</span>, <span class="dv">10000</span>))</span>
<span id="cb201-2"><a href="cont-int.html#cb201-2" tabindex="-1"></a></span>
<span id="cb201-3"><a href="cont-int.html#cb201-3" tabindex="-1"></a>mweight<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span>Chick, <span class="at">data =</span> ChickWeight,</span>
<span id="cb201-4"><a href="cont-int.html#cb201-4" tabindex="-1"></a>    <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight)</span></code></pre></div>
<p>I can hear the rule-of-thumbers squeal - I’ve fitted an interaction with <span class="math inline">\(\texttt{Diet}\)</span>, but no ‘main’ effect. Let’s think about the fixed effect part of the model. For the reference <span class="math inline">\(\texttt{Diet}\)</span> (<span class="math inline">\(\texttt{Diet 1}\)</span>) the linear model is</p>
<p><span class="math display">\[E[\texttt{weight} | \texttt{Diet}=1] = \beta_0+\beta_1\texttt{Time} +  \beta_{2}\texttt{Time}^{2}\]</span></p>
<p>At hatching (<span class="math inline">\(\texttt{Time}\)</span>=0) the expected weight of a chick is <span class="math inline">\(\beta_0\)</span>. The slope, <span class="math inline">\(\beta_1\)</span>, is a rate because it is in units of grams per day - it’s a growth rate. The quadratic term, <span class="math inline">\(\beta_2\)</span>, is in units of grams per day<span class="math inline">\(^{2}\)</span> and represents acceleration, or more intuitively, the rate of change in the growth rate in units [grams per day] per day. At hatching, the growth rate is <span class="math inline">\(\beta_1\)</span> but at other values of <span class="math inline">\(\texttt{Time}\)</span> the growth rate is <span class="math inline">\(\beta_1+\beta_{2}\texttt{Time}\)</span><a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>. For a non-reference <span class="math inline">\(\texttt{Diet}\)</span> (for example, <span class="math inline">\(\texttt{Diet 2}\)</span>) the model is</p>
<p><span class="math display">\[E[\texttt{weight} | \texttt{Diet}=\texttt{2}] = \beta_0+\beta_1\texttt{Time} +  \beta_{2}\texttt{Time}^{2}+\beta_{3}\texttt{Time}\]</span></p>
<p>where <span class="math inline">\(\beta_{3}\)</span> is the interaction effect, which will be labelled as <span class="math inline">\(\texttt{Diet2:Time}\)</span> in the model output. The equation can be more easily understood with a little rearrangement:</p>
<p><span class="math display">\[E[\texttt{weight} | \texttt{Diet}=\texttt{2}] = \beta_0+\left(\beta_1+\beta_3\right)\texttt{Time} +  \beta_{2}\texttt{Time}^{2}\]</span></p>
<p>At hatching the model predicts chicks on different diets to have the same expected weight (<span class="math inline">\(\beta_0\)</span>). This is why I intentionally dropped the ‘main’ effect: at hatching the diet is yet to have an effect on the chick’s weight and since chicks were randomly assigned to a treatment they should be equivalent at <span class="math inline">\(\texttt{Time}\)</span> 0. We could test this if we wished, but I’m prepared to trust the experimenters. After hatching, however, we may expect the diet to cause the weights of the chicks to diverge because it alters their growth rate. The difference in growth rate between <span class="math inline">\(\texttt{Diet 2}\)</span> and <span class="math inline">\(\texttt{Diet 1}\)</span> is <span class="math inline">\(\beta_{3}\)</span>. We’ve assumed that the effect of <span class="math inline">\(\texttt{Time}^{2}\)</span> is constant over diets. This means that if the growth rates differ between the treatment groups, that difference remains constant: the growth rate on <span class="math inline">\(\texttt{Diet 2}\)</span> at some value of <span class="math inline">\(\texttt{Time}\)</span> is <span class="math inline">\(\beta_1+\beta_3+\beta_{2}\texttt{Time}\)</span>, and consistently differs from <span class="math inline">\(\texttt{Diet 1}\)</span> by an amount <span class="math inline">\(\beta_\texttt{3}\)</span> at all values of <span class="math inline">\(\texttt{Time}\)</span>.</p>
<p>Let’s have a look at the model summary:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="cont-int.html#cb202-1" tabindex="-1"></a><span class="fu">summary</span>(mweight<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 3001:12991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 5398.374 
## 
##  G-structure:  ~Chick
## 
##       post.mean l-95% CI u-95% CI eff.samp
## Chick     575.9    335.2    813.1     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     610.5    529.4    679.2     1000
## 
##  Location effects: weight ~ Time + I(Time^2) + Diet:Time 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)  38.09190 29.37737 46.23461     1000 &lt;0.001 ***
## Time          3.66880  2.38609  4.84156     1000 &lt;0.001 ***
## I(Time^2)     0.14632  0.09254  0.19570     1100 &lt;0.001 ***
## Time:Diet2    1.80958  0.99523  2.48771     1000 &lt;0.001 ***
## Time:Diet3    4.46028  3.79161  5.28554     1000 &lt;0.001 ***
## Time:Diet4    2.94754  2.20819  3.70829     1140 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Hopefully the output is now familiar. At hatching the chicks weigh approximately 38 grams. On the reference diet the chicks are growing at a rate of 3.7 grams per day at the beginning (<span class="math inline">\(\texttt{Time}=0\)</span>) but as they get older they start to grow faster (the coefficient associated with <span class="math inline">\(\texttt{Time}^2\)</span> is positive). All diets seem to increase growth rate compared to <span class="math inline">\(\texttt{Diet 1}\)</span>.</p>
<p>While the explanation of how to interpret the fixed effects was perhaps laboured, it should be remembered that fixed and random effects are completely equivalent in how they enter the linear predictor (Chapter <a href="ranef.html#ranef">4</a>). If the explanation of the fixed effect part of the model is understood, then nothing new needs to be learned when we try to understand the chick effects. If we consider <span class="math inline">\(\texttt{Chick}\)</span> <span class="math inline">\(i\)</span> fed on the reference diet, its expected weight is:</p>
<p><span class="math display">\[E[\texttt{weight} | \texttt{Diet}=1, \texttt{Chick}=i] = \beta_0+\beta_1\texttt{Time} +  \beta_{2}\texttt{Time}^{2}+u^{(0)}_i\]</span></p>
<p>where <span class="math inline">\(u^{(0)}_i\)</span> is the random chick effect. The model assumes that chicks deviate consistently in their weight across time, but chicks do not deviate in their growth rate. Since we saved the random chick effects (<code>pr=TRUE</code>) we can obtain the predictions for each chick by specifying <code>marginal=NULL</code> (Section <a href="ranef.html#ranpred-sec">4.2</a>):</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="cont-int.html#cb204-1" tabindex="-1"></a>pweight<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">predict</span>(mweight<span class="fl">.1</span>, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>and we can add them to the <span class="math inline">\(\texttt{xyplot}\)</span> plot as black lines (Figure <a href="cont-int.html#fig:CWpred-1">6.2</a>).</p>
<div class="figure"><span style="display:block;" id="fig:CWpred-1"></span>
<img src="_bookdown_files/fig/CWpred-1-1.png" alt="Weights of each chick as a function of age (points). The mean growth curve was fitted as a quadratic function of $\texttt{Time}$ with random chick intercepts (model `mweight.1`). The predicted weights are shown as lines." width="864" />
<p class="caption">
Figure 6.2: Weights of each chick as a function of age (points). The mean growth curve was fitted as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span> with random chick intercepts (model <code>mweight.1</code>). The predicted weights are shown as lines.
</p>
</div>
<p>The predictions don’t look too bad (but see Section <a href="#covf-sec"><strong>??</strong></a>), although you will notice that for some chicks (e.g. 7, 13 and 35) the slope of the predicted growth seems either too shallow, or too steep. As we did with the <span class="math inline">\(\texttt{Diet}\)</span> by <span class="math inline">\(\texttt{Time}\)</span> interaction, we could also allow our chicks to deviate in their growth rates and fit the model:</p>
<p><span class="math display" id="eq:rr">\[E[\texttt{weight} | \texttt{Diet}=1, \texttt{Chick}=i] = \beta_0+(\beta_1+u^{(1)}_i)\texttt{Time} + \beta_{2}\texttt{Time}^{2}+u^{(0)}_i
\label{rr-eq}   \tag{6.1}\]</span></p>
<p>where <span class="math inline">\(u^{(1)}_i\)</span> is how much <span class="math inline">\(\texttt{Chick}\)</span> <span class="math inline">\(i\)</span>’s growth rate differs from the average (<span class="math inline">\(\beta_1\)</span> for <span class="math inline">\(\texttt{Diet 1}\)</span>). This type of model is often referred to as a random-regression model. To fit such a model we can replace <code>Chick</code> in the random formula with the term <code>us(1+Time):Chick</code>. The linear model inside the variance function has two parameters, an intercept (<code>1</code> - which he have to specify explicitly<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>) and a regression slope associated with <code>Time</code>. Consequently, the interaction with <span class="math inline">\(\texttt{Chick}\)</span> defines the set of coefficients:</p>
<p><span class="math display">\[\begin{array}{c|rrrrrc}
&amp;{\color{red}{\texttt{Chick1}}}&amp;{\color{red}{\texttt{Chick2}}}&amp;{\color{red}{\texttt{Chick3}}}&amp;\dots\\
\hline
{\color{blue}{\texttt{(Intercept)}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick1}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick2}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick3}}}&amp;\dots\\
{\color{blue}{\texttt{Time}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick1}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick2}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick3}}}&amp;\dots\\
\end{array}\]</span></p>
<p>Each chick now has an intercept and a slope, as in Equation <a href="cont-int.html#eq:rr">(6.1)</a>, and because we have used the <code>us</code> variance structure we are estimating the <span class="math inline">\(2\times2\)</span> matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{Chick}}}}=
\left[
\begin{array}{cc}
\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}}}\\
\end{array}
\right]\]</span></p>
<p><span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}\)</span> is the amount of variation in intercepts between chicks, and <span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{Time}}}\)</span> is the amount of variation in the regression slopes (the growth rates) between chicks. Note that our first model could also have been fitted using <code>us(1):Chick</code> (rather than just <code>Chick</code>) which may make it clearer why the <span class="math inline">\(\texttt{Chick}\)</span> effects in that model could be called intercepts.</p>
<p>Let’s fit the random regression model:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="cont-int.html#cb205-1" tabindex="-1"></a>mweight<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> Time)<span class="sc">:</span>Chick,</span>
<span id="cb205-2"><a href="cont-int.html#cb205-2" tabindex="-1"></a>    <span class="at">data =</span> ChickWeight, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight)</span>
<span id="cb205-3"><a href="cont-int.html#cb205-3" tabindex="-1"></a><span class="fu">summary</span>(mweight<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 3001:12991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 4544.498 
## 
##  G-structure:  ~us(1 + Time):Chick
## 
##                               post.mean l-95% CI u-95% CI eff.samp
## (Intercept):(Intercept).Chick    146.00   77.176   219.94     1000
## Time:(Intercept).Chick           -37.70  -55.904   -22.19     1000
## (Intercept):Time.Chick           -37.70  -55.904   -22.19     1000
## Time:Time.Chick                   11.67    7.511    16.88     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     133.1    115.5    149.6    984.1
## 
##  Location effects: weight ~ Time + I(Time^2) + Diet:Time 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)   37.8003  33.8645  41.7408     1000 &lt;0.001 ***
## Time           4.5223   3.3090   5.6356     1000 &lt;0.001 ***
## I(Time^2)      0.1294   0.1074   0.1547     1000 &lt;0.001 ***
## Time:Diet2     1.2520  -0.1042   2.5516     1129  0.070 .  
## Time:Diet3     1.8390   0.3580   3.2278     1000  0.016 *  
## Time:Diet4     2.8644   1.4744   4.2199     1000 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>There seems to be substantial variation in growth rate between chicks after controlling for the diet treatment. The posterior mean of the slope variance is 11.67 which in terms of a standard deviation is 3.42 - larger than the effects of <span class="math inline">\(\texttt{Diet}\)</span>. Again, we can get the predicted weights from this model</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="cont-int.html#cb207-1" tabindex="-1"></a>pweight<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">predict</span>(mweight<span class="fl">.2</span>, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>and we can see that the fit is better (See Figure <a href="cont-int.html#fig:CWpred-2">6.3</a>).</p>
<div class="figure"><span style="display:block;" id="fig:CWpred-2"></span>
<img src="_bookdown_files/fig/CWpred-2-1.png" alt="Weights of each chick as a function of age (points). Predictions are shown for models where the mean growth curve was fitted as a quadratic function of $\texttt{Time}$ with random chick intercepts (black lines - model `mweight.1`) or random chick intercepts and slopes (red lines - model `mweight.2`)." width="864" />
<p class="caption">
Figure 6.3: Weights of each chick as a function of age (points). Predictions are shown for models where the mean growth curve was fitted as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span> with random chick intercepts (black lines - model <code>mweight.1</code>) or random chick intercepts and slopes (red lines - model <code>mweight.2</code>).
</p>
</div>
<p>In theory we could fit higher degree random regressions (data and prior permitting). For example, fitting <code>random=~us(1+Time+I(Time^2)):Chick</code> would allow the quadratic term for each Chick to deviate from the population mean and we would be estimating the <span class="math inline">\(3\times3\)</span> covariance matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{Chick}}}}=
\left[
\begin{array}{ccc}
\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}^{2}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}}}&amp;\sigma_{\color{blue}{\texttt{Time}, \texttt{Time}^{2}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}^2}}&amp;\sigma_{\color{blue}{\texttt{Time}, \texttt{Time}^{2}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}^2}}\\
\end{array}
\right]\]</span></p>
</div>
<div id="het-res" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Heterogeneous (Residual) Variances<a href="cont-int.html#het-res" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One under-appreciated facet of random regression models is that when a polynomial of degree <span class="math inline">\(n\)</span> is fitted, the variance in the response is predicted to change as a polynomial of degree <span class="math inline">\(n+1\)</span>. In our random-intercept slope model (<code>mweight.2</code>) the variance in <span class="math inline">\(\texttt{weight}\)</span> due to the random terms is</p>
<p><span class="math display" id="eq:Vrr">\[
\begin{array}{rl}
\textrm{Var}(\texttt{weight}) =&amp;\sigma^2_{\texttt{(Intercept)}}+2\texttt{Time}\sigma_{\texttt{(Intercept)}, \texttt{Time}}+\texttt{Time}^2\sigma^2_{\texttt{Time}}\\
\end{array}
\label{Vrr-eq}   \tag{6.2}
\]</span></p>
<p>Since we specified a 1st degree polynomial of of <span class="math inline">\(\texttt{Time}\)</span> at the level of <span class="math inline">\(\texttt{Chick}\)</span> (an intercept and slope) the variance is a 2nd degree polynomial of <span class="math inline">\(\texttt{Time}\)</span> (it has a quadratic term, with coefficient <span class="math inline">\(\sigma^2_{\texttt{Time}}\)</span>). The function <code>buildV</code> returns the predicted variance of observations (and the covariances if <code>diag=FALSE</code>) after conditioning on the fixed effect model. As with the predict function, there is also the option to condition on some of the random effects (i.e. treat them as constants) by excluding them from the argument passed to marginal (see Section <a href="ranef.html#ranpred-sec">4.2</a>). However, the default is not to condition on them and so we can get the total predicted variance for each observation due to chick effects and the residuals. The residual variance in our model is constant, so the total variance is obtained by simply adding <span class="math inline">\(\sigma^2_{\textrm{units}}\)</span> to Equation <a href="cont-int.html#eq:Vrr">(6.2)</a>.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="cont-int.html#cb208-1" tabindex="-1"></a>predv.weight<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">buildV</span>(mweight<span class="fl">.2</span>)</span></code></pre></div>
<p>The predicted variance goes up dramatically with <span class="math inline">\(\texttt{Time}\)</span> (red points in Figure <a href="cont-int.html#fig:V-rr">6.4</a>). In contrast, model (<code>mweight.1</code>), where chicks do not vary in their growth rate, assumes that the variance is constant with <span class="math inline">\(\texttt{Time}\)</span> (black points in Figure <a href="cont-int.html#fig:V-rr">6.4</a>).</p>
<div class="figure"><span style="display:block;" id="fig:V-rr"></span>
<img src="_bookdown_files/fig/V-rr-1.png" alt="Predicted variance in weight due to random effects from model `mweight.2`." width="672" />
<p class="caption">
Figure 6.4: Predicted variance in weight due to random effects from model <code>mweight.2</code>.
</p>
</div>
<p>The two models are dramatically different in how they predict the variance changes with <span class="math inline">\(\texttt{Time}\)</span>. This important difference isn’t really apparent from comparing their predictions with the data (Figure <a href="cont-int.html#fig:CWpred-2">6.3</a>. However, if we obtain the 95% prediction intervals for the two models (the interval within which we expect to see 95% of observations)</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="cont-int.html#cb209-1" tabindex="-1"></a>pred.weight<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">predict</span>(mweight<span class="fl">.1</span>, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb209-2"><a href="cont-int.html#cb209-2" tabindex="-1"></a>pred.weight<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">predict</span>(mweight<span class="fl">.2</span>, <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>)</span></code></pre></div>
<p>and overlay these on the data for all chicks plotted simultaneously, we see that our first model - that assumes constant variance - has serious problems (black lines in Figure <a href="cont-int.html#fig:pred-int1">6.5</a>). Initially, it predicts far more variability than observed, but after around <span class="math inline">\(\texttt{Time}\)</span> 12 it predicts too little variability. The random slope model (red lines) does much better, although it still predicts too much variability initially, particularly at hatching.</p>
<div class="figure"><span style="display:block;" id="fig:pred-int1"></span>
<img src="_bookdown_files/fig/pred-int1-1.png" alt="Chick weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The black line is for a random intercept model (`mweight.1`) that implicitly assumes the variance is constant over $\texttt{Time}$.  The red line is for a random intercept-slope model (`mweight.2`) that allows the variance (across chicks) to change as a quadratic function of $\texttt{Time}$." width="672" />
<p class="caption">
Figure 6.5: Chick weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The black line is for a random intercept model (<code>mweight.1</code>) that implicitly assumes the variance is constant over <span class="math inline">\(\texttt{Time}\)</span>. The red line is for a random intercept-slope model (<code>mweight.2</code>) that allows the variance (across chicks) to change as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span>.
</p>
</div>
<p>At this point we may be fairly chuffed with our model - not only does it seem to predict the expected response well (Figure <a href="cont-int.html#fig:CWpred-2">6.3</a>), but in terms of the variance in the response, it’s a massive improvement over the intercept-only model (Figure <a href="cont-int.html#fig:pred-int1">6.5</a>). Indeed, the <span class="math inline">\(\texttt{ChickWeight}\)</span> data has become something of a classic for illustrating the power of random regression models. However, a number of issues remain with the model and it’s interpretation. We will address these issues in the remainder of this section and the next.</p>
<p>The only way that our random intercept-slope model (model <code>mweight.2</code>) can accommodate an increase in the variance over <span class="math inline">\(\texttt{Time}\)</span> is through the parameters of the (co)variance matrix of chick effects (Equation <a href="cont-int.html#eq:Vrr">(6.2)</a>). Consequently, a non-zero <span class="math inline">\(\sigma^2_\texttt{Time}\)</span> may indicate that chick’s vary in their growth rate but it may also just be capturing increases in variance due to some other mechanism. Perhaps the evidence for a non-zero <span class="math inline">\(\sigma^2_\texttt{Time}\)</span> is coming solely from how the variance in weight changes as a function of <span class="math inline">\(\texttt{Time}\)</span> not from assessing whether weights from the same chick are correlated? To see this, let’s take the <span class="math inline">\(\texttt{ChickWeight}\)</span> data frame and permute <span class="math inline">\(\texttt{Chick}\)</span> labels within each <span class="math inline">\(\texttt{Time}\)</span> category.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="cont-int.html#cb210-1" tabindex="-1"></a>ChickWeightPerm <span class="ot">&lt;-</span> ChickWeight</span>
<span id="cb210-2"><a href="cont-int.html#cb210-2" tabindex="-1"></a>ChickWeightPerm<span class="sc">$</span>Chick <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">with</span>(ChickWeight, <span class="fu">tapply</span>(Chick, Time, sample)))</span></code></pre></div>
<p>The <span class="math inline">\(\texttt{Chick}\)</span> labels in this new data frame do <em>not</em> link multiple observations from the same chick, but let’s fit the same random regression model that we have fitted previously:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="cont-int.html#cb211-1" tabindex="-1"></a>mweight.perm <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb211-2"><a href="cont-int.html#cb211-2" tabindex="-1"></a>    Time)<span class="sc">:</span>Chick, <span class="at">data =</span> ChickWeightPerm, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight)</span></code></pre></div>
<p>Given the <span class="math inline">\(\texttt{Chick}\)</span> labels are essentially meaningless, we might expect a model fitted to these permuted data would find no evidence for variation in chick intercepts or slopes. However, if we look at the posterior distributions for the variance in intercepts and slopes we see that there is very strong evidence that chicks vary in the growth rate (Figure <a href="cont-int.html#fig:perm">6.6</a>).</p>
<div class="figure"><span style="display:block;" id="fig:perm"></span>
<img src="_bookdown_files/fig/perm-1.png" alt="Posterior distributions for the variances in chick intercepts and slopes. The model was fitted to a data set where chick labels at each time-point were randomised." width="672" />
<p class="caption">
Figure 6.6: Posterior distributions for the variances in chick intercepts and slopes. The model was fitted to a data set where chick labels at each time-point were randomised.
</p>
</div>
<p>This is quite disconcerting - our model tells us that chicks systematically differ in their growth rate, yet we’ve jumbled the chick labels up in a way that weights from the same chick must be completely uncorrelated. How do we know that something similar isn’t happening with our original model?</p>
<p>One option would be to allow the residual variance to change as a function of <span class="math inline">\(\texttt{Time}\)</span> and so we can be sure that the information for estimating the random effect part of the model is really coming from the repeated nature of the observations. Equation <a href="cont-int.html#eq:Vrr">(6.2)</a> gave use the expected variance due to <span class="math inline">\(\texttt{Chick}\)</span> effects as a function of <span class="math inline">\(\texttt{Time}\)</span>. We can use this idea to allow the residual variance to increase with the square of some covariate. Although I won’t discuss it here, <span class="math inline">\(\texttt{covu}\)</span> models (Section <a href="#covu-sec"><strong>??</strong></a>) could be used to allow the residual variance to change as a polynomial function of the predictor with arbitrary degree.</p>
<p>Lets add the term <code>us(Time):units</code> to the random part of our model:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="cont-int.html#cb212-1" tabindex="-1"></a>mweight<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> Time)<span class="sc">:</span>Chick <span class="sc">+</span></span>
<span id="cb212-2"><a href="cont-int.html#cb212-2" tabindex="-1"></a>    <span class="fu">us</span>(Time)<span class="sc">:</span>units, <span class="at">data =</span> ChickWeight, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight, <span class="at">longer =</span> <span class="dv">10</span>)</span>
<span id="cb212-3"><a href="cont-int.html#cb212-3" tabindex="-1"></a><span class="fu">summary</span>(mweight<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 30001:129901
##  Thinning interval  = 100
##  Sample size  = 1000 
## 
##  DIC: 3155.614 
## 
##  G-structure:  ~us(1 + Time):Chick
## 
##                               post.mean l-95% CI u-95% CI eff.samp
## (Intercept):(Intercept).Chick     8.736   0.5156  19.9539    471.8
## Time:(Intercept).Chick           -5.844 -11.7612  -0.8111    321.4
## (Intercept):Time.Chick           -5.844 -11.7612  -0.8111    321.4
## Time:Time.Chick                   5.037   2.8220   7.6839    490.5
## 
##                ~us(Time):units
## 
##                 post.mean l-95% CI u-95% CI eff.samp
## Time:Time.units     1.431    1.031    1.926    215.6
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     8.321    0.458    15.45      320
## 
##  Location effects: weight ~ Time + I(Time^2) + Diet:Time 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)  40.43255 39.06057 41.47525    837.9 &lt;0.001 ***
## Time          3.31023  2.36158  4.27471    499.1 &lt;0.001 ***
## I(Time^2)     0.19681  0.17217  0.22287    393.0 &lt;0.001 ***
## Time:Diet2    1.20502  0.07702  2.43222    891.6  0.038 *  
## Time:Diet3    2.04874  0.82236  3.31371    669.7  0.006 ** 
## Time:Diet4    2.60724  1.39079  3.76669   1000.0 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The model mixes quite poorly, so I’ve ran it for 10 times longer than the default using the argument <code>longer</code><a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>. For a real analysis I would increase it even further, but the qualitative features of the posterior can be reliably assessed. The variance associated with <code>us(Time):units</code> lies roughly between one and two, and is certainly not zero. The (co)variances of the <span class="math inline">\(\texttt{Chick}\)</span> effects have dramatically decreased compared to the model where <code>us(Time):units</code> was not fitted (model <code>mweight.2</code>).</p>
<p>What is the term <code>us(Time):units</code> fitting? The term <code>units</code> is factor with a unique level for each row of the data-frame. When we fit <code>~units</code> (the default argument to <code>rcov</code>) we are simply fitting residuals. The term <code>us(Time):units</code> is fitting a slope effect for each level of <code>units</code> (note we have not included the intercept in the variance function). Let’s call the residual for observation <span class="math inline">\(i\)</span>, as specified by <code>~units</code>, as <span class="math inline">\(e^{(0)}_i\)</span> (rather than the usual <span class="math inline">\(e_i\)</span>). Let’s call the random effect <span class="math inline">\(i\)</span> specified by the term <code>us(Time):units</code> as <span class="math inline">\(e^{(1)}_i\)</span> since it is the slope for observation <span class="math inline">\(i\)</span> with respect to <span class="math inline">\(\texttt{Time}\)</span>. Then,</p>
<p><span class="math display">\[\sigma^2_e = Var(e^{(0)}+e^{(1)}\texttt{Time})=\sigma^2_{\texttt{units}}+\texttt{Time}^{2}\sigma^2_{\texttt{Time:units}}\]</span></p>
<p>This has the same form as Equation <a href="cont-int.html#eq:Vrr">(6.2)</a> although note that that it misses a term <span class="math inline">\(\sigma_{\texttt{Time:units}, \texttt{units}}\)</span> and so the residual variance, <span class="math inline">\(\sigma^2_e\)</span>, is forced to increase as <span class="math inline">\(\texttt{Time}\)</span> gets larger.<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a></p>
<p>The reason that the (co)variances of the <span class="math inline">\(\texttt{Chick}\)</span> effects has decreased is because our new model attributes part of the increase in variance over <span class="math inline">\(\texttt{Time}\)</span> to things other than variation in growth rate. The model does a good job at predicting how the variance increases with <span class="math inline">\(\texttt{Time}\)</span>, and in particular predicts the variance at hatching much better than our previous model (blue lines in Figure <a href="cont-int.html#fig:pred-int2">6.7</a>).</p>
<div class="figure"><span style="display:block;" id="fig:pred-int2"></span>
<img src="_bookdown_files/fig/pred-int2-1.png" alt="Chick weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The red line is for a random intercept-slope model (`mweight.2`) that allows the variance to across chicks to change as a quadratic function of $\texttt{Time}$. The blue line is also for a random intercept-slope model (`mweight.3`) but the residual variance has been allowed to change with the square of $\texttt{Time}$." width="672" />
<p class="caption">
Figure 6.7: Chick weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The red line is for a random intercept-slope model (<code>mweight.2</code>) that allows the variance to across chicks to change as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span>. The blue line is also for a random intercept-slope model (<code>mweight.3</code>) but the residual variance has been allowed to change with the square of <span class="math inline">\(\texttt{Time}\)</span>.
</p>
</div>
<p>We can also look at how well the predicted means align with each chick’s growth curve. However, to make a fair comparison with other models we should marginalise <code>us(Time):units</code> so that the prediction doesn’t contain part of our ‘residual’ (<span class="math inline">\(e^{(1)}\texttt{Time}\)</span>):</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="cont-int.html#cb214-1" tabindex="-1"></a>pweight<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">predict</span>(mweight<span class="fl">.3</span>, <span class="at">marginal =</span> <span class="sc">~</span><span class="fu">us</span>(Time)<span class="sc">:</span>units)</span></code></pre></div>
<p>If we overlay these predictions on those from the model with constant residual variance, we can see that the predictions for the mean are rather similar (Figure <a href="cont-int.html#fig:CWpred-3">6.8</a>).</p>
<div class="figure"><span style="display:block;" id="fig:CWpred-3"></span>
<img src="_bookdown_files/fig/CWpred-3-1.png" alt="Weights of each chick as a function of age (points). Predictions are shown for models where the mean growth curve was fitted as a quadratic function of $\texttt{Time}$ with  random chick intercept and slopes. The residual variance is either assumed constant (red lines - model `mweight.2`) or to change with square of $\texttt{Time}$ (blue lines - model `mweight.3`)." width="864" />
<p class="caption">
Figure 6.8: Weights of each chick as a function of age (points). Predictions are shown for models where the mean growth curve was fitted as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span> with random chick intercept and slopes. The residual variance is either assumed constant (red lines - model <code>mweight.2</code>) or to change with square of <span class="math inline">\(\texttt{Time}\)</span> (blue lines - model <code>mweight.3</code>).
</p>
</div>
<p>By allowing the residual variance to change as a function of <span class="math inline">\(\texttt{Time}\)</span> our estimate of the variation in growth rate (<span class="math inline">\(\sigma^\texttt{Time}\)</span>) has dropped from 11.7 to 5 - a major change in interpretation. Is this change in interpretation justified? I would argue that in terms of predicting the mean, the model that assumed constant residual variance actually does slightly better than our new model. Both models also show autocorrelation in their residuals - we see runs of data-points lying consistently above, or consistently below, the prediction lines (for example <span class="math inline">\(\texttt{Chick 43}\)</span>). If we plot the residuals from our predictions, these patterns are much more obvious (Figure <a href="cont-int.html#fig:CWresid">6.9</a>).</p>
<div class="figure"><span style="display:block;" id="fig:CWresid"></span>
<img src="_bookdown_files/fig/CWresid-1.png" alt="Weights of each chick as a function of age (points). Predictions are shown for models where the mean growth curve was fitted as a quadratic function of $\texttt{Time}$ with  random chick intercept and slopes. The residual variance is either assumed constant (red lines - model `mweight.2`) or to change with square of $\texttt{Time}$ (blue lines - model `mweight.3`)." width="864" />
<p class="caption">
Figure 6.9: Weights of each chick as a function of age (points). Predictions are shown for models where the mean growth curve was fitted as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span> with random chick intercept and slopes. The residual variance is either assumed constant (red lines - model <code>mweight.2</code>) or to change with square of <span class="math inline">\(\texttt{Time}\)</span> (blue lines - model <code>mweight.3</code>).
</p>
</div>
<p>We are in a tricky situation. The model with non-constant residual variance does a better job at catching the patterns in the data. If it did not, the variance associated with the term <code>us(Time):units</code> should be zero, and it is clearly not. However, when we focus on specific aspects of the data (e.g. the predicted means) it does a slightly poorer job. The central issue here is that both models have their inadequacies, and without fixing them it might be hard to draw very firm conclusions. While dissatisfying, it is the reality, and previous random-regression tutorials that have used the <span class="math inline">\(\texttt{ChickWeight}\)</span> data set as an example rarely touch on the difficulties and subtleties of the approach. However, as is often the case, in Section <a href="cont-int.html#vstab-sec">6.4</a> we will see that the log-transform can come to our rescue. First, let’s return to the issue of autocorrelation.</p>
</div>
<div id="autoc-sec" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Autocorrelation<a href="cont-int.html#autoc-sec" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In Figure <a href="cont-int.html#fig:CWresid">6.9</a> we plotted a time series for the residuals of each chick. Neighbouring residuals were much more likely to have the same sign than a random pair of residuals, indicating positive autocorrelation in the residuals over short time scales: two observations close in time are more similar to each other than our model predicts. Conversely, those time series where the middle residuals fall below the zero line tend to have terminal residuals that fall above the line, and vice versa: at longer time scales we see negative autocorrelation in the residuals and our observations are less similar to each other than our model predicts.</p>
<p>A way to visualise these issues more clearly is to think about the correlations we see in our data between observations made on the same chicks at different times, and compare these to what the model predicts. In the previous section I gave the equation for the how the variance due to the <span class="math inline">\(\texttt{Chick}\)</span> effects changes over <span class="math inline">\(\texttt{Time}\)</span> (Equation <a href="cont-int.html#eq:Vrr">(6.2)</a>). This was a special case of the more general equation for the covariance in <span class="math inline">\(\texttt{weight}\)</span> between ages <span class="math inline">\(\texttt{Time}_1\)</span> and <span class="math inline">\(\texttt{Time}_2\)</span> due to <span class="math inline">\(\texttt{Chick}\)</span> effects:<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a></p>
<p><span class="math display" id="eq:Crr">\[
\begin{array}{rl}
\textrm{Cov}(\texttt{weight}_1, \texttt{weight}_2)=&amp;\textrm{Cov}(u^{(0)}+u^{(1)}\texttt{Time}_1, u^{(0)}+u^{(1)}\texttt{Time}_2)\\
                                         =&amp;\sigma^2_{\texttt{(Intercept)}}+(\texttt{Time}_1+\texttt{Time}_2)\sigma_{\texttt{(Intercept)}, \texttt{Time}}+\texttt{Time}_1\texttt{Time}_2\sigma^2_{\texttt{Time}}\\
\end{array}
\label{Crr-eq}   \tag{6.3}
\]</span></p>
<p>Because we can conceptualise the random regression in terms of the covariance between observations, rather than in terms of intercepts, slopes, and so on, random regression models are sometimes known as covariance function models.</p>
<p>We can use the function <span class="math inline">\(\texttt{buildV}\)</span> to obtain the expected (co)variances in our data due to the random effects we choose to marginalise and the residuals. The default is to marginalise all random effects which will give us the covariances due to both chick effects and residuals:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="cont-int.html#cb215-1" tabindex="-1"></a>theoreticalC<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">buildV</span>(mweight<span class="fl">.3</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Note that we need to specify <code>diag=FALSE</code>. This returns an <span class="math inline">\(n\times n\)</span> (sparse) covariance matrix for the data-frame, where <span class="math inline">\(n\)</span> is the number of observations (578 in this case). Since we are assuming that the covariance structure for each chick is the same, we can just extract the covariance structure for the first chick (which has a complete time series of 12 observations)<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>. We can also turn the <span class="math inline">\(12\times 12\)</span> covariance matrix into a correlation matrix since we have already assessed how well the model does at predicting the scale of the observations (Figure <a href="cont-int.html#fig:pred-int2">6.7</a>).</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="cont-int.html#cb216-1" tabindex="-1"></a>theoreticalC<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">cov2cor</span>(theoreticalC<span class="fl">.3</span>[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>])</span></code></pre></div>
<p>This is a matrix of expected correlations in weights at different ages after controlling for the fixed effect part of the model. To obtain the observed correlations, we need to calculate the correlation in the deviations of the chick’s weights from their predicted values. Note that these predicted values should be based on the fixed effect part of the model only, and the chick effects need to be marginalised (the default for <span class="math inline">\(\texttt{predict}\)</span>).</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="cont-int.html#cb217-1" tabindex="-1"></a>ChickWeight<span class="sc">$</span>marginal.resid <span class="ot">&lt;-</span> <span class="fu">c</span>(ChickWeight<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">predict</span>(mweight<span class="fl">.3</span>))</span></code></pre></div>
<p>I will refer to these as marginal residuals to distinguish them from the residual plotted in Figure <a href="cont-int.html#fig:CWresid">6.9</a> which include the chick effects in the prediction. We can reshape <span class="math inline">\(\texttt{ChickWeight}\)</span> into wide format where each row is a chick and the marginal residuals at different ages are columns:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="cont-int.html#cb218-1" tabindex="-1"></a>chick.wide <span class="ot">&lt;-</span> <span class="fu">reshape</span>(ChickWeight[, <span class="fu">c</span>(<span class="st">&quot;marginal.resid&quot;</span>, <span class="st">&quot;Chick&quot;</span>, <span class="st">&quot;Time&quot;</span>)], <span class="at">v.names =</span> <span class="st">&quot;marginal.resid&quot;</span>,</span>
<span id="cb218-2"><a href="cont-int.html#cb218-2" tabindex="-1"></a>    <span class="at">idvar =</span> <span class="st">&quot;Chick&quot;</span>, <span class="at">timevar =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;wide&quot;</span>)</span>
<span id="cb218-3"><a href="cont-int.html#cb218-3" tabindex="-1"></a><span class="fu">head</span>(chick.wide[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
<pre><code>##    Chick marginal.resid.0 marginal.resid.2 marginal.resid.4 marginal.resid.6
## 1      1        1.5674476         3.159771        2.1776546       -3.3789029
## 13     2       -0.4325524         1.159771        1.1776546        4.6210971
## 25     3        2.5674476        -8.840229       -1.8223454       -0.3789029
## 37     4        1.5674476         1.159771       -0.8223454       -0.3789029
## 49     5        0.5674476        -5.840229       -8.8223454       -7.3789029
## 61     6        0.5674476         1.159771        2.1776546        6.6210971</code></pre>
<p>From this we can calculate the observed <span class="math inline">\(12\times 12\)</span> correlation in the marginal residuals.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="cont-int.html#cb220-1" tabindex="-1"></a>empiricalC <span class="ot">&lt;-</span> <span class="fu">cor</span>(chick.wide[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">use =</span> <span class="st">&quot;pairwise.complete.obs&quot;</span>)</span></code></pre></div>
<p>Note that we needed to specify <code>use="pairwise.complete.obs"</code> because some chicks have missing values at later times, presumably because they died - an issue I will return to in Section <a href="#missing-sec"><strong>??</strong></a>. The theoretical and observed correlations are shown in blue and black respectively (Widget 6.1)</p>
<div id="rgl64281" style="width:672px;height:480px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl64281-aria"></div>
<script type="application/json" data-for="rgl64281">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":1,"objects":{"45":{"id":45,"type":"surface","material":{"front":"lines","back":"lines"},"vertices":"0","colors":"2","dim":[[12,12]],"centers":"3","normals":"1","ignoreExtent":false,"flipped":true,"flags":32771},"47":{"id":47,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"4","colors":"5","texts":[["Time 1"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"6","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"48":{"id":48,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"7","colors":"8","texts":[["Time 2"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"9","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"49":{"id":49,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"10","colors":"11","texts":[["correlation"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"12","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"50":{"id":50,"type":"surface","material":{},"vertices":"13","colors":"15","dim":[[12,12]],"centers":"16","normals":"14","ignoreExtent":false,"flipped":true,"flags":32771},"5":{"id":5,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"7":{"id":7,"type":"background","material":{"lit":false,"back":"lines"},"colors":"17","centers":"18","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"46":{"id":46,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"19","colors":"20","axes":{"mode":["pretty","pretty","pretty"],"step":[5,5,0.5],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"1":{"id":1,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":1,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,64.68098449707031],"modelMatrix":[[0.8172324299812317,0,0,-8.580940246582031],[0,0.279509961605072,6.393783092498779,-4.409276008605957],[0,-0.767947256565094,2.327146768569946,-57.15418243408203],[0,0,0,1]],"projMatrix":[[3.732050895690918,0,0,0],[0,3.732050895690918,0,0],[0,0,-3.863702774047852,-233.1674499511719],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[0.8172324299812317,0.8172324299812317,6.804121971130371],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[0,21,0,21,-0.5387951731681824,1],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NA","activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[7,46,45,47,48,49,50,5],"subscenes":[],"flags":34067}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":121,"type":"VEC3"},{"bufferView":4,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":5,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":6,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":7,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":8,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":9,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":10,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":11,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":12,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":13,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":14,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":15,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":16,"componentType":5126,"count":121,"type":"VEC3"},{"bufferView":17,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":18,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":19,"componentType":5126,"count":14,"type":"VEC3"},{"bufferView":20,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":1728,"byteOffset":0},{"buffer":0,"byteLength":1728,"byteOffset":1728},{"buffer":0,"byteLength":4,"byteOffset":3456},{"buffer":0,"byteLength":1452,"byteOffset":3460},{"buffer":0,"byteLength":12,"byteOffset":4912},{"buffer":0,"byteLength":4,"byteOffset":4924},{"buffer":0,"byteLength":12,"byteOffset":4928},{"buffer":0,"byteLength":12,"byteOffset":4940},{"buffer":0,"byteLength":4,"byteOffset":4952},{"buffer":0,"byteLength":12,"byteOffset":4956},{"buffer":0,"byteLength":12,"byteOffset":4968},{"buffer":0,"byteLength":4,"byteOffset":4980},{"buffer":0,"byteLength":12,"byteOffset":4984},{"buffer":0,"byteLength":1728,"byteOffset":4996},{"buffer":0,"byteLength":1728,"byteOffset":6724},{"buffer":0,"byteLength":4,"byteOffset":8452},{"buffer":0,"byteLength":1452,"byteOffset":8456},{"buffer":0,"byteLength":4,"byteOffset":9908},{"buffer":0,"byteLength":3,"byteOffset":9912},{"buffer":0,"byteLength":168,"byteOffset":9916},{"buffer":0,"byteLength":4,"byteOffset":10084}],"buffers":[{"byteLength":10088,"bytes":"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"}]},"context":{"shiny":false,"rmarkdown":"bookdown::gitbook"},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    // Simulate two-sided lighting\n    if (n.z < 0.0)\n      n = -n;\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i]) {\n        if (finite[i]) {\n          lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n        } else {\n          lightdir = (mvMatrix * vec4(lightdir, 0.)).xyz;\n        }\n      }\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, luminance);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*luminance);\n#endif\n \n#endif // TEXTURE_alpha\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true},"fastTransparency":true},"evals":[],"jsHooks":[]}</script>
Widget 6.1: In black (wire-frame) are the correlations in the marginal residuals of weight over <span class="math inline">\(\texttt{Time}\)</span>. In blue (solid) is the predicted correlations from a model with random chick intercept and slopes and a residual variance that is assumed to change with the square of <span class="math inline">\(\texttt{Time}\)</span>.
<details>
<summary>
See code
</summary>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="cont-int.html#cb221-1" tabindex="-1"></a><span class="fu">persp3d</span>(<span class="at">x =</span> <span class="fu">unique</span>(ChickWeight<span class="sc">$</span>Time), <span class="at">y =</span> <span class="fu">unique</span>(ChickWeight<span class="sc">$</span>Time), <span class="at">z =</span> empiricalC,</span>
<span id="cb221-2"><a href="cont-int.html#cb221-2" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Time 1&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Time 2&quot;</span>, <span class="at">zlab =</span> <span class="st">&quot;correlation&quot;</span>, <span class="at">aspect =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb221-3"><a href="cont-int.html#cb221-3" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">front =</span> <span class="st">&quot;lines&quot;</span>, <span class="at">back =</span> <span class="st">&quot;lines&quot;</span>, <span class="at">diagonal =</span> <span class="st">&quot;back&quot;</span>)</span>
<span id="cb221-4"><a href="cont-int.html#cb221-4" tabindex="-1"></a><span class="fu">persp3d</span>(<span class="at">x =</span> <span class="fu">unique</span>(ChickWeight<span class="sc">$</span>Time), <span class="at">y =</span> <span class="fu">unique</span>(ChickWeight<span class="sc">$</span>Time), <span class="at">z =</span> theoreticalC<span class="fl">.3</span>,</span>
<span id="cb221-5"><a href="cont-int.html#cb221-5" tabindex="-1"></a>    <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
</details>
<p><br></p>
<p>The diagonal ridge has a height of one: observations are perfectly correlated with themselves. Close to the ridge, the observed correlations are larger than that predicted (the red wire-frame is above the blue surface) particularly at later ages. This indicates that the autocorrelation is stronger than our model predicts over short time-scales. As we move further away from the ridge the observed correlations becomes smaller than our predicted correlations indicating that the autocorrelation is weaker than our model predicts at medium time-scales. Finally, the model is very poor at predicting the correlation between the weight at hatching and the weights at all other values of <span class="math inline">\(\texttt{Time}\)</span>: the observed correlation starts off strong and eventually becomes weakly negative, whereas the predicted correlation quickly drops to very negative values.</p>
<p>Three dimensional plots can be confusing. We can also plot the correlations between the marginal residuals at a specific time-point (<span class="math inline">\(\texttt{Time 1}\)</span>) and all others. These plots are sometimes referred to as variograms. In Figure <a href="cont-int.html#fig:ar-2d">6.10</a> we have the empirical correlations as black circles and the theoretical correlations as either red lines (model <code>mweight.2</code> with constant variance) or blue lines (model <code>mweight.3</code> as shown in Widget 6.1). The three panels show the correlations between the marginal residuals at each of the 12 time-points against the weight at hatching (<span class="math inline">\(\texttt{Time 1}=0\)</span> - left), the mid-point (<span class="math inline">\(\texttt{Time 1}=10\)</span> - middle) or the end (<span class="math inline">\(\texttt{Time 1}=21\)</span> - right). The discrepancies between the model and the data are quite striking, particularly for the hatching weights (<span class="math inline">\(\texttt{Time 1}=0\)</span>) where the model predicts very strong negative correlations which are much more modest in reality. In addition, in all panels there is a discontinuity for the theoretical correlations when <span class="math inline">\(\texttt{Time 1}=\texttt{Time 2}\)</span>, whereas empirically, the correlations go much more smoothly to one as <span class="math inline">\(\texttt{Time 1}=\texttt{Time 2}\)</span>. This discontinuity is due to the residual terms <code>us(Time):units</code> and <code>units</code> which contribute to the variance (i.e. the covariance when <span class="math inline">\(\texttt{Time 1}=\texttt{Time 2}\)</span>), but not the covariance/correlations between different values of <span class="math inline">\(\texttt{Time}\)</span> (i.e. the covariance when <span class="math inline">\(\texttt{Time 1}\neq\texttt{Time 2}\)</span>). In the geostatistical literature this is often referred to as the ‘nugget effect’ and is visible in Widget 6.1 by viewing from the origin.</p>
<div class="figure"><span style="display:block;" id="fig:ar-2d"></span>
<img src="_bookdown_files/fig/ar-2d-1.png" alt="Correlations between the marginal residuals for weight at each of the 12 time-points against the marginal residuals at hatching ($\texttt{Time 1}=0$ - left), the mid-point ($\texttt{Time 1}=10$ - middle) or the end ($\texttt{Time 1}=21$ - right). The lines are the theoretical predictions from a random-intercept slope model (red) and a random-intercept slope model that allows the residual variance to change with $\texttt{Time}$ (blue)." width="864" />
<p class="caption">
Figure 6.10: Correlations between the marginal residuals for weight at each of the 12 time-points against the marginal residuals at hatching (<span class="math inline">\(\texttt{Time 1}=0\)</span> - left), the mid-point (<span class="math inline">\(\texttt{Time 1}=10\)</span> - middle) or the end (<span class="math inline">\(\texttt{Time 1}=21\)</span> - right). The lines are the theoretical predictions from a random-intercept slope model (red) and a random-intercept slope model that allows the residual variance to change with <span class="math inline">\(\texttt{Time}\)</span> (blue).
</p>
</div>
<p>In my experience, random-regression models are rarely conceptualised in terms of covariance functions. This makes sense - the model is constructed in terms of process, and thinking about variation in growth rate (i.e <span class="math inline">\(\sigma^2_\texttt{Time}\)</span>) is much more intuitive than thinking about how variation in growth rate translates into patterns of correlation in the data. Nevertheless, if a random regression model does not capture the correlations in the data well, then any conclusions from the model have to be taken with caution. When people think directly about modelling patterns of correlation in the data, they are often thinking about auto-regressive models. These models often do a better job at modelling any correlation structure in the data, and we will cover them in Section <a href="path.html#ante-sec">10.2</a>. First, lets see if we can solve some of our problems more easily.</p>
</div>
<div id="vstab-sec" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Variance stabilisation<a href="cont-int.html#vstab-sec" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The variance in chick weight increases dramatically with <span class="math inline">\(\texttt{Time}\)</span> and it requires effort to understand how this aspect of the data is captured by random-regression models. We also saw that while modelling the change in variance accurately improved our models ability to capture general features of the data, it did compromise our ability to predict some aspects, such as the predicted means. In addition to the variance, the mean chick weight also increased dramatically in time, but we managed to model this fairly intuitively by fitting <span class="math inline">\(\texttt{Time}\)</span> and <span class="math inline">\(\texttt{Time}^2\)</span> in the fixed effect formula.</p>
<p>Let’s start by plotting the means and standard deviations for each <span class="math inline">\(\texttt{Time}\)</span> (Figure <a href="cont-int.html#fig:m-sd">6.11</a>).</p>
<div class="figure"><span style="display:block;" id="fig:m-sd"></span>
<img src="_bookdown_files/fig/m-sd-1.png" alt="Standard deviation of chick weight against the mean over $\texttt{Time}$" width="672" />
<p class="caption">
Figure 6.11: Standard deviation of chick weight against the mean over <span class="math inline">\(\texttt{Time}\)</span>
</p>
</div>
<p>A remarkably tight and linear relationship. A linear relationship between the standard deviation and the mean, or the variance and the square of the mean, is often the hall-mark of a multiplicative process - chick don’t add <span class="math inline">\(x\)</span> grams to their weight per unit time, they increase their weight be <span class="math inline">\(x\)</span>% per unit time. Log transforming the outcome of a multiplicative process makes it additive and very often reduces, or even eliminates, any relationship between the mean and variance. Let’s fit our three models that have random intercepts (<code>mlweight.1</code>), random intercepts and slopes (<code>mlweight.2</code>) and random intercepts and slopes and with the residual variance allowed to increase with <span class="math inline">\(\texttt{Time}\)</span> (<code>mlweight.3</code>).</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="cont-int.html#cb222-1" tabindex="-1"></a>prior.lweight <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">IW</span>(<span class="dv">1</span>, <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">F</span>(<span class="dv">2</span>, <span class="dv">1000</span>))</span>
<span id="cb222-2"><a href="cont-int.html#cb222-2" tabindex="-1"></a>mlweight<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span>Chick,</span>
<span id="cb222-3"><a href="cont-int.html#cb222-3" tabindex="-1"></a>    <span class="at">data =</span> ChickWeight, <span class="at">prior =</span> prior.lweight)</span>
<span id="cb222-4"><a href="cont-int.html#cb222-4" tabindex="-1"></a>mlweight<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb222-5"><a href="cont-int.html#cb222-5" tabindex="-1"></a>    Time)<span class="sc">:</span>Chick, <span class="at">data =</span> ChickWeight, <span class="at">prior =</span> prior.lweight)</span>
<span id="cb222-6"><a href="cont-int.html#cb222-6" tabindex="-1"></a>mlweight<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb222-7"><a href="cont-int.html#cb222-7" tabindex="-1"></a>    Time)<span class="sc">:</span>Chick <span class="sc">+</span> <span class="fu">us</span>(Time)<span class="sc">:</span>units, <span class="at">data =</span> ChickWeight, <span class="at">prior =</span> prior.lweight, <span class="at">longer =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>Using the work-flow used in previous sections, we can first look to see how well these models capture any change in the mean and variance in weight over <span class="math inline">\(\texttt{Time}\)</span> (Figure <a href="cont-int.html#fig:pred-int3">6.12</a>).</p>
<div class="figure"><span style="display:block;" id="fig:pred-int3"></span>
<img src="_bookdown_files/fig/pred-int3-1.png" alt="Log chick weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The black line is for a random intercept model (`mlweight.1`) that implicitly assumes the variance is constant over $\texttt{Time}$.  The red line is for a random intercept-slope model (`mlweight.2`) that allows the variance across chicks to change as a quadratic function of $\texttt{Time}$. The blue line is also for a random intercept-slope model (`mlweight.3`) but the residual variance has been allowed to change with the square of $\texttt{Time}$." width="672" />
<p class="caption">
Figure 6.12: Log chick weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The black line is for a random intercept model (<code>mlweight.1</code>) that implicitly assumes the variance is constant over <span class="math inline">\(\texttt{Time}\)</span>. The red line is for a random intercept-slope model (<code>mlweight.2</code>) that allows the variance across chicks to change as a quadratic function of <span class="math inline">\(\texttt{Time}\)</span>. The blue line is also for a random intercept-slope model (<code>mlweight.3</code>) but the residual variance has been allowed to change with the square of <span class="math inline">\(\texttt{Time}\)</span>.
</p>
</div>
<p>While the log-transform hasn’t stabilised the variance with respect to <span class="math inline">\(\texttt{Time}\)</span> or the mean, the change in variance is much less dramatic than it was on the artithemtic scale. The model with only random intercepts assumes constant variance which is not well supported. The two random intercept-slope models give almost identical predictions and capture the change in variance reasonably well, although the variance at hatching remains smaller than the model predicts. The two models are very similar because model <code>mlweight.3</code> predicts that the increase in variance with <span class="math inline">\(\texttt{Time}\)</span> can be attributed almost completely to variation in growth rate (<span class="math inline">\(\sigma^2_\texttt{Time:units}\)</span> is very small) unlike our conclusions from the model on the raw weights, <code>mweight.3</code>. Allowing the residual variance to change as a function of <span class="math inline">\(\texttt{Time}\)</span> has hardly any impact on our estimate of the variance in growth rate (<span class="math inline">\(\sigma^2_\texttt{Time}\)</span>) - it has only decreased by 2.4%, rather than the 56.9% decrease we saw on the arithmetic scale.</p>
<p>The random intercept-slope models also do a better job at capturing the correlations in the data with a reasonable alignment between the empirical correlations and the estimated correlation function (Figure <a href="#fig:ar-rgl-l"><strong>??</strong></a>).</p>
<div id="rgl68596" style="width:672px;height:480px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl68596-aria"></div>
<script type="application/json" data-for="rgl68596">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":1,"objects":{"58":{"id":58,"type":"surface","material":{"front":"lines","back":"lines"},"vertices":"0","colors":"2","dim":[[12,12]],"centers":"3","normals":"1","ignoreExtent":false,"flipped":true,"flags":32771},"60":{"id":60,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"4","colors":"5","texts":[["Time 1"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"6","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"61":{"id":61,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"7","colors":"8","texts":[["Time 2"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"9","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"62":{"id":62,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"10","colors":"11","texts":[["correlation"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"12","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"63":{"id":63,"type":"surface","material":{"alpha":0.8980392217636108,"isTransparent":true},"vertices":"13","colors":"15","dim":[[12,12]],"centers":"16","normals":"14","ignoreExtent":false,"flipped":true,"flags":32811},"5":{"id":5,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"7":{"id":7,"type":"background","material":{"lit":false,"back":"lines"},"colors":"17","centers":"18","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"59":{"id":59,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"19","colors":"20","axes":{"mode":["pretty","pretty","pretty"],"step":[5,5,0.2000000029802322],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"1":{"id":1,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":1,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,64.01522827148438],"modelMatrix":[[0.8171154260635376,0,0,-8.5797119140625],[0,0.2794699370861053,6.971421241760254,-5.314716815948486],[0,-0.7678373456001282,2.537389755249023,-56.81929016113281],[0,0,0,1]],"projMatrix":[[3.732050895690918,0,0,0],[0,3.732050895690918,0,0],[0,0,-3.863703489303589,-230.7675018310547],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[0.8171154260635376,0.8171154260635376,7.418831348419189],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[0,21,0,21,-0.3171314299106598,1],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NA","activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[7,59,58,60,61,62,63,5],"subscenes":[],"flags":34107}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":121,"type":"VEC3"},{"bufferView":4,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":5,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":6,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":7,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":8,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":9,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":10,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":11,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":12,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":13,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":14,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":15,"componentType":5126,"count":1,"type":"VEC4"},{"bufferView":16,"componentType":5126,"count":121,"type":"VEC3"},{"bufferView":17,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":18,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":19,"componentType":5126,"count":17,"type":"VEC3"},{"bufferView":20,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":1728,"byteOffset":0},{"buffer":0,"byteLength":1728,"byteOffset":1728},{"buffer":0,"byteLength":4,"byteOffset":3456},{"buffer":0,"byteLength":1452,"byteOffset":3460},{"buffer":0,"byteLength":12,"byteOffset":4912},{"buffer":0,"byteLength":4,"byteOffset":4924},{"buffer":0,"byteLength":12,"byteOffset":4928},{"buffer":0,"byteLength":12,"byteOffset":4940},{"buffer":0,"byteLength":4,"byteOffset":4952},{"buffer":0,"byteLength":12,"byteOffset":4956},{"buffer":0,"byteLength":12,"byteOffset":4968},{"buffer":0,"byteLength":4,"byteOffset":4980},{"buffer":0,"byteLength":12,"byteOffset":4984},{"buffer":0,"byteLength":1728,"byteOffset":4996},{"buffer":0,"byteLength":1728,"byteOffset":6724},{"buffer":0,"byteLength":16,"byteOffset":8452},{"buffer":0,"byteLength":1452,"byteOffset":8468},{"buffer":0,"byteLength":4,"byteOffset":9920},{"buffer":0,"byteLength":3,"byteOffset":9924},{"buffer":0,"byteLength":204,"byteOffset":9928},{"buffer":0,"byteLength":4,"byteOffset":10132}],"buffers":[{"byteLength":10136,"bytes":"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"}]},"context":{"shiny":false,"rmarkdown":"bookdown::gitbook"},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    // Simulate two-sided lighting\n    if (n.z < 0.0)\n      n = -n;\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i]) {\n        if (finite[i]) {\n          lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n        } else {\n          lightdir = (mvMatrix * vec4(lightdir, 0.)).xyz;\n        }\n      }\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, luminance);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*luminance);\n#endif\n \n#endif // TEXTURE_alpha\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true},"fastTransparency":true},"evals":[],"jsHooks":[]}</script>
<p>Widget 6.2: In black (wire-frame) are the correlations in the marginal residuals of log weight over <span class="math inline">\(\texttt{Time}\)</span>. In blue (solid) is the predicted correlations from a model with random chick intercept and slopes and a residual variance that is assumed to change with the square of <span class="math inline">\(\texttt{Time}\)</span>.<br></p>
<p>Looking at the correlations across a subset of time points also shows reasonable alignment, and highlights that allowing the residual variance to change with <span class="math inline">\(\texttt{time}\)</span> (the blue lines) is unnecessary on the log-scale (Figure <a href="#fig:ar-2d-1"><strong>??</strong></a>).</p>
<div class="figure"><span style="display:block;" id="fig:ar-2d-l"></span>
<img src="_bookdown_files/fig/ar-2d-l-1.png" alt="Correlations between the marginal residuals for log weight at each of the 12 time-points against the marginal residuals at hatching ($\texttt{Time 1}=0$ - left), the mid-point ($\texttt{Time 1}=10$ - middle) or the end ($\texttt{Time 1}=21$ - right). The lines are the theoretical predictions from a random-intercept slope model (red) and a random-intercept slope model that allows the residual variance to change with $\texttt{Time}$ (blue)." width="864" />
<p class="caption">
Figure 6.13: Correlations between the marginal residuals for log weight at each of the 12 time-points against the marginal residuals at hatching (<span class="math inline">\(\texttt{Time 1}=0\)</span> - left), the mid-point (<span class="math inline">\(\texttt{Time 1}=10\)</span> - middle) or the end (<span class="math inline">\(\texttt{Time 1}=21\)</span> - right). The lines are the theoretical predictions from a random-intercept slope model (red) and a random-intercept slope model that allows the residual variance to change with <span class="math inline">\(\texttt{Time}\)</span> (blue).
</p>
</div>
<p>Despite the improvement, there still remains some discrepancy between the observed and predicted correlations, so let’s see if we can improve the model.</p>
</div>
<div id="antedependence-and-autoregressive-models" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Antedependence and Autoregressive Models<a href="cont-int.html#antedependence-and-autoregressive-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Antedependence models offer a flexible way of modelling relationships between time-ordered variables and include autoregressive models as a special case. They can be applied to (time) ordered random effects or ordered residuals, but lets focus on the residual structure here. In the previous section, we designated <span class="math inline">\(\texttt{unit}\)</span> effects as <span class="math inline">\(e\)</span>’s and superscripted them with <span class="math inline">\((0)\)</span> or <span class="math inline">\((1)\)</span> depending on whether it was the intercept (specified through <code>rcov=~units</code>) or the slope (specified through <code>random=~us(Time):units</code>). Here we will break with this notation and use the notation <span class="math inline">\(e^{(1)}\)</span>, <span class="math inline">\(e^{(2)}\)</span> … <span class="math inline">\(e^{(T)}\)</span> to designate the residuals for a set of <span class="math inline">\(T\)</span> observations belonging to a time-series. For our analyses of chick weight <span class="math inline">\(T=12\)</span>. The time series is initiated at <span class="math inline">\(t=1\)</span> and we will say</p>
<p><span class="math display">\[e^{(1)} = \epsilon^{(1)}\]</span></p>
<p>where <span class="math inline">\(\epsilon^{(1)}\)</span> is drawn from a normal distribution with a mean of zero and a variance <span class="math inline">\(\sigma^2_{\epsilon^{(1)}}\)</span>. With one observation we’ve simply redefined the residual, which isn’t very interesting. However, for the second residual we will say</p>
<p><span class="math display">\[e^{(2)} = \beta_{2|1}e^{(1)}+\epsilon^{(2)}\]</span></p>
<p>where <span class="math inline">\(\beta_{2|1}\)</span> is the regression coefficient of <span class="math inline">\(e^{(2)}\)</span> on <span class="math inline">\(e^{(1)}\)</span> and <span class="math inline">\(\epsilon^{(2)}\)</span> is drawn from a normal distribution with a mean of zero and a variance <span class="math inline">\(\sigma^2_{\epsilon^{(2)}}\)</span>. For the third residual we will say</p>
<p><span class="math display">\[e^{(3)} = \beta_{3|1}e^{(1)}+\beta_{3|2}e^{(2)}+\epsilon^{(3)}\]</span></p>
<p>Essentially, we are building a series of nested multiple regressions, where each variable is regressed on all previous values. The residual variances of these regressions - the variances of the <span class="math inline">\(\epsilon\)</span>’s - are referred to as the innovation variances as they add new variation into the time series. For <span class="math inline">\(T\)</span> variables there are <span class="math inline">\(T(T-1)/2\)</span> regression parameters and <span class="math inline">\(T\)</span> innovations variances. If we put no constraints on these parameters and estimated all <span class="math inline">\(T(T+1)/2\)</span> of them, we would be estimating a fully unstructured covariance matrix, as specified by <code>us</code>, albeit using a different parameterisation. The trick, of course, is to impose sensible constraints.</p>
<p>Let’s write each equation in reverse order and put them all together</p>
<p><span class="math display">\[
\begin{array}{r lc cc cc  cc cc}
e^{(1)} =&amp;\epsilon^{(1)}&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;\\
e^{(2)} =&amp;\epsilon^{(2)}&amp;+&amp;\beta_{2|1}e^{(1)}&amp;&amp;&amp;&amp;&amp;&amp;&amp;\\
e^{(3)} =&amp;\epsilon^{(3)}&amp;+&amp;\beta_{3|2}e^{(2)}&amp;+&amp;\beta_{3|1}e^{(1)}&amp;&amp;&amp;&amp;&amp;\\
e^{(3)} =&amp;\epsilon^{(4)}&amp;+&amp;\beta_{4|3}e^{(3)}&amp;+&amp;\beta_{4|2}e^{(2)}&amp;+&amp;\beta_{4|1}e^{(1)}&amp;&amp;&amp;\\
e^{(5)} =&amp;\epsilon^{(5)}&amp;+&amp;\beta_{5|4}e^{(4)}&amp;+&amp;\beta_{5|3}e^{(3)}&amp;+&amp;\beta_{5|2}e^{(2)}&amp;+&amp;\beta_{5|1}e^{(1)}\\
\end{array}
\]</span></p>
<p>One obvious set of constraints would be to set some of the regression coefficients to zero.</p>
<p>The first column are the innovations. One possible constraint is that their variances are all the same and so we only have to estimate a single innovation variance (<span class="math inline">\(\sigma^2_\epsilon\)</span>), rather than <span class="math inline">\(T\)</span> of them.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="cont-int.html#cb223-1" tabindex="-1"></a>prior.lweight<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">1</span>), <span class="at">nu =</span> <span class="fl">0.002</span>, <span class="at">beta.mu =</span> <span class="dv">0</span>, <span class="at">beta.V =</span> <span class="dv">10000</span>),</span>
<span id="cb223-2"><a href="cont-int.html#cb223-2" tabindex="-1"></a>    <span class="at">G =</span> <span class="fu">F</span>(<span class="dv">2</span>, <span class="dv">10000</span>))</span>
<span id="cb223-3"><a href="cont-int.html#cb223-3" tabindex="-1"></a></span>
<span id="cb223-4"><a href="cont-int.html#cb223-4" tabindex="-1"></a></span>
<span id="cb223-5"><a href="cont-int.html#cb223-5" tabindex="-1"></a>mlweight<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> Diet<span class="sc">:</span>Time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb223-6"><a href="cont-int.html#cb223-6" tabindex="-1"></a>    Time)<span class="sc">:</span>Chick, <span class="at">rcov =</span> <span class="sc">~</span><span class="fu">antec1v</span>(<span class="fu">as.factor</span>(Time))<span class="sc">:</span>Chick, <span class="at">data =</span> ChickWeight, <span class="at">prior =</span> prior.lweight<span class="fl">.4</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pred-int4"></span>
<img src="_bookdown_files/fig/pred-int4-1.png" alt="Chick log weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The red line is for a random intercept-slope model (`mlweight.2`) with identically and indepedently distributed residuals. The green line is for a random intercept-slope model (`mlweight.2`) with residuals modelled using an antedependence structure" width="672" />
<p class="caption">
Figure 6.14: Chick log weights plotted against time with predicted mean weight (solid lines) and 95% predictions intervals (dashed line). The red line is for a random intercept-slope model (<code>mlweight.2</code>) with identically and indepedently distributed residuals. The green line is for a random intercept-slope model (<code>mlweight.2</code>) with residuals modelled using an antedependence structure
</p>
</div>
<div id="rgl15479" style="width:672px;height:480px;" class="rglWebGL html-widget" role="img" aria-labelledby="rgl15479-aria"></div>
<script type="application/json" data-for="rgl15479">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmode":"modulate","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false,"tag":"","blend":["src_alpha","one_minus_src_alpha"]},"rootSubscene":1,"objects":{"71":{"id":71,"type":"surface","material":{"front":"lines","back":"lines"},"vertices":"0","colors":"2","dim":[[12,12]],"centers":"3","normals":"1","ignoreExtent":false,"flipped":true,"flags":32771},"73":{"id":73,"type":"text","material":{"lit":false,"margin":0,"floating":true,"edge":[0,1,1]},"vertices":"4","colors":"5","texts":[["Time 1"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"6","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"74":{"id":74,"type":"text","material":{"lit":false,"margin":1,"floating":true,"edge":[1,1,1]},"vertices":"7","colors":"8","texts":[["Time 2"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"9","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"75":{"id":75,"type":"text","material":{"lit":false,"margin":2,"floating":true,"edge":[1,1,1]},"vertices":"10","colors":"11","texts":[["correlation"]],"cex":[[1]],"adj":[[0.5,0.5,0.5]],"centers":"12","family":[["sans"]],"font":[[1]],"ignoreExtent":true,"flags":33808},"76":{"id":76,"type":"surface","material":{"alpha":0.8980392217636108,"isTransparent":true},"vertices":"13","colors":"15","dim":[[12,12]],"centers":"16","normals":"14","ignoreExtent":false,"flipped":true,"flags":32811},"5":{"id":5,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"7":{"id":7,"type":"background","material":{"lit":false,"back":"lines"},"colors":"17","centers":"18","sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"72":{"id":72,"type":"bboxdeco","material":{"front":"lines","back":"lines"},"vertices":"19","colors":"20","axes":{"mode":["pretty","pretty","pretty"],"step":[5,5,0.2000000029802322],"nticks":[5,5,5],"marklen":[15,15,15],"expand":[1.029999971389771,1.029999971389771,1.029999971389771]},"draw_front":true,"flags":32769},"1":{"id":1,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":1,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,62.98154449462891],"modelMatrix":[[0.8170838952064514,0,0,-8.579380989074707],[0,0.279459148645401,7.155655860900879,-6.058986663818359],[0,-0.7678077220916748,2.604445934295654,-56.05684661865234],[0,0,0,1]],"projMatrix":[[3.732050895690918,0,0,0],[0,3.732050895690918,0,0],[0,0,-3.863703727722168,-227.0411987304688],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.3420201433256682,0.9396926207859085,0],[0,-0.9396926207859085,0.3420201433256682,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[0.8170838952064514,0.8170838952064514,7.614890098571777],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[0,21,0,21,-0.1266585886478424,1],"windowRect":[0,0,256,256],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NA","activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[7,72,71,73,74,75,76,5],"subscenes":[],"flags":34107}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":672,"height":480,"buffer":{"accessors":[{"bufferView":0,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":1,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":2,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":3,"componentType":5126,"count":121,"type":"VEC3"},{"bufferView":4,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":5,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":6,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":7,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":8,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":9,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":10,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":11,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":12,"componentType":5126,"count":1,"type":"VEC3"},{"bufferView":13,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":14,"componentType":5126,"count":144,"type":"VEC3"},{"bufferView":15,"componentType":5126,"count":1,"type":"VEC4"},{"bufferView":16,"componentType":5126,"count":121,"type":"VEC3"},{"bufferView":17,"componentType":5121,"count":1,"type":"VEC4"},{"bufferView":18,"componentType":5121,"count":1,"type":"VEC3"},{"bufferView":19,"componentType":5126,"count":16,"type":"VEC3"},{"bufferView":20,"componentType":5121,"count":1,"type":"VEC4"}],"bufferViews":[{"buffer":0,"byteLength":1728,"byteOffset":0},{"buffer":0,"byteLength":1728,"byteOffset":1728},{"buffer":0,"byteLength":4,"byteOffset":3456},{"buffer":0,"byteLength":1452,"byteOffset":3460},{"buffer":0,"byteLength":12,"byteOffset":4912},{"buffer":0,"byteLength":4,"byteOffset":4924},{"buffer":0,"byteLength":12,"byteOffset":4928},{"buffer":0,"byteLength":12,"byteOffset":4940},{"buffer":0,"byteLength":4,"byteOffset":4952},{"buffer":0,"byteLength":12,"byteOffset":4956},{"buffer":0,"byteLength":12,"byteOffset":4968},{"buffer":0,"byteLength":4,"byteOffset":4980},{"buffer":0,"byteLength":12,"byteOffset":4984},{"buffer":0,"byteLength":1728,"byteOffset":4996},{"buffer":0,"byteLength":1728,"byteOffset":6724},{"buffer":0,"byteLength":16,"byteOffset":8452},{"buffer":0,"byteLength":1452,"byteOffset":8468},{"buffer":0,"byteLength":4,"byteOffset":9920},{"buffer":0,"byteLength":3,"byteOffset":9924},{"buffer":0,"byteLength":192,"byteOffset":9928},{"buffer":0,"byteLength":4,"byteOffset":10120}],"buffers":[{"byteLength":10124,"bytes":"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\nwH8AAMB/zcxMPwAAwH8AAMB/AACAPwAAAAE="}]},"context":{"shiny":false,"rmarkdown":"bookdown::gitbook"},"vertexShader":"#line 2 1\n// File 1 is the vertex shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\n\nattribute vec3 aPos;\nattribute vec4 aCol;\nuniform mat4 mvMatrix;\nuniform mat4 prMatrix;\nvarying vec4 vCol;\nvarying vec4 vPosition;\n\n#ifdef NEEDS_VNORMAL\nattribute vec3 aNorm;\nuniform mat4 normMatrix;\nvarying vec4 vNormal;\n#endif\n\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nattribute vec2 aTexcoord;\nvarying vec2 vTexcoord;\n#endif\n\n#ifdef FIXED_SIZE\nuniform vec3 textScale;\n#endif\n\n#ifdef FIXED_QUADS\nattribute vec3 aOfs;\n#endif\n\n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\nvarying float normz;\nuniform mat4 invPrMatrix;\n#else\nattribute vec3 aPos1;\nattribute vec3 aPos2;\nvarying float normz;\n#endif\n#endif // IS_TWOSIDED\n\n#ifdef FAT_LINES\nattribute vec3 aNext;\nattribute vec2 aPoint;\nvarying vec2 vPoint;\nvarying float vLength;\nuniform float uAspect;\nuniform float uLwd;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  \n#ifndef IS_BRUSH\n#if defined(NCLIPPLANES) || !defined(FIXED_QUADS) || defined(HAS_FOG) || defined(USE_ENVMAP)\n  vPosition = mvMatrix * vec4(aPos, 1.);\n#endif\n  \n#ifndef FIXED_QUADS\n  gl_Position = prMatrix * vPosition;\n#endif\n#endif // !IS_BRUSH\n  \n#ifdef IS_POINTS\n  gl_PointSize = POINTSIZE;\n#endif\n  \n  vCol = aCol;\n  \n// USE_ENVMAP implies NEEDS_VNORMAL\n\n#ifdef NEEDS_VNORMAL\n  vNormal = normMatrix * vec4(-aNorm, dot(aNorm, aPos));\n#endif\n\n#ifdef USE_ENVMAP\n  vReflection = normalize(reflect(vPosition.xyz/vPosition.w, \n                        normalize(vNormal.xyz/vNormal.w)));\n#endif\n  \n#ifdef IS_TWOSIDED\n#ifdef HAS_NORMALS\n  /* normz should be calculated *after* projection */\n  normz = (invPrMatrix*vNormal).z;\n#else\n  vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n  pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n  vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n  pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n  normz = pos1.x*pos2.y - pos1.y*pos2.x;\n#endif\n#endif // IS_TWOSIDED\n  \n#ifdef NEEDS_VNORMAL\n  vNormal = vec4(normalize(vNormal.xyz), 1);\n#endif\n  \n#if defined(HAS_TEXTURE) || defined(IS_TEXT)\n  vTexcoord = aTexcoord;\n#endif\n  \n#if defined(FIXED_SIZE) && !defined(ROTATING)\n  vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w;\n  gl_Position = pos + vec4(aOfs*textScale, 0.);\n#endif\n  \n#if defined(IS_SPRITES) && !defined(FIXED_SIZE)\n  vec4 pos = mvMatrix * vec4(aPos, 1.);\n  pos = pos/pos.w + vec4(aOfs,  0.);\n  gl_Position = prMatrix*pos;\n#endif\n  \n#ifdef FAT_LINES\n  /* This code was inspired by Matt Deslauriers' code in \n   https://mattdesl.svbtle.com/drawing-lines-is-hard */\n  vec2 aspectVec = vec2(uAspect, 1.0);\n  mat4 projViewModel = prMatrix * mvMatrix;\n  vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n  currentProjected = currentProjected/currentProjected.w;\n  vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n  vec2 currentScreen = currentProjected.xy * aspectVec;\n  vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n  float len = uLwd;\n  vec2 dir = vec2(1.0, 0.0);\n  vPoint = aPoint;\n  vLength = length(nextScreen - currentScreen)/2.0;\n  vLength = vLength/(vLength + len);\n  if (vLength > 0.0) {\n    dir = normalize(nextScreen - currentScreen);\n  }\n  vec2 normal = vec2(-dir.y, dir.x);\n  dir.x /= uAspect;\n  normal.x /= uAspect;\n  vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n  gl_Position = currentProjected + offset;\n#endif\n  \n#ifdef IS_BRUSH\n  gl_Position = vec4(aPos, 1.);\n#endif\n}","fragmentShader":"#line 2 2\n// File 2 is the fragment shader\n#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n#endif\nvarying vec4 vCol; // carries alpha\nvarying vec4 vPosition;\n#if defined(HAS_TEXTURE) || defined (IS_TEXT)\nvarying vec2 vTexcoord;\nuniform sampler2D uSampler;\n#endif\n\n#ifdef HAS_FOG\nuniform int uFogMode;\nuniform vec3 uFogColor;\nuniform vec4 uFogParms;\n#endif\n\n#if defined(IS_LIT) && !defined(FIXED_QUADS)\nvarying vec4 vNormal;\n#endif\n\n#if NCLIPPLANES > 0\nuniform vec4 vClipplane[NCLIPPLANES];\n#endif\n\n#if NLIGHTS > 0\nuniform mat4 mvMatrix;\n#endif\n\n#ifdef IS_LIT\nuniform vec3 emission;\nuniform float shininess;\n#if NLIGHTS > 0\nuniform vec3 ambient[NLIGHTS];\nuniform vec3 specular[NLIGHTS]; // light*material\nuniform vec3 diffuse[NLIGHTS];\nuniform vec3 lightDir[NLIGHTS];\nuniform bool viewpoint[NLIGHTS];\nuniform bool finite[NLIGHTS];\n#endif\n#endif // IS_LIT\n\n#ifdef IS_TWOSIDED\nuniform bool front;\nvarying float normz;\n#endif\n\n#ifdef FAT_LINES\nvarying vec2 vPoint;\nvarying float vLength;\n#endif\n\n#ifdef USE_ENVMAP\nvarying vec3 vReflection;\n#endif\n\nvoid main(void) {\n  vec4 fragColor;\n#ifdef FAT_LINES\n  vec2 point = vPoint;\n  bool neg = point.y < 0.0;\n  point.y = neg ? (point.y + vLength)/(1.0 - vLength) :\n                 -(point.y - vLength)/(1.0 - vLength);\n#if defined(IS_TRANSPARENT) && defined(IS_LINESTRIP)\n  if (neg && length(point) <= 1.0) discard;\n#endif\n  point.y = min(point.y, 0.0);\n  if (length(point) > 1.0) discard;\n#endif // FAT_LINES\n  \n#ifdef ROUND_POINTS\n  vec2 coord = gl_PointCoord - vec2(0.5);\n  if (length(coord) > 0.5) discard;\n#endif\n  \n#if NCLIPPLANES > 0\n  for (int i = 0; i < NCLIPPLANES; i++)\n    if (dot(vPosition, vClipplane[i]) < 0.0) discard;\n#endif\n    \n#ifdef FIXED_QUADS\n    vec3 n = vec3(0., 0., 1.);\n#elif defined(IS_LIT)\n    vec3 n = normalize(vNormal.xyz);\n#endif\n    \n#ifdef IS_TWOSIDED\n    if ((normz <= 0.) != front) discard;\n#endif\n\n#ifdef IS_LIT\n    vec3 eye = normalize(-vPosition.xyz/vPosition.w);\n    vec3 lightdir;\n    vec4 colDiff;\n    vec3 halfVec;\n    vec4 lighteffect = vec4(emission, 0.);\n    vec3 col;\n    float nDotL;\n#ifdef FIXED_QUADS\n    n = -faceforward(n, n, eye);\n#endif\n    \n#if NLIGHTS > 0\n    // Simulate two-sided lighting\n    if (n.z < 0.0)\n      n = -n;\n    for (int i=0;i<NLIGHTS;i++) {\n      colDiff = vec4(vCol.rgb * diffuse[i], vCol.a);\n      lightdir = lightDir[i];\n      if (!viewpoint[i]) {\n        if (finite[i]) {\n          lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n        } else {\n          lightdir = (mvMatrix * vec4(lightdir, 0.)).xyz;\n        }\n      }\n      if (!finite[i]) {\n        halfVec = normalize(lightdir + eye);\n      } else {\n        lightdir = normalize(lightdir - vPosition.xyz/vPosition.w);\n        halfVec = normalize(lightdir + eye);\n      }\n      col = ambient[i];\n      nDotL = dot(n, lightdir);\n      col = col + max(nDotL, 0.) * colDiff.rgb;\n      col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular[i];\n      lighteffect = lighteffect + vec4(col, colDiff.a);\n    }\n#endif\n    \n#else // not IS_LIT\n    vec4 colDiff = vCol;\n    vec4 lighteffect = colDiff;\n#endif\n    \n#ifdef IS_TEXT\n    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n#endif\n    \n#ifdef HAS_TEXTURE\n\n// These calculations use the definitions from \n// https://docs.gl/gl3/glTexEnv\n\n#ifdef USE_ENVMAP\n    float m = 2.0 * sqrt(dot(vReflection, vReflection) + 2.0*vReflection.z + 1.0);\n    vec4 textureColor = texture2D(uSampler, vReflection.xy / m + vec2(0.5, 0.5));\n#else\n    vec4 textureColor = texture2D(uSampler, vTexcoord);\n#endif\n\n#ifdef TEXTURE_rgb\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(textureColor.rgb, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*vec4(textureColor.rgb, 1.);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb, lighteffect.a);\n#endif\n\n#endif //TEXTURE_rgb\n        \n#ifdef TEXTURE_rgba\n\n#ifdef TEXMODE_replace\n// already done\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = lighteffect*textureColor;\n#endif\n\n#ifdef TEXMODE_decal\n    textureColor = vec4((1. - textureColor.a)*lighteffect.rgb) +\n                     textureColor.a*textureColor.rgb, \n                     lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - textureColor.rgb) * lighteffect.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(lighteffect.rgb + textureColor.rgb,\n                    lighteffect.a*textureColor.a);\n#endif\n    \n#endif //TEXTURE_rgba\n    \n#ifdef TEXTURE_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(lighteffect.rgb, luminance);\n#endif \n\n#if defined(TEXMODE_modulate) || defined(TEXMODE_blend) || defined(TEXMODE_add)\n    textureColor = vec4(lighteffect.rgb, lighteffect.a*luminance);\n#endif\n \n#endif // TEXTURE_alpha\n    \n// The TEXTURE_luminance values are not from that reference    \n#ifdef TEXTURE_luminance\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, lighteffect.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, lighteffect.a);\n#endif\n\n#endif // TEXTURE_luminance\n \n    \n#ifdef TEXTURE_luminance_alpha\n    float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n\n#if defined(TEXMODE_replace) || defined(TEXMODE_decal)\n    textureColor = vec4(luminance, luminance, luminance, textureColor.a);\n#endif \n\n#ifdef TEXMODE_modulate\n    textureColor = vec4(luminance*lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_blend\n    textureColor = vec4((1. - luminance)*lighteffect.rgb,\n                        textureColor.a*lighteffect.a);\n#endif\n\n#ifdef TEXMODE_add\n    textureColor = vec4(luminance + lighteffect.rgb, \n                        textureColor.a*lighteffect.a);\n\n#endif\n\n#endif // TEXTURE_luminance_alpha\n    \n    fragColor = textureColor;\n\n#elif defined(IS_TEXT)\n    if (textureColor.a < 0.1)\n      discard;\n    else\n      fragColor = textureColor;\n#else\n    fragColor = lighteffect;\n#endif // HAS_TEXTURE\n    \n#ifdef HAS_FOG\n    // uFogParms elements: x = near, y = far, z = fogscale, w = (1-sin(FOV/2))/(1+sin(FOV/2))\n    // In Exp and Exp2: use density = density/far\n    // fogF will be the proportion of fog\n    // Initialize it to the linear value\n    float fogF;\n    if (uFogMode > 0) {\n      fogF = (uFogParms.y - vPosition.z/vPosition.w)/(uFogParms.y - uFogParms.x);\n      if (uFogMode > 1)\n        fogF = mix(uFogParms.w, 1.0, fogF);\n      fogF = fogF*uFogParms.z;\n      if (uFogMode == 2)\n        fogF = 1.0 - exp(-fogF);\n      // Docs are wrong: use (density*c)^2, not density*c^2\n      // https://gitlab.freedesktop.org/mesa/mesa/-/blob/master/src/mesa/swrast/s_fog.c#L58\n      else if (uFogMode == 3)\n        fogF = 1.0 - exp(-fogF*fogF);\n      fogF = clamp(fogF, 0.0, 1.0);\n      gl_FragColor = vec4(mix(fragColor.rgb, uFogColor, fogF), fragColor.a);\n    } else gl_FragColor = fragColor;\n#else\n    gl_FragColor = fragColor;\n#endif // HAS_FOG\n    \n}","players":[],"webGLoptions":{"preserveDrawingBuffer":true},"fastTransparency":true},"evals":[],"jsHooks":[]}</script>
<p><img src="_bookdown_files/fig/ar-2d-l7-1.png" alt="" width="864" /></p>
</div>
<div id="user-defined-sec" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> User-defined Design Matrices<a href="cont-int.html#user-defined-sec" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math inline">\(\texttt{MCMCglmm}\)</span> generally uses <span class="math inline">\(\texttt{model.matrix}\)</span>, or a native equivalent, when evaluating a model formula to obtain the design matrices. Sometimes R formula syntax is not flexible enough to generate the appropriate design matrix. However, if a random-effect design matrix can be generated, it is possible to fit the model by exploiting the <span class="math inline">\(\texttt{idv}\)</span> variance structure. However, the parameters defined by the formula in the <span class="math inline">\(\texttt{idv}\)</span> structure should not be interacted with another factor. Consider the term <code>~idv(z1+z2+z3+z4):1</code> and let’s set up the table of random effects as we have before:</p>
<p><span class="math display">\[\begin{array}{c|c}
&amp;{\color{red}{\texttt{(Intercept)}}}\\
\hline\\
{\color{blue}{\texttt{z1}}}&amp;{\color{blue}{\texttt{z1}}}.{\color{red}{\texttt{(Intercept)}}}\\
{\color{blue}{\texttt{z2}}}&amp;{\color{blue}{\texttt{z2}}}.{\color{red}{\texttt{(Intercept)}}}\\
{\color{blue}{\texttt{z3}}}&amp;{\color{blue}{\texttt{z3}}}.{\color{red}{\texttt{(Intercept)}}}\\
{\color{blue}{\texttt{z4}}}&amp;{\color{blue}{\texttt{z4}}}.{\color{red}{\texttt{(Intercept)}}}\\
\end{array}\]</span></p>
<p>An <span class="math inline">\(\texttt{idv}\)</span> structure, like an <span class="math inline">\(\texttt{idh}\)</span> structure, assumes no correlation between effects on different rows: the <span class="math inline">\(\texttt{id}\)</span> in <span class="math inline">\(\texttt{idh}\)</span> stands for identity matrix. The <span class="math inline">\(\texttt{h}\)</span> in <span class="math inline">\(\texttt{idh}\)</span> stands for heterogeneous and so each row is allowed a different variance. Clearly, with only one effect per row estimating a variance is not feasible. However, with <span class="math inline">\(\texttt{idv}\)</span> the variances are assumed homogenous and so only a single variance (the <span class="math inline">\(\texttt{v}\)</span> in <span class="math inline">\(\texttt{idv}\)</span>) is estimated that is common to all effects. The (four) regression coefficient are then treated exactly like simple random effects: identically and independently distributed with zero mean and a variance to be estimated. When there are many random effects, writing <code>~idv(z1+z2+z3+z4+...z999+z1000):1</code> is going to be painful to write and read. However, you can simply including the design matrix as a matrix in the data-frame and fit it inside the <span class="math inline">\(\texttt{idv}\)</span> structure.</p>
<p>The multi-membership model fitted in Section <a href="cat-int.html#multim-sec">5.2.2</a> is a case in point. In that example, each child had five friends and we would like to fit <span class="math inline">\(\texttt{friend}\)</span> as a random effect that predicts the child’s well-being. We can take a look at the random effect design matrix for that model:</p>
<pre><code>##   A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
## 1 0 1 0 0 0 0 1 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0
## 2 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 1 1 0 0 0 1 0 0
## 3 1 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0
## 4 1 0 0 0 0 0 0 0 1 1 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0
## 5 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 0 0
## 6 0 0 0 1 0 0 0 0 0 0 1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>The row for each child has five ones indicating their friends. This design matrix cannot be created using a standard R formula and the multi-membership linking function <code>~mm(freind.1+freind.2+freind.3+freind.4+freind.5)</code> was used to create the design matrix. However, if we had the incidence matrix, we could place it in the data-frame and fit an identical model:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="cont-int.html#cb225-1" tabindex="-1"></a>data.friends<span class="sc">$</span>Z <span class="ot">&lt;-</span> Z</span>
<span id="cb225-2"><a href="cont-int.html#cb225-2" tabindex="-1"></a>m.mm2 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">random =</span> <span class="sc">~</span><span class="fu">idv</span>(Z), <span class="at">data =</span> data.friends, <span class="at">prior =</span> prior.mm)</span></code></pre></div>
<p>Note that there is no need to explicitly interact the <span class="math inline">\(\texttt{idv}\)</span> structure with an intercept (in fact <span class="math inline">\(\texttt{MCMCglmm}\)</span> will complain if you try). In this example, the predictor variables (<span class="math inline">\(\texttt{freind}\)</span>) are categorical, but there is nothing to stop design matrices from being formed using continuous predictors, as we’ll see in the next section on splines.</p>
</div>
<div id="splines" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Splines<a href="cont-int.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The function <span class="math inline">\(\texttt{smspline}\)</span> in <span class="math inline">\(\texttt{lmeSplines}\)</span> can be used to generate design matrices for penalised splines that are transformed such that the random effects are expected to be identically and independently distributed with unknown variance. Using the ideas discussed above for user-specified design matrices (Section <a href="cont-int.html#user-defined-sec">6.6</a>) we can use an <span class="math inline">\(\texttt{idv}\)</span> structure to fit the spline. However, rather than generating the design matrix outside of <span class="math inline">\(\texttt{MCMCglmm}\)</span> and adding it to the data-frame, we can simply use the <span class="math inline">\(\texttt{smspline}\)</span> function inside <span class="math inline">\(\texttt{idv}\)</span>. For example, we can fit a penalised cubic spline to one of the test data sets in <span class="math inline">\(\texttt{lmeSplines}\)</span>:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="cont-int.html#cb226-1" tabindex="-1"></a>spline.prior <span class="ot">=</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">IW</span>(<span class="dv">1</span>, <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">F</span>(<span class="dv">1</span>, <span class="dv">1000</span>))</span>
<span id="cb226-2"><a href="cont-int.html#cb226-2" tabindex="-1"></a>m.spline <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(y <span class="sc">~</span> time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">idv</span>(<span class="fu">smspline</span>(time)), <span class="at">data =</span> smSplineEx1,</span>
<span id="cb226-3"><a href="cont-int.html#cb226-3" tabindex="-1"></a>    <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> spline.prior)</span></code></pre></div>
<p>The random effects need to be saved (<code>pr=TRUE</code>) because these are the coefficients of the spline. Similarly, when making a prediction we want to include the spline coefficients in the prediction, rather than marginalising them (Section <a href="ranef.html#ranpred-sec">4.2</a>).</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="cont-int.html#cb227-1" tabindex="-1"></a>p.slpine <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.spline, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>The model wiggles its way through the data, as splines do …</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="cont-int.html#cb228-1" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> time, <span class="at">data =</span> smSplineEx1)</span>
<span id="cb228-2"><a href="cont-int.html#cb228-2" tabindex="-1"></a><span class="fu">lines</span>(p.slpine <span class="sc">~</span> smSplineEx1<span class="sc">$</span>time)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:spline"></span>
<img src="_bookdown_files/fig/spline-1.png" alt="Data and prediction from a penalised cubic spline fitted to the example data $\texttt{smSplineEx1}$ from $\texttt{lmeSplines}$" width="672" />
<p class="caption">
Figure 6.15: Data and prediction from a penalised cubic spline fitted to the example data <span class="math inline">\(\texttt{smSplineEx1}\)</span> from <span class="math inline">\(\texttt{lmeSplines}\)</span>
</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="19">
<li id="fn19"><p>Note that I specified the prior using a prior generator function (Sections <a href="bayesian.html#Vprior-sec">2.6</a> and <a href="cat-int.html#VCVprior-sec">5.3</a>) but I upped the scale to 10,000 from the usual 1,000 because of the scale of the data. However, using a scale of 1,000 generates an almost identical posterior in this instance.<a href="cont-int.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>Taking the derivative of <span class="math inline">\(E[y | \texttt{Diet}=1]\)</span> with respect to <span class="math inline">\(\texttt{Time}\)</span> gives us the rate.<a href="cont-int.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>Remember that a global intercept is not fitted by default for variance structure models, and the model formula is essentially <code>~virus-1</code>. To add the global intercept, <code>us(1+virus):line</code> could be fitted but this can be harder to interpret because the effects are then <code>France</code>, <code>Spain-France</code> and <code>Greece-France</code>. If a <span class="math inline">\(\texttt{us}\)</span> structure is fitted, the two models are equivalent reparameterisations of each other although the priors have to be modified accordingly. This is not the case if the variance function is <span class="math inline">\(\texttt{idh}\)</span>. In this case the virus-specific variances are allowed to vary as before, but a constant covariance equal to <span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{France}}}\)</span> is also assumed<a href="cont-int.html#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p><code>longer</code> takes a positive integer and multiplies the arguments <code>nitt</code>, <code>thin</code> and <code>burnin</code> (which in this example were at there defaults, 13,000, 10 and 3,000)<a href="cont-int.html#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p><code>covu</code> models can overcome this constraint, or we could fit the reverse of <span class="math inline">\(\texttt{Time}\)</span> if we wanted a negative relationship (i.e. a covariate which is zero at day 21, one at day 20, two at day 19 and so on).<a href="cont-int.html#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p>In this formula, <span class="math inline">\(\texttt{Time}\)</span> is fixed and the random effects are random variables: the covariance is over chicks. The general rules for obtaining a covariance are:<br>a) The covariance between sums is the sum of the covariances between their summands. For example <span class="math inline">\(\textrm{Cov}(a+b, c+d) = \textrm{Cov}(a, b)+\textrm{Cov}(a, c)+\textrm{Cov}(b, c)+\textrm{Cov}(b, d)\)</span>.<br>b) The covariance between products, for example <span class="math inline">\(\textrm{Cov}(ab, cd)\)</span>, is often a nightmare unless only one of the variables on each side is random and the remainder are constants. For example, if <span class="math inline">\(a\)</span> and <span class="math inline">\(c\)</span> are constants and <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span> are random <span class="math inline">\(\textrm{Cov}(ab, cd)=ac\textrm{Cov}(b, d)\)</span>.<br>c) The covariance between a constant and a random variable is zero.<br>d) And finally, <span class="math inline">\(\textrm{Var}(b)=\textrm{Cov}(b, b)\)</span>.<a href="cont-int.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>To do this by hand, we need to add the covariances up due to the three terms in the model: <code>us(1+Time):Chick</code> and <code>us(Time):units</code> in the random formula, and <code>units</code> in <span class="math inline">\(\texttt{rcov}\)</span>. For <code>us(1+Time):Chick</code>, subset the random effect design matrix that is relevant for the <span class="math inline">\(i\)</span>th <span class="math inline">\(\texttt{Chick}\)</span> effects. Lets call this <span class="math inline">\({\bf Z}_i\)</span> which will have 12 rows (one for each observation) and two columns. The first column will be all ones (since it is the predictor for the intercept) and the second column will contain the 12 unique values of <span class="math inline">\(\texttt{Time}\)</span>. The covariance due to chick effects is then <span class="math inline">\({\bf Z}_i{\bf V}_\texttt{Chick}{\bf Z}_i^{\top}\)</span> where <span class="math inline">\({\bf V}_\texttt{Chick}\)</span> is the (co)variance matrix of intercepts and slopes. To this, we need to add the (co)variance matrix due to the <code>us(Time):units</code>. Again, subset the random effect design matrix that is relevant for the 12 <span class="math inline">\(\texttt{unit}\)</span> effects associated with <span class="math inline">\(\texttt{Chick}\)</span> <span class="math inline">\(i\)</span>. Again, the matrix <span class="math inline">\({\bf Z}_u\)</span> has 12 rows, one for each observation. However, it has 12 columns since the there is a separate <span class="math inline">\(\texttt{unit}\)</span> effect for each observation. <span class="math inline">\({\bf Z}_u\)</span> is diagonal, with the diagonals being the 12 unique values of <span class="math inline">\(\texttt{Time}\)</span>. The covariance due to <code>us(Time):units</code> is <span class="math inline">\({\bf Z}_u\sigma^2_\texttt{Time:units}{\bf Z}_u^{\top}\)</span>. Finally, we need to add the covariance due to <code>units</code> which is <span class="math inline">\({\bf I}\sigma^2_\texttt{units}\)</span> since we are assuming the residuals are independent with constant variance <span class="math inline">\(\sigma^2_\texttt{units}\)</span> (<span class="math inline">\({\bf I}\)</span> is a <span class="math inline">\(12\times 12\)</span> identity matrix). These operations follow from the rules outlined in Section <a href="#covf-sec"><strong>??</strong></a> and the footnote above[^cov].<a href="cont-int.html#fnref25" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cat-int.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multi.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["MCMCglmm-course-notes.pdf", "MCMCglmm-course-notes.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
