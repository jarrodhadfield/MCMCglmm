<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Continuous Random Interactions | MCMCglmm Course Notes</title>
  <meta name="description" content="Extended documentation and course notes for the MCMCglmm R package." />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Continuous Random Interactions | MCMCglmm Course Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Extended documentation and course notes for the MCMCglmm R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Continuous Random Interactions | MCMCglmm Course Notes" />
  
  <meta name="twitter:description" content="Extended documentation and course notes for the MCMCglmm R package." />
  

<meta name="author" content="Jarrod Hadfield" />


<meta name="date" content="2026-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cat-int.html"/>
<link rel="next" href="multi.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/rglWebGL-binding-1.3.31/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.3.31/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.3.31/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/utils.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/buffer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/shaders.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/shadersrc.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/textures.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/projection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/mouse.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/init.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/pieces.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/draw.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/controls.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/selection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/rglTimer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/pretty.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/axes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/animation.src.js"></script>
<script src="libs/CanvasMatrix4-1.3.31/CanvasMatrix.src.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bayesian.html"><a href="bayesian.html"><i class="fa fa-check"></i><b>2</b> Bayesian Analysis and MCMC</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian.html"><a href="bayesian.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="bayesian.html"><a href="bayesian.html#likelihood"><i class="fa fa-check"></i><b>2.2</b> Likelihood</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bayesian.html"><a href="bayesian.html#maximum-likelihood-ml"><i class="fa fa-check"></i><b>2.2.1</b> Maximum Likelihood (ML)</a></li>
<li class="chapter" data-level="2.2.2" data-path="bayesian.html"><a href="bayesian.html#restricted-maximum-likelihood-reml"><i class="fa fa-check"></i><b>2.2.2</b> Restricted Maximum Likelihood (REML)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bayesian.html"><a href="bayesian.html#prior-distribution"><i class="fa fa-check"></i><b>2.3</b> Prior Distribution</a></li>
<li class="chapter" data-level="2.4" data-path="bayesian.html"><a href="bayesian.html#posterior-distribution"><i class="fa fa-check"></i><b>2.4</b> Posterior Distribution</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="bayesian.html"><a href="bayesian.html#marginal-posterior-distribution"><i class="fa fa-check"></i><b>2.4.1</b> Marginal Posterior Distribution</a></li>
<li class="chapter" data-level="2.4.2" data-path="bayesian.html"><a href="bayesian.html#intervals-sec"><i class="fa fa-check"></i><b>2.4.2</b> Credible Intervals</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="bayesian.html"><a href="bayesian.html#MCMC"><i class="fa fa-check"></i><b>2.5</b> MCMC</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="bayesian.html"><a href="bayesian.html#starting-values"><i class="fa fa-check"></i><b>2.5.1</b> Starting values</a></li>
<li class="chapter" data-level="2.5.2" data-path="bayesian.html"><a href="bayesian.html#metropolis-hastings-updates"><i class="fa fa-check"></i><b>2.5.2</b> Metropolis-Hastings updates</a></li>
<li class="chapter" data-level="2.5.3" data-path="bayesian.html"><a href="bayesian.html#gibbs-sampling"><i class="fa fa-check"></i><b>2.5.3</b> Gibbs Sampling</a></li>
<li class="chapter" data-level="2.5.4" data-path="bayesian.html"><a href="bayesian.html#diagnostics-sec"><i class="fa fa-check"></i><b>2.5.4</b> MCMC Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="bayesian.html"><a href="bayesian.html#Vprior-sec"><i class="fa fa-check"></i><b>2.6</b> Priors for Residual Variances</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="bayesian.html"><a href="bayesian.html#IP-sec"><i class="fa fa-check"></i><b>2.6.1</b> Improper Priors</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="bayesian.html"><a href="bayesian.html#transform-sec"><i class="fa fa-check"></i><b>2.7</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>3</b> Linear and Generalised Linear Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="glm.html"><a href="glm.html#linear-model-lm"><i class="fa fa-check"></i><b>3.1</b> Linear Model (LM)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="glm.html"><a href="glm.html#lm-sec"><i class="fa fa-check"></i><b>3.1.1</b> Linear Predictors</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="glm.html"><a href="glm.html#generalised-linear-model-glm"><i class="fa fa-check"></i><b>3.2</b> Generalised Linear Model (GLM)</a></li>
<li class="chapter" data-level="3.3" data-path="glm.html"><a href="glm.html#poisson-glm"><i class="fa fa-check"></i><b>3.3</b> Poisson GLM</a></li>
<li class="chapter" data-level="3.4" data-path="glm.html"><a href="glm.html#overdispersion"><i class="fa fa-check"></i><b>3.4</b> Overdispersion</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="glm.html"><a href="glm.html#multiplicative-overdispersion"><i class="fa fa-check"></i><b>3.4.1</b> Multiplicative Overdispersion</a></li>
<li class="chapter" data-level="3.4.2" data-path="glm.html"><a href="glm.html#addod-sec"><i class="fa fa-check"></i><b>3.4.2</b> Additive Overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="glm.html"><a href="glm.html#prediction-in-glm"><i class="fa fa-check"></i><b>3.5</b> Prediction in GLM</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="glm.html"><a href="glm.html#posterior-predictive-distribution"><i class="fa fa-check"></i><b>3.5.1</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="glm.html"><a href="glm.html#binom-sec"><i class="fa fa-check"></i><b>3.6</b> Binomial and Bernoulli GLM</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="glm.html"><a href="glm.html#overdispersion-1"><i class="fa fa-check"></i><b>3.6.1</b> Overdispersion</a></li>
<li class="chapter" data-level="3.6.2" data-path="glm.html"><a href="glm.html#prediction"><i class="fa fa-check"></i><b>3.6.2</b> Prediction</a></li>
<li class="chapter" data-level="3.6.3" data-path="glm.html"><a href="glm.html#bernoulli-sec"><i class="fa fa-check"></i><b>3.6.3</b> Bernoulli GLM</a></li>
<li class="chapter" data-level="3.6.4" data-path="glm.html"><a href="glm.html#probit-link"><i class="fa fa-check"></i><b>3.6.4</b> Probit link</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="glm.html"><a href="glm.html#ordinal-data"><i class="fa fa-check"></i><b>3.7</b> Ordinal Data</a></li>
<li class="chapter" data-level="3.8" data-path="glm.html"><a href="glm.html#non-zero-binomial-data"><i class="fa fa-check"></i><b>3.8</b> Non-zero Binomial Data</a></li>
<li class="chapter" data-level="3.9" data-path="glm.html"><a href="glm.html#complete-separation"><i class="fa fa-check"></i><b>3.9</b> Complete Separation</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="glm.html"><a href="glm.html#gelman-prior-sec"><i class="fa fa-check"></i><b>3.9.1</b> The <span class="citation">Gelman, Jakulin, et al. (2008)</span> prior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ranef.html"><a href="ranef.html"><i class="fa fa-check"></i><b>4</b> Random effects</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ranef.html"><a href="ranef.html#GLMM"><i class="fa fa-check"></i><b>4.1</b> Generalised Linear Mixed Model (GLMM)</a></li>
<li class="chapter" data-level="4.2" data-path="ranef.html"><a href="ranef.html#ranpred-sec"><i class="fa fa-check"></i><b>4.2</b> Prediction with Random Effects</a></li>
<li class="chapter" data-level="4.3" data-path="ranef.html"><a href="ranef.html#overdispersed-binomial-as-a-bernoulli-glmm"><i class="fa fa-check"></i><b>4.3</b> Overdispersed Binomial as a Bernoulli GLMM</a></li>
<li class="chapter" data-level="4.4" data-path="ranef.html"><a href="ranef.html#ICC"><i class="fa fa-check"></i><b>4.4</b> Intra-class Correlations</a></li>
<li class="chapter" data-level="4.5" data-path="ranef.html"><a href="ranef.html#PXprior-sec"><i class="fa fa-check"></i><b>4.5</b> Priors for Random Effect Variances</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="ranef.html"><a href="ranef.html#f-and-folded-t-priors"><i class="fa fa-check"></i><b>4.5.1</b> <span class="math inline">\(F\)</span> and folded-<span class="math inline">\(t\)</span> priors</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ranef.html"><a href="ranef.html#priors-on-functions-of-variances"><i class="fa fa-check"></i><b>4.6</b> Priors on Functions of Variances</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="ranef.html"><a href="ranef.html#intra-class-correlation"><i class="fa fa-check"></i><b>4.6.1</b> Intra-class Correlation</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ranef.html"><a href="ranef.html#fix-or-rand"><i class="fa fa-check"></i><b>4.7</b> Fixed or Random?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cat-int.html"><a href="cat-int.html"><i class="fa fa-check"></i><b>5</b> Categorical Random Interactions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cat-int.html"><a href="cat-int.html#idh-variance-structure"><i class="fa fa-check"></i><b>5.1</b> <code>idh</code> Variance Structure</a></li>
<li class="chapter" data-level="5.2" data-path="cat-int.html"><a href="cat-int.html#us-variance-structure"><i class="fa fa-check"></i><b>5.2</b> <code>us</code> Variance Structure</a></li>
<li class="chapter" data-level="5.3" data-path="cat-int.html"><a href="cat-int.html#compound-variance-structures"><i class="fa fa-check"></i><b>5.3</b> Compound Variance Structures</a></li>
<li class="chapter" data-level="5.4" data-path="cat-int.html"><a href="cat-int.html#heter-sec"><i class="fa fa-check"></i><b>5.4</b> Heterogenous Residual Variance</a></li>
<li class="chapter" data-level="5.5" data-path="cat-int.html"><a href="cat-int.html#contrasts-and-covariances"><i class="fa fa-check"></i><b>5.5</b> Contrasts and Covariances</a></li>
<li class="chapter" data-level="5.6" data-path="cat-int.html"><a href="cat-int.html#VCVprior-sec"><i class="fa fa-check"></i><b>5.6</b> Priors for Covariance Matrices</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="cat-int.html"><a href="cat-int.html#priors-for-us-structures"><i class="fa fa-check"></i><b>5.6.1</b> Priors for <code>us</code> structures</a></li>
<li class="chapter" data-level="5.6.2" data-path="cat-int.html"><a href="cat-int.html#priors-for-idh-structures"><i class="fa fa-check"></i><b>5.6.2</b> Priors for <code>idh</code> structures</a></li>
<li class="chapter" data-level="5.6.3" data-path="cat-int.html"><a href="cat-int.html#priors-for-corg-and-corgh-structures"><i class="fa fa-check"></i><b>5.6.3</b> Priors for <code>corg</code> and <code>corgh</code> structures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cont-int.html"><a href="cont-int.html"><i class="fa fa-check"></i><b>6</b> Continuous Random Interactions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cont-int.html"><a href="cont-int.html#random-regression"><i class="fa fa-check"></i><b>6.1</b> Random Regression</a></li>
<li class="chapter" data-level="6.2" data-path="cont-int.html"><a href="cont-int.html#expected-variances-and-covariances"><i class="fa fa-check"></i><b>6.2</b> Expected Variances and Covariances</a></li>
<li class="chapter" data-level="6.3" data-path="cont-int.html"><a href="cont-int.html#RRcentering"><i class="fa fa-check"></i><b>6.3</b> <code>us</code> versus <code>idh</code> and mean centering</a></li>
<li class="chapter" data-level="6.4" data-path="cont-int.html"><a href="cont-int.html#meta-sec"><i class="fa fa-check"></i><b>6.4</b> Meta-analysis</a></li>
<li class="chapter" data-level="6.5" data-path="cont-int.html"><a href="cont-int.html#splines"><i class="fa fa-check"></i><b>6.5</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multi.html"><a href="multi.html"><i class="fa fa-check"></i><b>7</b> Multi-response models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="multi.html"><a href="multi.html#relaxing-the-univariate-assumptions-of-causality"><i class="fa fa-check"></i><b>7.1</b> Relaxing the univariate assumptions of causality</a></li>
<li class="chapter" data-level="7.2" data-path="multi.html"><a href="multi.html#multinomial-models"><i class="fa fa-check"></i><b>7.2</b> Multinomial Models</a></li>
<li class="chapter" data-level="7.3" data-path="multi.html"><a href="multi.html#zero-inflated-models"><i class="fa fa-check"></i><b>7.3</b> Zero-inflated Models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="multi.html"><a href="multi.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.3.1</b> Posterior predictive checks</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="multi.html"><a href="multi.html#Hurdle"><i class="fa fa-check"></i><b>7.4</b> Hurdle Models</a></li>
<li class="chapter" data-level="7.5" data-path="multi.html"><a href="multi.html#ZAP"><i class="fa fa-check"></i><b>7.5</b> Zero-altered Models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pedigree.html"><a href="pedigree.html"><i class="fa fa-check"></i><b>8</b> Pedigrees and Phylogenies</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pedigree.html"><a href="pedigree.html#pedigree-and-phylogeny-formats"><i class="fa fa-check"></i><b>8.1</b> Pedigree and phylogeny formats</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="pedigree.html"><a href="pedigree.html#pedigrees"><i class="fa fa-check"></i><b>8.1.1</b> Pedigrees</a></li>
<li class="chapter" data-level="8.1.2" data-path="pedigree.html"><a href="pedigree.html#phylogenies"><i class="fa fa-check"></i><b>8.1.2</b> Phylogenies</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="pedigree.html"><a href="pedigree.html#the-animal-model-and-the-phylogenetic-mixed-model"><i class="fa fa-check"></i><b>8.2</b> The animal model and the phylogenetic mixed model</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="parameter-expansion.html"><a href="parameter-expansion.html"><i class="fa fa-check"></i><b>9</b> Parameter Expansion</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="parameter-expansion.html"><a href="parameter-expansion.html#variances-close-to-zero"><i class="fa fa-check"></i><b>9.0.1</b> Variances close to zero</a></li>
<li class="chapter" data-level="9.0.2" data-path="parameter-expansion.html"><a href="parameter-expansion.html#secPX-p"><i class="fa fa-check"></i><b>9.0.2</b> Parameter expanded priors</a></li>
<li class="chapter" data-level="9.0.3" data-path="parameter-expansion.html"><a href="parameter-expansion.html#binary-response-models"><i class="fa fa-check"></i><b>9.0.3</b> Binary response models</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="path.html"><a href="path.html"><i class="fa fa-check"></i><b>10</b> Path Analysis &amp; Antedependence Structures</a>
<ul>
<li class="chapter" data-level="10.1" data-path="path.html"><a href="path.html#path-anlaysis"><i class="fa fa-check"></i><b>10.1</b> Path Anlaysis</a></li>
<li class="chapter" data-level="10.2" data-path="path.html"><a href="path.html#ante-sec"><i class="fa fa-check"></i><b>10.2</b> Antedependence</a></li>
<li class="chapter" data-level="10.3" data-path="path.html"><a href="path.html#scaling"><i class="fa fa-check"></i><b>10.3</b> Scaling</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="technical-details.html"><a href="technical-details.html"><i class="fa fa-check"></i><b>11</b> Technical Details</a>
<ul>
<li class="chapter" data-level="11.1" data-path="technical-details.html"><a href="technical-details.html#model-form"><i class="fa fa-check"></i><b>11.1</b> Model Form</a></li>
<li class="chapter" data-level="11.2" data-path="technical-details.html"><a href="technical-details.html#MCMC-app"><i class="fa fa-check"></i><b>11.2</b> MCMC Sampling Schemes</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="technical-details.html"><a href="technical-details.html#updating-the-latent-variables-bf-l"><i class="fa fa-check"></i><b>11.2.1</b> Updating the latent variables <span class="math inline">\({\bf l}\)</span></a></li>
<li class="chapter" data-level="11.2.2" data-path="technical-details.html"><a href="technical-details.html#updating-the-location-vector-boldsymboltheta-leftboldsymbolmathbfbeta-bf-uright"><i class="fa fa-check"></i><b>11.2.2</b> Updating the location vector <span class="math inline">\(\boldsymbol{\theta} = \left[{\boldsymbol{\mathbf{\beta}}}^{&#39;}\; {\bf u}^{&#39;}\right]^{&#39;}\)</span></a></li>
<li class="chapter" data-level="11.2.3" data-path="technical-details.html"><a href="technical-details.html#updating-the-variance-structures-bf-g-and-bf-r"><i class="fa fa-check"></i><b>11.2.3</b> Updating the variance structures <span class="math inline">\({\bf G}\)</span> and <span class="math inline">\({\bf R}\)</span></a></li>
<li class="chapter" data-level="11.2.4" data-path="technical-details.html"><a href="technical-details.html#ordinal-models"><i class="fa fa-check"></i><b>11.2.4</b> Ordinal Models</a></li>
<li class="chapter" data-level="11.2.5" data-path="technical-details.html"><a href="technical-details.html#path-analyses"><i class="fa fa-check"></i><b>11.2.5</b> Path Analyses</a></li>
<li class="chapter" data-level="11.2.6" data-path="technical-details.html"><a href="technical-details.html#deviance-and-dic"><i class="fa fa-check"></i><b>11.2.6</b> Deviance and DIC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCMCglmm Course Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cont-int" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Continuous Random Interactions<a href="cont-int.html#cont-int" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In Chapter <a href="cat-int.html#cat-int">5</a> we saw how we could define a linear model within a variance function and then interact these terms with a random effect. In the example, we did this in order to fit a <code>sex</code> by <code>dam</code> interaction: <code>us(sex):dam</code>.</p>
<p>The term entering into the variance function model was categorical, and we saw that by fitting the interaction we were essentially estimating the parameters of the covariance matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{dam}}}}=
\left[
\begin{array}{ccc}
\sigma^{2}_{\color{blue}{\texttt{Female}}}&amp;\sigma_{\color{blue}{\texttt{Female}, \texttt{Male}}}&amp;\sigma_{\color{blue}{\texttt{Female}, \texttt{UNK}}}\\
\sigma_{\color{blue}{\texttt{Female}, \texttt{Male}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Male}}}&amp;\sigma_{\color{blue}{\texttt{Male}, \texttt{UNK}}}\\
\sigma_{\color{blue}{\texttt{Female}, \texttt{UNK}}}&amp;\sigma_{\color{blue}{\texttt{Male}, \texttt{UNK}}}&amp;\sigma^{2}_{\color{blue}{\texttt{UNK}}}\\
\end{array}
\right]\]</span></p>
<p>We are also free to define the variance function model with continuous covariates, or even a mixture of continuous and categorical factors, and the resulting covariance matrix is interpreted in the same way.</p>
<div id="random-regression" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Random Regression<a href="cont-int.html#random-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As an example, we’ll use a longitudinal data set on chicken growth (See Figure <a href="cont-int.html#fig:ChickWeight">6.1</a>):</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="cont-int.html#cb194-1" tabindex="-1"></a><span class="fu">data</span>(ChickWeight)</span></code></pre></div>
<p>The data consist of body weights (<code>weight</code>) for 50 chicks (<code>Chick</code>) measured up to 12 times over a 3 week period. The variable <code>Time</code> is the number of days since hatching, and <code>Diet</code> is a four level factor indicating the type of protein diet the chicks received.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="cont-int.html#cb195-1" tabindex="-1"></a><span class="fu">xyplot</span>(weight <span class="sc">~</span> Time <span class="sc">|</span> Chick, <span class="at">data =</span> ChickWeight)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ChickWeight"></span>
<img src="_bookdown_files/fig/ChickWeight-1.png" alt="Weight data of 50 chicks from hatching until three weeks old." width="672" />
<p class="caption">
Figure 6.1: Weight data of 50 chicks from hatching until three weeks old.
</p>
</div>
<p>Growth curves tend to be sigmoidal and so one of the non-linear growth curves such as the Gompertz or logistic may be a good starting model. However, these can be tricky to use and an alternative is to try and capture the form of the curve using polynomials. We’ll start with a quadratic function at the population level and and fit chick as a random term:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="cont-int.html#cb196-1" tabindex="-1"></a>prior.m4a<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fl">1e-07</span>, <span class="at">nu =</span> <span class="sc">-</span><span class="dv">2</span>), <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1 =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="dv">1</span>, <span class="at">nu =</span> <span class="dv">1</span>)))</span>
<span id="cb196-2"><a href="cont-int.html#cb196-2" tabindex="-1"></a>m4a<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">random =</span> <span class="sc">~</span>Chick, <span class="at">data =</span> ChickWeight,</span>
<span id="cb196-3"><a href="cont-int.html#cb196-3" tabindex="-1"></a>    <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.m4a<span class="fl">.1</span>)</span></code></pre></div>
<p>We’ve saved the random chick effects so we can plot the predicted growth functions for each bird. For now we will just predict the growth function assuming that all birds were on Diet 1 (the intercept):</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="cont-int.html#cb197-1" tabindex="-1"></a>pop.int <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[, <span class="dv">1</span>])</span>
<span id="cb197-2"><a href="cont-int.html#cb197-2" tabindex="-1"></a>pop.slope <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[, <span class="dv">5</span>])</span>
<span id="cb197-3"><a href="cont-int.html#cb197-3" tabindex="-1"></a>pop.quad <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[, <span class="dv">6</span>])</span>
<span id="cb197-4"><a href="cont-int.html#cb197-4" tabindex="-1"></a>chick.int <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[, <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">56</span>)])</span></code></pre></div>
<p>We need to combine these parameter estimates with the polynomials for <code>Time</code> which are just the sequence
<span class="math inline">\(\texttt{Time}^{0}, \texttt{Time}^1, \texttt{Time}^2 \dots\)</span> and so on. We can then plot the population expected population growth curve, and around that the predicted growth curves for each chick (we don’t need to bother with <span class="math inline">\(\texttt{Time}^{0}\)</span> since this is always one):</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="cont-int.html#cb198-1" tabindex="-1"></a>pos.time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">21</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb198-2"><a href="cont-int.html#cb198-2" tabindex="-1"></a><span class="fu">plot</span>(pop.int <span class="sc">+</span> pop.slope <span class="sc">*</span> <span class="fu">I</span>(pos.time<span class="sc">^</span><span class="dv">1</span>) <span class="sc">+</span> pop.quad <span class="sc">*</span> <span class="fu">I</span>(pos.time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">~</span> pos.time, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb198-3"><a href="cont-int.html#cb198-3" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">400</span>))</span>
<span id="cb198-4"><a href="cont-int.html#cb198-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) {</span>
<span id="cb198-5"><a href="cont-int.html#cb198-5" tabindex="-1"></a>    <span class="fu">lines</span>(pop.int <span class="sc">+</span> chick.int[i] <span class="sc">+</span> pop.slope <span class="sc">*</span> <span class="fu">I</span>(pos.time<span class="sc">^</span><span class="dv">1</span>) <span class="sc">+</span> pop.quad <span class="sc">*</span> <span class="fu">I</span>(pos.time<span class="sc">^</span><span class="dv">2</span>) <span class="sc">~</span></span>
<span id="cb198-6"><a href="cont-int.html#cb198-6" tabindex="-1"></a>        pos.time, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb198-7"><a href="cont-int.html#cb198-7" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:parallel"></span>
<img src="_bookdown_files/fig/parallel-1.png" alt="Predicted weights of each chick as a function of age. A quadratic population growth curve (black) is fitted with random chick intercepts." width="672" />
<p class="caption">
Figure 6.2: Predicted weights of each chick as a function of age. A quadratic population growth curve (black) is fitted with random chick intercepts.
</p>
</div>
<p>The population growth curve is slightly convex because of the quadratic term, and the predictions for each chick are parallel to this curve. By fitting chick as a random effect we have allowed variation in the intercept only, and often this is not enough. We can get a feel for how well the model fits the data by overlaying the predictions with actual values. We can form design matrix <span class="math inline">\({\bf W} = \left[{\bf X},\ {\bf Z}\right]\)</span> and multiply by the parameter vector <span class="math inline">\(\boldsymbol{\theta}\)</span> to get the predictions (See Chapter <a href="technical-details.html#technical-details">11</a>):</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="cont-int.html#cb199-1" tabindex="-1"></a>W<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">cbind</span>(m4a<span class="fl">.1</span><span class="sc">$</span>X, m4a<span class="fl">.1</span><span class="sc">$</span>Z)</span>
<span id="cb199-2"><a href="cont-int.html#cb199-2" tabindex="-1"></a>prediction<span class="fl">.1</span> <span class="ot">&lt;-</span> W<span class="fl">.1</span> <span class="sc">%*%</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol)</span>
<span id="cb199-3"><a href="cont-int.html#cb199-3" tabindex="-1"></a><span class="fu">xyplot</span>(weight <span class="sc">+</span> prediction<span class="fl">.1</span><span class="sc">@</span>x <span class="sc">~</span> Time <span class="sc">|</span> Chick, <span class="at">data =</span> ChickWeight)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CWpred-1"></span>
<img src="_bookdown_files/fig/CWpred-1-1.png" alt="Weights of each chick as a function of age in blue, with the predicted weights in purple. A quadratic population growth curve was fitted with random chick intercepts." width="672" />
<p class="caption">
Figure 6.3: Weights of each chick as a function of age in blue, with the predicted weights in purple. A quadratic population growth curve was fitted with random chick intercepts.
</p>
</div>
<p>The predictions don’t look that bad, but you will notice that for some chicks (e.g. 13,19,34) the slope of the predicted growth seems either to shallow, or too steep. To account for this we can start by fitting <code>us(1+time):Chick</code>. The linear model inside the variance function has two parameters, an intercept (<code>1</code>) and a regression slope associated with <code>Time</code> which define the set of interactions:</p>
<p><span class="math display">\[\begin{array}{c|rrrrrc}
&amp;{\color{red}{\texttt{Chick1}}}&amp;{\color{red}{\texttt{Chick2}}}&amp;{\color{red}{\texttt{Chick3}}}&amp;\dots\\
\hline\\
{\color{blue}{\texttt{(Intercept)}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick1}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick2}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick3}}}&amp;\dots\\
{\color{blue}{\texttt{Time}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick1}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick2}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick3}}}&amp;\dots\\
\end{array}\]</span></p>
<p>Each chick now has an intercept and a slope, and because we have used the <code>us</code> function we are estimating the <span class="math inline">\(2\times2\)</span> matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{Chick}}}}=
\left[
\begin{array}{cc}
\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}}}\\
\end{array}
\right]\]</span></p>
<p><span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}\)</span> is the amount of variation in intercepts between chicks, and <span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{Time}}}\)</span> is the amount of variation in the regression slopes between chicks. If the <code>idh</code> function had been used the covariance would have been set to zero and we could have interpreted variation in intercepts as variation in overall size, and variation in slopes as variation in growth rate. However, there is often covariance between intercepts and slopes and it is usually a good idea to use the <code>us</code> function and estimate them (see Section <a href="cont-int.html#RRcentering">6.3</a>). We shall do so:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="cont-int.html#cb200-1" tabindex="-1"></a>prior.m4a<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fl">1e-07</span>, <span class="at">nu =</span> <span class="sc">-</span><span class="dv">2</span>), <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1 =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">2</span>),</span>
<span id="cb200-2"><a href="cont-int.html#cb200-2" tabindex="-1"></a>    <span class="at">nu =</span> <span class="dv">2</span>)))  <span class="co"># non-informative prior for the (co)variances</span></span>
<span id="cb200-3"><a href="cont-int.html#cb200-3" tabindex="-1"></a>m4a<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> Time)<span class="sc">:</span>Chick,</span>
<span id="cb200-4"><a href="cont-int.html#cb200-4" tabindex="-1"></a>    <span class="at">data =</span> ChickWeight, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.m4a<span class="fl">.2</span>, <span class="at">saveX =</span> <span class="cn">TRUE</span>, <span class="at">saveZ =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RR2VCV"></span>
<img src="_bookdown_files/fig/RR2VCV-1.png" alt="MCMC summary plots for the chick covariance components from model \texttt{m4a.2}. The lower and upper plots are the intercept and slope variance components respectively, and the middle two plots are the intercept-slope covariance." width="672" />
<p class="caption">
Figure 6.4: MCMC summary plots for the chick covariance components from model . The lower and upper plots are the intercept and slope variance components respectively, and the middle two plots are the intercept-slope covariance.
</p>
</div>
<p>The traces look OKish for the chick (co)variance matrices (Figure <a href="cont-int.html#fig:RR2VCV">6.4</a> but notice that the the estimate of intercept-slope correlation is close to the boundary of parameter space (-1):</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="cont-int.html#cb201-1" tabindex="-1"></a>int.slope.cor <span class="ot">&lt;-</span> m4a<span class="fl">.2</span><span class="sc">$</span>VCV[, <span class="dv">2</span>]<span class="sc">/</span><span class="fu">sqrt</span>(m4a<span class="fl">.2</span><span class="sc">$</span>VCV[, <span class="dv">1</span>] <span class="sc">*</span> m4a<span class="fl">.2</span><span class="sc">$</span>VCV[, <span class="dv">4</span>])</span>
<span id="cb201-2"><a href="cont-int.html#cb201-2" tabindex="-1"></a><span class="fu">posterior.mode</span>(int.slope.cor)</span></code></pre></div>
<pre><code>##      var1 
## -0.974158</code></pre>
<p>and shows strong autocorrelation</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="cont-int.html#cb203-1" tabindex="-1"></a><span class="fu">autocorr</span>(int.slope.cor)</span></code></pre></div>
<pre><code>## , , 1
## 
##                [,1]
## Lag 0    1.00000000
## Lag 10   0.20159550
## Lag 50   0.01823015
## Lag 100 -0.01887925
## Lag 500  0.04285655</code></pre>
<p>and we should run it for longer in order to sample the posterior adequately. For now we will carry on and obtain the predictions from the model we ran, but using the <code>perdict</code> function rather than dong it ‘by hand’:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="cont-int.html#cb205-1" tabindex="-1"></a><span class="fu">xyplot</span>(weight <span class="sc">+</span> <span class="fu">predict</span>(m4a<span class="fl">.2</span>, <span class="at">marginal =</span> <span class="cn">NULL</span>) <span class="sc">~</span> Time <span class="sc">|</span> Chick, <span class="at">data =</span> ChickWeight)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CWpred-2"></span>
<img src="_bookdown_files/fig/CWpred-2-1.png" alt="Weights of each chick as a function of age in blue, with the predicted weights in purple. A quadratic population growth curve was fitted with a first order random regression for chicks (i.e. a random intercept-slope model)." width="672" />
<p class="caption">
Figure 6.5: Weights of each chick as a function of age in blue, with the predicted weights in purple. A quadratic population growth curve was fitted with a first order random regression for chicks (i.e. a random intercept-slope model).
</p>
</div>
<p>and we can see that the fit is much better (See Figure <a href="cont-int.html#fig:CWpred-2">6.5</a>). In theory we could fit higher order random
regressions (data and prior permitting) and use something like DIC to choose which is the best compromise between the fit of the model to the data and how many effective parameters were fitted. For example we could go from the <span class="math inline">\(1^{st}\)</span> order random regression to a <span class="math inline">\(2^{nd}\)</span> order model:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="cont-int.html#cb206-1" tabindex="-1"></a>prior.m4a<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="dv">1</span>, <span class="at">nu =</span> <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1 =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">3</span>),</span>
<span id="cb206-2"><a href="cont-int.html#cb206-2" tabindex="-1"></a>    <span class="at">nu =</span> <span class="dv">3</span>)))  <span class="co"># non-informative prior for the (co)variances</span></span>
<span id="cb206-3"><a href="cont-int.html#cb206-3" tabindex="-1"></a>m4a<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">poly</span>(Time,</span>
<span id="cb206-4"><a href="cont-int.html#cb206-4" tabindex="-1"></a>    <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>))<span class="sc">:</span>Chick, <span class="at">data =</span> ChickWeight, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.m4a<span class="fl">.3</span>, <span class="at">saveX =</span> <span class="cn">TRUE</span>,</span>
<span id="cb206-5"><a href="cont-int.html#cb206-5" tabindex="-1"></a>    <span class="at">saveZ =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>and obtain the <span class="math inline">\(3\times3\)</span> covariance matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{Chick}}}}=
\left[
\begin{array}{ccc}
\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time^{2}}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}}}&amp;\sigma_{\color{blue}{\texttt{Time}, \texttt{Time^{2}}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time^2}}}&amp;\sigma_{\color{blue}{\texttt{Time}, \texttt{Time^{2}}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time^2}}}\\
\end{array}
\right]\]</span></p>
<p>The model predicts the chick weights to an even better degree (See Figure <a href="cont-int.html#fig:CWpred-3">6.6</a>)</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="cont-int.html#cb207-1" tabindex="-1"></a><span class="fu">xyplot</span>(weight <span class="sc">+</span> <span class="fu">predict</span>(m4a<span class="fl">.3</span>, <span class="at">marginal =</span> <span class="cn">NULL</span>) <span class="sc">~</span> Time <span class="sc">|</span> Chick, <span class="at">data =</span> ChickWeight)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CWpred-3"></span>
<img src="_bookdown_files/fig/CWpred-3-1.png" alt="Weights of each chick as a function of age in blue, with the predicted weights in purple. A quadratic population growth curve was fitted with a second order random regression for chicks (i.e. a random intercept-slope-quadratic model)." width="672" />
<p class="caption">
Figure 6.6: Weights of each chick as a function of age in blue, with the predicted weights in purple. A quadratic population growth curve was fitted with a second order random regression for chicks (i.e. a random intercept-slope-quadratic model).
</p>
</div>
<p>and the DIC has gone down, suggesting that the model is better:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="cont-int.html#cb208-1" tabindex="-1"></a>m4a<span class="fl">.1</span><span class="sc">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 5525.676</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="cont-int.html#cb210-1" tabindex="-1"></a>m4a<span class="fl">.2</span><span class="sc">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 4544.737</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="cont-int.html#cb212-1" tabindex="-1"></a>m4a<span class="fl">.3</span><span class="sc">$</span>DIC</span></code></pre></div>
<pre><code>## [1] 3932.481</code></pre>
<p>It is worth seeing whether using an AIC measure using REML also suggests the highest order model is the better model.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="cont-int.html#cb214-1" tabindex="-1"></a><span class="fu">library</span>(lme4, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb214-2"><a href="cont-int.html#cb214-2" tabindex="-1"></a>m5a.<span class="fl">1.</span>REML <span class="ot">&lt;-</span> <span class="fu">lmer</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Chick), <span class="at">data =</span> ChickWeight)</span>
<span id="cb214-3"><a href="cont-int.html#cb214-3" tabindex="-1"></a><span class="fu">AIC</span>(m5a.<span class="fl">1.</span>REML)</span></code></pre></div>
<pre><code>## [1] 5578.963</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="cont-int.html#cb216-1" tabindex="-1"></a>m5a.<span class="fl">2.</span>REML <span class="ot">&lt;-</span> <span class="fu">lmer</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="fu">poly</span>(Time, <span class="dv">1</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">|</span></span>
<span id="cb216-2"><a href="cont-int.html#cb216-2" tabindex="-1"></a>    Chick), <span class="at">data =</span> ChickWeight)</span>
<span id="cb216-3"><a href="cont-int.html#cb216-3" tabindex="-1"></a><span class="fu">AIC</span>(m5a.<span class="fl">2.</span>REML)</span></code></pre></div>
<pre><code>## [1] 4732.387</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="cont-int.html#cb218-1" tabindex="-1"></a>m5a.<span class="fl">3.</span>REML <span class="ot">&lt;-</span> <span class="fu">lmer</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>) <span class="sc">|</span></span>
<span id="cb218-2"><a href="cont-int.html#cb218-2" tabindex="-1"></a>    Chick), <span class="at">data =</span> ChickWeight)</span>
<span id="cb218-3"><a href="cont-int.html#cb218-3" tabindex="-1"></a><span class="fu">AIC</span>(m5a.<span class="fl">3.</span>REML)</span></code></pre></div>
<pre><code>## [1] 4267.013</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="cont-int.html#cb220-1" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>lme4)  <span class="co"># causes conflicts with coda</span></span></code></pre></div>
</div>
<div id="expected-variances-and-covariances" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Expected Variances and Covariances<a href="cont-int.html#expected-variances-and-covariances" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Random regression models make strong assumptions about how the variance should change as a function of the predictor variable. Imagine that the intercept variance was zero, such that all regressions give the same prediction when <code>Time</code>=0. Imagine also that there was variance for slope, the predictions would look something like this (Figure
<a href="cont-int.html#fig:RRtoy">6.7</a>):</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="cont-int.html#cb221-1" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb221-2"><a href="cont-int.html#cb221-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span>, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>)</span>
<span id="cb221-3"><a href="cont-int.html#cb221-3" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) {</span>
<span id="cb221-4"><a href="cont-int.html#cb221-4" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="sc">-</span>slope[i], slope[i]))</span>
<span id="cb221-5"><a href="cont-int.html#cb221-5" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RRtoy"></span>
<img src="_bookdown_files/fig/RRtoy-1.png" alt="Hypothetical regression lines where the variance in slopes is one but the variance in intercepts is zero. The expected variance of y is a quadratic function of Time, being zero when Time=0, and increasing with positive or negative values." width="672" />
<p class="caption">
Figure 6.7: Hypothetical regression lines where the variance in slopes is one but the variance in intercepts is zero. The expected variance of y is a quadratic function of Time, being zero when Time=0, and increasing with positive or negative values.
</p>
</div>
<p>with the variance increasing at extreme values of <code>Time</code> and being zero at <code>Time</code>=0. For an intercept-slope model such as this the expected variance is quadratic in the predictor, and for a intercept-slope-quadratic model the variance is cubic in the predictor. Generally the expected variance can be obtained using:</p>
<p><span class="math display" id="eq:RRvar-eq">\[VAR[y] = \textrm{diag}({\bf Z}{\bf V}{\bf Z}^{&#39;})
\label{RRvar-eq}   \tag{6.1}\]</span></p>
<p>and we can use this to predict the change in variance as a function of <code>Time</code> for the three models:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="cont-int.html#cb222-1" tabindex="-1"></a>pos.time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">21</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb222-2"><a href="cont-int.html#cb222-2" tabindex="-1"></a>polynomial <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">100</span>), <span class="fu">poly</span>(pos.time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>))</span>
<span id="cb222-3"><a href="cont-int.html#cb222-3" tabindex="-1"></a></span>
<span id="cb222-4"><a href="cont-int.html#cb222-4" tabindex="-1"></a>beta<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[, <span class="dv">1</span>]), <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[, <span class="dv">5</span>]), <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>Sol[,</span>
<span id="cb222-5"><a href="cont-int.html#cb222-5" tabindex="-1"></a>    <span class="dv">6</span>]))</span>
<span id="cb222-6"><a href="cont-int.html#cb222-6" tabindex="-1"></a>beta<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">posterior.mode</span>(m4a<span class="fl">.2</span><span class="sc">$</span>Sol[, <span class="dv">1</span>]), <span class="fu">posterior.mode</span>(m4a<span class="fl">.2</span><span class="sc">$</span>Sol[, <span class="dv">5</span>]), <span class="fu">posterior.mode</span>(m4a<span class="fl">.2</span><span class="sc">$</span>Sol[,</span>
<span id="cb222-7"><a href="cont-int.html#cb222-7" tabindex="-1"></a>    <span class="dv">6</span>]))</span>
<span id="cb222-8"><a href="cont-int.html#cb222-8" tabindex="-1"></a>beta<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">posterior.mode</span>(m4a<span class="fl">.3</span><span class="sc">$</span>Sol[, <span class="dv">1</span>]), <span class="fu">posterior.mode</span>(m4a<span class="fl">.3</span><span class="sc">$</span>Sol[, <span class="dv">5</span>]), <span class="fu">posterior.mode</span>(m4a<span class="fl">.3</span><span class="sc">$</span>Sol[,</span>
<span id="cb222-9"><a href="cont-int.html#cb222-9" tabindex="-1"></a>    <span class="dv">6</span>]))</span>
<span id="cb222-10"><a href="cont-int.html#cb222-10" tabindex="-1"></a></span>
<span id="cb222-11"><a href="cont-int.html#cb222-11" tabindex="-1"></a>VCV<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>VCV)[<span class="dv">1</span>], <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb222-12"><a href="cont-int.html#cb222-12" tabindex="-1"></a>VCV<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">posterior.mode</span>(m4a<span class="fl">.2</span><span class="sc">$</span>VCV)[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">2</span><span class="sc">^</span><span class="dv">2</span>)], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb222-13"><a href="cont-int.html#cb222-13" tabindex="-1"></a>VCV<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">posterior.mode</span>(m4a<span class="fl">.3</span><span class="sc">$</span>VCV)[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">3</span><span class="sc">^</span><span class="dv">2</span>)], <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb222-14"><a href="cont-int.html#cb222-14" tabindex="-1"></a></span>
<span id="cb222-15"><a href="cont-int.html#cb222-15" tabindex="-1"></a>units<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.1</span><span class="sc">$</span>VCV)[<span class="dv">2</span>]</span>
<span id="cb222-16"><a href="cont-int.html#cb222-16" tabindex="-1"></a>units<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.2</span><span class="sc">$</span>VCV)[<span class="dv">5</span>]</span>
<span id="cb222-17"><a href="cont-int.html#cb222-17" tabindex="-1"></a>units<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">posterior.mode</span>(m4a<span class="fl">.3</span><span class="sc">$</span>VCV)[<span class="dv">10</span>]</span></code></pre></div>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="cont-int.html#cb223-1" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> Time, <span class="at">data =</span> ChickWeight)</span>
<span id="cb223-2"><a href="cont-int.html#cb223-2" tabindex="-1"></a></span>
<span id="cb223-3"><a href="cont-int.html#cb223-3" tabindex="-1"></a>mu<span class="fl">.1</span> <span class="ot">&lt;-</span> polynomial <span class="sc">%*%</span> beta<span class="fl">.1</span></span>
<span id="cb223-4"><a href="cont-int.html#cb223-4" tabindex="-1"></a>sd<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(units<span class="fl">.1</span> <span class="sc">+</span> <span class="fu">diag</span>(polynomial[, <span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> VCV<span class="fl">.1</span> <span class="sc">%*%</span> <span class="fu">t</span>(polynomial[,</span>
<span id="cb223-5"><a href="cont-int.html#cb223-5" tabindex="-1"></a>    <span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])))</span>
<span id="cb223-6"><a href="cont-int.html#cb223-6" tabindex="-1"></a><span class="fu">lines</span>(mu<span class="fl">.1</span> <span class="sc">~</span> pos.time)</span>
<span id="cb223-7"><a href="cont-int.html#cb223-7" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">I</span>(mu<span class="fl">.1</span> <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd<span class="fl">.1</span>) <span class="sc">~</span> pos.time, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb223-8"><a href="cont-int.html#cb223-8" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">I</span>(mu<span class="fl">.1</span> <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd<span class="fl">.1</span>) <span class="sc">~</span> pos.time, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="_bookdown_files/fig/VCVpred.1-1.png" alt="Chick weights plotted as a function of time. 95\% of the data are expected to fall within the dashed lines assuming the model with random intercepts is the correct model, and the diet treatments have small effects." width="672" />
<p class="caption">
(#fig:VCVpred.1)Chick weights plotted as a function of time. 95% of the data are expected to fall within the dashed lines assuming the model with random intercepts is the correct model, and the diet treatments have small effects.
</p>
</div>
<p>The simple model, without a slope term has constant variance across the range, and is clearly inconsistent with the data (Figure @ref(fig:VCVpred.1). The second model on the other hand</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="cont-int.html#cb224-1" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> Time, <span class="at">data =</span> ChickWeight)</span>
<span id="cb224-2"><a href="cont-int.html#cb224-2" tabindex="-1"></a></span>
<span id="cb224-3"><a href="cont-int.html#cb224-3" tabindex="-1"></a>mu<span class="fl">.2</span> <span class="ot">&lt;-</span> polynomial <span class="sc">%*%</span> beta<span class="fl">.2</span></span>
<span id="cb224-4"><a href="cont-int.html#cb224-4" tabindex="-1"></a>sd<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(units<span class="fl">.2</span> <span class="sc">+</span> <span class="fu">diag</span>(polynomial[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> VCV<span class="fl">.2</span> <span class="sc">%*%</span> <span class="fu">t</span>(polynomial[,</span>
<span id="cb224-5"><a href="cont-int.html#cb224-5" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])))</span>
<span id="cb224-6"><a href="cont-int.html#cb224-6" tabindex="-1"></a></span>
<span id="cb224-7"><a href="cont-int.html#cb224-7" tabindex="-1"></a><span class="fu">lines</span>(mu<span class="fl">.2</span> <span class="sc">~</span> pos.time)</span>
<span id="cb224-8"><a href="cont-int.html#cb224-8" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">I</span>(mu<span class="fl">.2</span> <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd<span class="fl">.2</span>) <span class="sc">~</span> pos.time, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb224-9"><a href="cont-int.html#cb224-9" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">I</span>(mu<span class="fl">.2</span> <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd<span class="fl">.2</span>) <span class="sc">~</span> pos.time, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="_bookdown_files/fig/VCVpred.2-1.png" alt="Chick weights plotted as a function of time. 95\% of the data are expected to fall within the dashed lines assuming the model with random intercepts and slopes is the correct model, and the diet treatments have small effects." width="672" />
<p class="caption">
(#fig:VCVpred.2)Chick weights plotted as a function of time. 95% of the data are expected to fall within the dashed lines assuming the model with random intercepts and slopes is the correct model, and the diet treatments have small effects.
</p>
</div>
<p>has an expected variance structure reasonably close to that observed (Figure @ref(fig:VCVpred.2)). The highest order model, which was the best using information criteria such as AIC an DIC, also does badly (Figure @ref(fig:VCVpred.3)):</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="cont-int.html#cb225-1" tabindex="-1"></a><span class="fu">plot</span>(weight <span class="sc">~</span> Time, <span class="at">data =</span> ChickWeight, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">150</span>, <span class="dv">600</span>))</span>
<span id="cb225-2"><a href="cont-int.html#cb225-2" tabindex="-1"></a>mu<span class="fl">.3</span> <span class="ot">&lt;-</span> polynomial <span class="sc">%*%</span> beta<span class="fl">.3</span></span>
<span id="cb225-3"><a href="cont-int.html#cb225-3" tabindex="-1"></a>sd<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(units<span class="fl">.3</span> <span class="sc">+</span> <span class="fu">diag</span>(polynomial[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> VCV<span class="fl">.3</span> <span class="sc">%*%</span> <span class="fu">t</span>(polynomial[,</span>
<span id="cb225-4"><a href="cont-int.html#cb225-4" tabindex="-1"></a>    <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])))</span>
<span id="cb225-5"><a href="cont-int.html#cb225-5" tabindex="-1"></a></span>
<span id="cb225-6"><a href="cont-int.html#cb225-6" tabindex="-1"></a><span class="fu">lines</span>(mu<span class="fl">.3</span> <span class="sc">~</span> pos.time)</span>
<span id="cb225-7"><a href="cont-int.html#cb225-7" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">I</span>(mu<span class="fl">.3</span> <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd<span class="fl">.3</span>) <span class="sc">~</span> pos.time, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb225-8"><a href="cont-int.html#cb225-8" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">I</span>(mu<span class="fl">.3</span> <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd<span class="fl">.3</span>) <span class="sc">~</span> pos.time, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="_bookdown_files/fig/VCVpred.3-1.png" alt="Chick weights plotted as a function of time. 95\% of the data are expected to fall within the dashed lines assuming the model with random intercepts, slopes and quadratic effects is the correct model, and the diet treatments have small effects." width="672" />
<p class="caption">
(#fig:VCVpred.3)Chick weights plotted as a function of time. 95% of the data are expected to fall within the dashed lines assuming the model with random intercepts, slopes and quadratic effects is the correct model, and the diet treatments have small effects.
</p>
</div>
<p>In general, I would not draw conclusions about changes in variance from random regression models <span class="citation">(<a href="#ref-Pletcher.1999a">Pletcher and Geyer 1999</a>)</span>.</p>
</div>
<div id="RRcentering" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> <code>us</code> versus <code>idh</code> and mean centering<a href="cont-int.html#RRcentering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>bad<br />
reparametersitaion<br />
</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="cont-int.html#cb226-1" tabindex="-1"></a>prior.m4b<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fl">1e-07</span>, <span class="at">nu =</span> <span class="sc">-</span><span class="dv">2</span>), <span class="at">G =</span> <span class="fu">list</span>(<span class="at">G1 =</span> <span class="fu">list</span>(<span class="at">V =</span> <span class="fu">diag</span>(<span class="dv">2</span>),</span>
<span id="cb226-2"><a href="cont-int.html#cb226-2" tabindex="-1"></a>    <span class="at">nu =</span> <span class="dv">2</span>)))</span>
<span id="cb226-3"><a href="cont-int.html#cb226-3" tabindex="-1"></a>m4b<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> <span class="fu">poly</span>(Time, <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">I</span>(Time <span class="sc">-</span></span>
<span id="cb226-4"><a href="cont-int.html#cb226-4" tabindex="-1"></a>    <span class="dv">3</span>))<span class="sc">:</span>Chick, <span class="at">data =</span> ChickWeight, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.m4b<span class="fl">.1</span>, <span class="at">saveX =</span> <span class="cn">TRUE</span>,</span>
<span id="cb226-5"><a href="cont-int.html#cb226-5" tabindex="-1"></a>    <span class="at">saveZ =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="meta-sec" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Meta-analysis<a href="cont-int.html#meta-sec" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Random intercept-slope models implicitly assume that the variance changes as a quadratic function of the predictor. This can be used to our advantage because it allows us to fit meta-analytic models. In meta-analysis the data are usually some standardised statistic which has been estimated with different levels of measurement error. If we wanted to know the expected value of these statistics we would want to weight our answer to those measurements made with the smallest amount of error. If we assume that measurement error around the true value is normally distributed then we could assume the model:</p>
<p><span class="math display">\[y_{i} = \beta_{1} + m_{i} +e _{i}\]</span></p>
<p>where <span class="math inline">\(\beta_{1}\)</span> is the expected value, <span class="math inline">\(m_{i}\)</span> is some deviation due to measurement error, and <span class="math inline">\(e_{i}\)</span> is the deviation of the statistic from the global intercept not due to measurement error. Some types of meta-analysis presume <span class="math inline">\(e_{i}\)</span> does not exist and that the only variation between studies is due to measurement error. This is not realistic, I think. Often, standard errors are reported in the literature, and these can be viewed as an approximation to the expected standard deviation of the measurement error. If we put the standard errors for each statistic as a column in the data frame (and call it <code>SE</code>) then the random term <code>idh(SE):units</code> defines a diagonal matrix with the standard errors on the diagonal. Using results from Equation <a href="cont-int.html#eq:RRvar-eq">(6.1)</a></p>
<p><span class="math display">\[\begin{array}{rl}
\textrm{VAR}[{\bf m}] =&amp; {\bf Z}{\bf V}{\bf Z}^{&#39;}\\
               =&amp; {\bf Z}\sigma^{2}_{m}{\bf I}{\bf Z}^{&#39;}\\
               =&amp; \sigma^{2}_{m}{\bf Z}{\bf Z}^{&#39;}\\                               
\end{array}\]</span></p>
<p>fixing <span class="math inline">\(\sigma^{2}_{m}=1\)</span> in the prior, the expected variance in the measurement errors are therefore the standard errors squared (the sampling variance) and all measurement errors are assumed to be independent of each other. The random regression therefore fits a random effect meta-analysis.</p>
</div>
<div id="splines" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Splines<a href="cont-int.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>blah blah</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="cont-int.html#cb227-1" tabindex="-1"></a>random <span class="ot">=</span> <span class="er">~</span><span class="fu">idv</span>(<span class="fu">spl</span>(covariate))</span></code></pre></div>
<p>fits a penalised thin-plate spline,</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="cont-int.html#cb228-1" tabindex="-1"></a>random <span class="ot">=</span> <span class="er">~</span><span class="fu">idv</span>(<span class="fu">smspline</span>(covariate))</span></code></pre></div>
<p>fits a penalised cubic spline. The coefficients are random effects, stored in the <code>Sol</code> element of the model output and the single variance component (the penalising bit) is in the <code>VCV</code> element. Its usually a good idea to scale the covariate to lie in the interval [0,1] or some such thing.</p>

</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Pletcher.1999a" class="csl-entry">
Pletcher, S. D., and C. J. Geyer. 1999. <span>“The Genetic Analysis of Age-Dependent Traits: Modeling the Character Process.”</span> <em>Genetics</em> 153 (2): 825–35.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cat-int.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multi.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["MCMCglmm-course-notes.pdf", "MCMCglmm-course-notes.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
