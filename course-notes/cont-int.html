<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Continuous Random Interactions | MCMCglmm Course Notes</title>
  <meta name="description" content="Extended documentation and course notes for the MCMCglmm R package." />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Continuous Random Interactions | MCMCglmm Course Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Extended documentation and course notes for the MCMCglmm R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Continuous Random Interactions | MCMCglmm Course Notes" />
  
  <meta name="twitter:description" content="Extended documentation and course notes for the MCMCglmm R package." />
  

<meta name="author" content="Jarrod Hadfield" />


<meta name="date" content="2026-01-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cat-int.html"/>
<link rel="next" href="multi.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/rglWebGL-binding-1.3.31/rglWebGL.js"></script>
<link href="libs/rglwidgetClass-1.3.31/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-1.3.31/rglClass.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/utils.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/buffer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/subscenes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/shaders.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/shadersrc.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/textures.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/projection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/mouse.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/init.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/pieces.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/draw.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/controls.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/selection.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/rglTimer.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/pretty.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/axes.src.js"></script>
<script src="libs/rglwidgetClass-1.3.31/animation.src.js"></script>
<script src="libs/CanvasMatrix4-1.3.31/CanvasMatrix.src.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bayesian.html"><a href="bayesian.html"><i class="fa fa-check"></i><b>2</b> Bayesian Analysis and MCMC</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian.html"><a href="bayesian.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="bayesian.html"><a href="bayesian.html#likelihood"><i class="fa fa-check"></i><b>2.2</b> Likelihood</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="bayesian.html"><a href="bayesian.html#maximum-likelihood-ml"><i class="fa fa-check"></i><b>2.2.1</b> Maximum Likelihood (ML)</a></li>
<li class="chapter" data-level="2.2.2" data-path="bayesian.html"><a href="bayesian.html#restricted-maximum-likelihood-reml"><i class="fa fa-check"></i><b>2.2.2</b> Restricted Maximum Likelihood (REML)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bayesian.html"><a href="bayesian.html#prior-distribution"><i class="fa fa-check"></i><b>2.3</b> Prior Distribution</a></li>
<li class="chapter" data-level="2.4" data-path="bayesian.html"><a href="bayesian.html#posterior-distribution"><i class="fa fa-check"></i><b>2.4</b> Posterior Distribution</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="bayesian.html"><a href="bayesian.html#marginal-posterior-distribution"><i class="fa fa-check"></i><b>2.4.1</b> Marginal Posterior Distribution</a></li>
<li class="chapter" data-level="2.4.2" data-path="bayesian.html"><a href="bayesian.html#intervals-sec"><i class="fa fa-check"></i><b>2.4.2</b> Credible Intervals</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="bayesian.html"><a href="bayesian.html#MCMC"><i class="fa fa-check"></i><b>2.5</b> MCMC</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="bayesian.html"><a href="bayesian.html#starting-values"><i class="fa fa-check"></i><b>2.5.1</b> Starting values</a></li>
<li class="chapter" data-level="2.5.2" data-path="bayesian.html"><a href="bayesian.html#metropolis-hastings-updates"><i class="fa fa-check"></i><b>2.5.2</b> Metropolis-Hastings updates</a></li>
<li class="chapter" data-level="2.5.3" data-path="bayesian.html"><a href="bayesian.html#gibbs-sampling"><i class="fa fa-check"></i><b>2.5.3</b> Gibbs Sampling</a></li>
<li class="chapter" data-level="2.5.4" data-path="bayesian.html"><a href="bayesian.html#diagnostics-sec"><i class="fa fa-check"></i><b>2.5.4</b> MCMC Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="bayesian.html"><a href="bayesian.html#Vprior-sec"><i class="fa fa-check"></i><b>2.6</b> Priors for Residual Variances</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="bayesian.html"><a href="bayesian.html#IP-sec"><i class="fa fa-check"></i><b>2.6.1</b> Improper Priors</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="bayesian.html"><a href="bayesian.html#transform-sec"><i class="fa fa-check"></i><b>2.7</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>3</b> Linear and Generalised Linear Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="glm.html"><a href="glm.html#linear-model-lm"><i class="fa fa-check"></i><b>3.1</b> Linear Model (LM)</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="glm.html"><a href="glm.html#lm-sec"><i class="fa fa-check"></i><b>3.1.1</b> Linear Predictors</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="glm.html"><a href="glm.html#generalised-linear-model-glm"><i class="fa fa-check"></i><b>3.2</b> Generalised Linear Model (GLM)</a></li>
<li class="chapter" data-level="3.3" data-path="glm.html"><a href="glm.html#poisson-glm"><i class="fa fa-check"></i><b>3.3</b> Poisson GLM</a></li>
<li class="chapter" data-level="3.4" data-path="glm.html"><a href="glm.html#overdispersion"><i class="fa fa-check"></i><b>3.4</b> Overdispersion</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="glm.html"><a href="glm.html#multiplicative-overdispersion"><i class="fa fa-check"></i><b>3.4.1</b> Multiplicative Overdispersion</a></li>
<li class="chapter" data-level="3.4.2" data-path="glm.html"><a href="glm.html#addod-sec"><i class="fa fa-check"></i><b>3.4.2</b> Additive Overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="glm.html"><a href="glm.html#prediction-in-glm"><i class="fa fa-check"></i><b>3.5</b> Prediction in GLM</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="glm.html"><a href="glm.html#posterior-predictive-distribution"><i class="fa fa-check"></i><b>3.5.1</b> Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="glm.html"><a href="glm.html#binom-sec"><i class="fa fa-check"></i><b>3.6</b> Binomial and Bernoulli GLM</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="glm.html"><a href="glm.html#overdispersion-1"><i class="fa fa-check"></i><b>3.6.1</b> Overdispersion</a></li>
<li class="chapter" data-level="3.6.2" data-path="glm.html"><a href="glm.html#binom-pred-sec"><i class="fa fa-check"></i><b>3.6.2</b> Prediction</a></li>
<li class="chapter" data-level="3.6.3" data-path="glm.html"><a href="glm.html#bernoulli-sec"><i class="fa fa-check"></i><b>3.6.3</b> Bernoulli GLM</a></li>
<li class="chapter" data-level="3.6.4" data-path="glm.html"><a href="glm.html#probit-link"><i class="fa fa-check"></i><b>3.6.4</b> Probit link</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="glm.html"><a href="glm.html#ordinal-data"><i class="fa fa-check"></i><b>3.7</b> Ordinal Data</a></li>
<li class="chapter" data-level="3.8" data-path="glm.html"><a href="glm.html#non-zero-binomial-data"><i class="fa fa-check"></i><b>3.8</b> Non-zero Binomial Data</a></li>
<li class="chapter" data-level="3.9" data-path="glm.html"><a href="glm.html#complete-separation"><i class="fa fa-check"></i><b>3.9</b> Complete Separation</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="glm.html"><a href="glm.html#gelman-prior-sec"><i class="fa fa-check"></i><b>3.9.1</b> The <span class="citation">Gelman, Jakulin, et al. (2008)</span> prior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ranef.html"><a href="ranef.html"><i class="fa fa-check"></i><b>4</b> Random effects</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ranef.html"><a href="ranef.html#GLMM"><i class="fa fa-check"></i><b>4.1</b> Generalised Linear Mixed Model (GLMM)</a></li>
<li class="chapter" data-level="4.2" data-path="ranef.html"><a href="ranef.html#ranpred-sec"><i class="fa fa-check"></i><b>4.2</b> Prediction with Random Effects</a></li>
<li class="chapter" data-level="4.3" data-path="ranef.html"><a href="ranef.html#overdispersed-binomial-as-a-bernoulli-glmm"><i class="fa fa-check"></i><b>4.3</b> Overdispersed Binomial as a Bernoulli GLMM</a></li>
<li class="chapter" data-level="4.4" data-path="ranef.html"><a href="ranef.html#ICC"><i class="fa fa-check"></i><b>4.4</b> Intra-class Correlations</a></li>
<li class="chapter" data-level="4.5" data-path="ranef.html"><a href="ranef.html#PXprior-sec"><i class="fa fa-check"></i><b>4.5</b> Priors for Random Effect Variances</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="ranef.html"><a href="ranef.html#f-and-folded-t-priors"><i class="fa fa-check"></i><b>4.5.1</b> <span class="math inline">\(F\)</span> and folded-<span class="math inline">\(t\)</span> priors</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ranef.html"><a href="ranef.html#Vprior-gen-sec"><i class="fa fa-check"></i><b>4.6</b> Prior Generators</a></li>
<li class="chapter" data-level="4.7" data-path="ranef.html"><a href="ranef.html#priors-on-functions-of-variances"><i class="fa fa-check"></i><b>4.7</b> Priors on Functions of Variances</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="ranef.html"><a href="ranef.html#intra-class-correlation"><i class="fa fa-check"></i><b>4.7.1</b> Intra-class Correlation</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ranef.html"><a href="ranef.html#fix-or-rand"><i class="fa fa-check"></i><b>4.8</b> Fixed or Random?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cat-int.html"><a href="cat-int.html"><i class="fa fa-check"></i><b>5</b> Categorical Random Interactions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cat-int.html"><a href="cat-int.html#vstruct-sec"><i class="fa fa-check"></i><b>5.1</b> Variance Structures</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cat-int.html"><a href="cat-int.html#textttidh-variance-structure"><i class="fa fa-check"></i><b>5.1.1</b> <span class="math inline">\(\texttt{idh}\)</span> Variance Structure</a></li>
<li class="chapter" data-level="5.1.2" data-path="cat-int.html"><a href="cat-int.html#us-sec"><i class="fa fa-check"></i><b>5.1.2</b> <span class="math inline">\(\texttt{us}\)</span> Variance Structure</a></li>
<li class="chapter" data-level="5.1.3" data-path="cat-int.html"><a href="cat-int.html#other-variance-structures"><i class="fa fa-check"></i><b>5.1.3</b> Other Variance Structures</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="cat-int.html"><a href="cat-int.html#linking-functions"><i class="fa fa-check"></i><b>5.2</b> Linking Functions</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="cat-int.html"><a href="cat-int.html#textttstr-covariances-between-random-terms"><i class="fa fa-check"></i><b>5.2.1</b> <span class="math inline">\(\texttt{str}\)</span>: covariances between random terms</a></li>
<li class="chapter" data-level="5.2.2" data-path="cat-int.html"><a href="cat-int.html#multim-sec"><i class="fa fa-check"></i><b>5.2.2</b> <span class="math inline">\(\texttt{mm}\)</span>: multi-membership models</a></li>
<li class="chapter" data-level="5.2.3" data-path="cat-int.html"><a href="cat-int.html#textttcovu-covariances-between-random-and-residual-terms"><i class="fa fa-check"></i><b>5.2.3</b> <span class="math inline">\(\texttt{covu}\)</span>: covariances between random and residual terms</a></li>
<li class="chapter" data-level="5.2.4" data-path="cat-int.html"><a href="cat-int.html#texttttheta_scale-scaled-linear-predictor"><i class="fa fa-check"></i><b>5.2.4</b> <span class="math inline">\(\texttt{theta_scale}\)</span>: scaled linear predictor</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="cat-int.html"><a href="cat-int.html#VCVprior-sec"><i class="fa fa-check"></i><b>5.3</b> Priors for Covariance Matrices</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="cat-int.html"><a href="cat-int.html#marginal-priors-for-variances"><i class="fa fa-check"></i><b>5.3.1</b> Marginal Priors for Variances</a></li>
<li class="chapter" data-level="5.3.2" data-path="cat-int.html"><a href="cat-int.html#VCVprior-r-sec"><i class="fa fa-check"></i><b>5.3.2</b> Marginal Priors for Covariances and Correlations</a></li>
<li class="chapter" data-level="5.3.3" data-path="cat-int.html"><a href="cat-int.html#full-joint-prior"><i class="fa fa-check"></i><b>5.3.3</b> Full joint prior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cont-int.html"><a href="cont-int.html"><i class="fa fa-check"></i><b>6</b> Continuous Random Interactions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cont-int.html"><a href="cont-int.html#random-regression"><i class="fa fa-check"></i><b>6.1</b> Random Regression</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cont-int.html"><a href="cont-int.html#RRcentering"><i class="fa fa-check"></i><b>6.1.1</b> Mean centring</a></li>
<li class="chapter" data-level="6.1.2" data-path="cont-int.html"><a href="cont-int.html#expected-variances-and-covariances"><i class="fa fa-check"></i><b>6.1.2</b> Expected Variances and Covariances</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cont-int.html"><a href="cont-int.html#user-defined-sec"><i class="fa fa-check"></i><b>6.2</b> User-defined Design Matrices</a></li>
<li class="chapter" data-level="6.3" data-path="cont-int.html"><a href="cont-int.html#splines"><i class="fa fa-check"></i><b>6.3</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multi.html"><a href="multi.html"><i class="fa fa-check"></i><b>7</b> Multi-response models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="multi.html"><a href="multi.html#relaxing-the-univariate-assumptions-of-causality"><i class="fa fa-check"></i><b>7.1</b> Relaxing the univariate assumptions of causality</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="multi.html"><a href="multi.html#textttcovu-covariances-between-random-and-residual-terms-1"><i class="fa fa-check"></i><b>7.1.1</b> <span class="math inline">\(\texttt{covu}\)</span>: covariances between random and residual terms</a></li>
<li class="chapter" data-level="7.1.2" data-path="multi.html"><a href="multi.html#texttttheta_scale-scaled-linear-predictor-1"><i class="fa fa-check"></i><b>7.1.2</b> <span class="math inline">\(\texttt{theta_scale}\)</span>: scaled linear predictor</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="multi.html"><a href="multi.html#multinomial-models"><i class="fa fa-check"></i><b>7.2</b> Multinomial Models</a></li>
<li class="chapter" data-level="7.3" data-path="multi.html"><a href="multi.html#zero-inflated-models"><i class="fa fa-check"></i><b>7.3</b> Zero-inflated Models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="multi.html"><a href="multi.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>7.3.1</b> Posterior predictive checks</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="multi.html"><a href="multi.html#Hurdle"><i class="fa fa-check"></i><b>7.4</b> Hurdle Models</a></li>
<li class="chapter" data-level="7.5" data-path="multi.html"><a href="multi.html#ZAP"><i class="fa fa-check"></i><b>7.5</b> Zero-altered Models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pedigree.html"><a href="pedigree.html"><i class="fa fa-check"></i><b>8</b> Pedigrees and Phylogenies</a>
<ul>
<li class="chapter" data-level="8.1" data-path="pedigree.html"><a href="pedigree.html#pedigree-and-phylogeny-formats"><i class="fa fa-check"></i><b>8.1</b> Pedigree and phylogeny formats</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="pedigree.html"><a href="pedigree.html#pedigrees"><i class="fa fa-check"></i><b>8.1.1</b> Pedigrees</a></li>
<li class="chapter" data-level="8.1.2" data-path="pedigree.html"><a href="pedigree.html#phylogenies"><i class="fa fa-check"></i><b>8.1.2</b> Phylogenies</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="pedigree.html"><a href="pedigree.html#the-animal-model-and-the-phylogenetic-mixed-model"><i class="fa fa-check"></i><b>8.2</b> The animal model and the phylogenetic mixed model</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="measurement.html"><a href="measurement.html"><i class="fa fa-check"></i><b>9</b> Measurement Error, Meta-analysis an Missing Values</a>
<ul>
<li class="chapter" data-level="9.1" data-path="measurement.html"><a href="measurement.html#error-in-the-response"><i class="fa fa-check"></i><b>9.1</b> Error in the Response</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="measurement.html"><a href="measurement.html#meta-sec"><i class="fa fa-check"></i><b>9.1.1</b> Meta-analysis</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="measurement.html"><a href="measurement.html#error-in-the-predictors"><i class="fa fa-check"></i><b>9.2</b> Error in the Predictors</a></li>
<li class="chapter" data-level="9.3" data-path="measurement.html"><a href="measurement.html#missing-values"><i class="fa fa-check"></i><b>9.3</b> Missing Values</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="path.html"><a href="path.html"><i class="fa fa-check"></i><b>10</b> Path Analysis &amp; Antedependence Structures</a>
<ul>
<li class="chapter" data-level="10.1" data-path="path.html"><a href="path.html#path-anlaysis"><i class="fa fa-check"></i><b>10.1</b> Path Anlaysis</a></li>
<li class="chapter" data-level="10.2" data-path="path.html"><a href="path.html#ante-sec"><i class="fa fa-check"></i><b>10.2</b> Antedependence</a></li>
<li class="chapter" data-level="10.3" data-path="path.html"><a href="path.html#scaling"><i class="fa fa-check"></i><b>10.3</b> Scaling</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="technical-details.html"><a href="technical-details.html"><i class="fa fa-check"></i><b>11</b> Technical Details</a>
<ul>
<li class="chapter" data-level="11.1" data-path="technical-details.html"><a href="technical-details.html#model-form"><i class="fa fa-check"></i><b>11.1</b> Model Form</a></li>
<li class="chapter" data-level="11.2" data-path="technical-details.html"><a href="technical-details.html#MCMC-app"><i class="fa fa-check"></i><b>11.2</b> MCMC Sampling Schemes</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="technical-details.html"><a href="technical-details.html#updating-the-latent-variables-bf-l"><i class="fa fa-check"></i><b>11.2.1</b> Updating the latent variables <span class="math inline">\({\bf l}\)</span></a></li>
<li class="chapter" data-level="11.2.2" data-path="technical-details.html"><a href="technical-details.html#updating-the-location-vector-boldsymboltheta-leftboldsymbolmathbfbeta-bf-uright"><i class="fa fa-check"></i><b>11.2.2</b> Updating the location vector <span class="math inline">\(\boldsymbol{\theta} = \left[{\boldsymbol{\mathbf{\beta}}}^{&#39;}\; {\bf u}^{&#39;}\right]^{&#39;}\)</span></a></li>
<li class="chapter" data-level="11.2.3" data-path="technical-details.html"><a href="technical-details.html#updating-the-variance-structures-bf-g-and-bf-r"><i class="fa fa-check"></i><b>11.2.3</b> Updating the variance structures <span class="math inline">\({\bf G}\)</span> and <span class="math inline">\({\bf R}\)</span></a></li>
<li class="chapter" data-level="11.2.4" data-path="technical-details.html"><a href="technical-details.html#ordinal-models"><i class="fa fa-check"></i><b>11.2.4</b> Ordinal Models</a></li>
<li class="chapter" data-level="11.2.5" data-path="technical-details.html"><a href="technical-details.html#path-analyses"><i class="fa fa-check"></i><b>11.2.5</b> Path Analyses</a></li>
<li class="chapter" data-level="11.2.6" data-path="technical-details.html"><a href="technical-details.html#deviance-and-dic"><i class="fa fa-check"></i><b>11.2.6</b> Deviance and DIC</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="technical-details.html"><a href="technical-details.html#parameter-expansion"><i class="fa fa-check"></i><b>11.3</b> Parameter Expansion</a></li>
<li class="chapter" data-level="11.4" data-path="technical-details.html"><a href="technical-details.html#priors-for-corg-and-corgh-structures"><i class="fa fa-check"></i><b>11.4</b> Priors for <code>corg</code> and <code>corgh</code> structures</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MCMCglmm Course Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cont-int" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Continuous Random Interactions<a href="cont-int.html#cont-int" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In Chapter <a href="cat-int.html#cat-int">5</a> we saw how we could define a linear model within a variance function and then interact these terms with a random effect. In the example, we did this in order to fit a <span class="math inline">\(\texttt{virus}\)</span> by <span class="math inline">\(\texttt{line}\)</span> interaction: <code>~us(virus):line</code>. Since the variance function model involved a categorical predictor and the intercept is omitted by default, it is not really necessary to engage with the fact that the variance function is taking a model formula. Most users familiar with covariance matrices will be happy that <code>~us(virus):line</code> specifies the covariance matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{line}}}}=
\left[
\begin{array}{ccc}
\sigma^{2}_{\color{blue}{\texttt{France}}}&amp;\sigma_{\color{blue}{\texttt{France}, \texttt{Spain}}}&amp;\sigma_{\color{blue}{\texttt{France}, \texttt{Greece}}}\\
\sigma_{\color{blue}{\texttt{France}, \texttt{Spain}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Spain}}}&amp;\sigma_{\color{blue}{\texttt{Spain}, \texttt{Greece}}}\\
\sigma_{\color{blue}{\texttt{France}, \texttt{Greece}}}&amp;\sigma_{\color{blue}{\texttt{Spain}, \texttt{Greece}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Greece}}}\\
\end{array}
\right]\]</span></p>
<p>However, we are also free to define the variance function model with continuous covariates, or even a mixture of continuous and categorical factors. Although the resulting covariance matrix is interpreted in the same way it can be less intuitive.</p>
<div id="random-regression" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Random Regression<a href="cont-int.html#random-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As an example, we’ll use a longitudinal data set on chicken growth (See Figure <a href="cont-int.html#fig:ChickWeight">6.1</a>):</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="cont-int.html#cb199-1" tabindex="-1"></a><span class="fu">data</span>(ChickWeight)</span>
<span id="cb199-2"><a href="cont-int.html#cb199-2" tabindex="-1"></a><span class="fu">head</span>(ChickWeight)</span></code></pre></div>
<pre><code>## Grouped Data: weight ~ Time | Chick
##   weight Time Chick Diet
## 1     42    0     1    1
## 2     51    2     1    1
## 3     59    4     1    1
## 4     64    6     1    1
## 5     76    8     1    1
## 6     93   10     1    1</code></pre>
<p>The data consist of body weights (<code>weight</code>) for 50 chicks (<code>Chick</code>) measured up to 12 times over a 3 week period. The variable <code>Time</code> is the number of days since hatching, and <code>Diet</code> is a four level factor indicating the type of protein diet the chicks received. The data are plotted in Figure <a href="cont-int.html#fig:ChickWeight">6.1</a>.</p>
<div class="figure"><span style="display:block;" id="fig:ChickWeight"></span>
<img src="_bookdown_files/fig/ChickWeight-1.png" alt="Weight data of 50 chicks from hatching until three weeks old." width="672" />
<p class="caption">
Figure 6.1: Weight data of 50 chicks from hatching until three weeks old.
</p>
</div>
<p>Growth curves tend to be sigmoidal and so one of the non-linear growth curves such as the Gompertz or logistic may fit the data well. However, these can be tricky to use and an alternative is to try and capture the form of the curve using polynomials. We’ll start with a quadratic function at the population level and and fit chick as a random term.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="cont-int.html#cb201-1" tabindex="-1"></a>prior.weight <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">IW</span>(<span class="dv">1</span>, <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">F</span>(<span class="dv">2</span>, <span class="dv">10000</span>))</span>
<span id="cb201-2"><a href="cont-int.html#cb201-2" tabindex="-1"></a></span>
<span id="cb201-3"><a href="cont-int.html#cb201-3" tabindex="-1"></a>mweight<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>), <span class="at">random =</span> <span class="sc">~</span>Chick, <span class="at">data =</span> ChickWeight,</span>
<span id="cb201-4"><a href="cont-int.html#cb201-4" tabindex="-1"></a>    <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight)</span>
<span id="cb201-5"><a href="cont-int.html#cb201-5" tabindex="-1"></a></span>
<span id="cb201-6"><a href="cont-int.html#cb201-6" tabindex="-1"></a><span class="fu">summary</span>(mweight<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 3001:12991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 5525.508 
## 
##  G-structure:  ~Chick
## 
##       post.mean l-95% CI u-95% CI eff.samp
## Chick     570.2    336.7    835.4     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     764.8    677.6    863.1     1000
## 
##  Location effects: weight ~ Diet + Time + I(Time^2) 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)  21.27344  7.94378 32.32329     1000 &lt;0.001 ***
## Diet2        16.45051 -0.91746 36.47284     1000  0.082 .  
## Diet3        37.18376 20.15287 57.24728     1000  0.002 ** 
## Diet4        30.57343 11.83705 50.51496     1000  0.006 ** 
## Time          5.47621  4.26819  6.89114     1000 &lt;0.001 ***
## I(Time^2)     0.15234  0.09544  0.21106     1095 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Note that I have specified the prior using a prior generator function (Sections <a href="bayesian.html#Vprior-sec">2.6</a> and <a href="cat-int.html#VCVprior-sec">5.3</a>) but I’ve upped the scale to 10,000 from the usual 1,000 because of the scale of the data (in fact it makes almost no difference).</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="cont-int.html#cb203-1" tabindex="-1"></a><span class="fu">summary</span>(mweight<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 3001:12991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 5525.508 
## 
##  G-structure:  ~Chick
## 
##       post.mean l-95% CI u-95% CI eff.samp
## Chick     570.2    336.7    835.4     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units     764.8    677.6    863.1     1000
## 
##  Location effects: weight ~ Diet + Time + I(Time^2) 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)  21.27344  7.94378 32.32329     1000 &lt;0.001 ***
## Diet2        16.45051 -0.91746 36.47284     1000  0.082 .  
## Diet3        37.18376 20.15287 57.24728     1000  0.002 ** 
## Diet4        30.57343 11.83705 50.51496     1000  0.006 ** 
## Time          5.47621  4.26819  6.89114     1000 &lt;0.001 ***
## I(Time^2)     0.15234  0.09544  0.21106     1095 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Since we saved the random chick effects (<code>pr=TRUE</code>) we can obtain the predictions for each bird by specifying <code>marginal=NULL</code> (Section <a href="ranef.html#ranpred-sec">4.2</a>):</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="cont-int.html#cb205-1" tabindex="-1"></a>pweight <span class="ot">&lt;-</span> <span class="fu">predict</span>(mweight<span class="fl">.1</span>, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>and we can add them to the <span class="math inline">\(\texttt{xyplot}\)</span> plot (Figure <a href="cont-int.html#fig:CWpred-1">6.2</a>).</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="cont-int.html#cb206-1" tabindex="-1"></a><span class="fu">xyplot</span>(weight <span class="sc">+</span> pweight <span class="sc">~</span> Time <span class="sc">|</span> Chick, <span class="at">data =</span> ChickWeight, <span class="at">distribute.type =</span> <span class="cn">TRUE</span>,</span>
<span id="cb206-2"><a href="cont-int.html#cb206-2" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;l&quot;</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CWpred-1"></span>
<img src="_bookdown_files/fig/CWpred-1-1.png" alt="Weights of each chick as a function of age in blue, with the predicted weights in orange. A quadratic population growth curve was fitted with random chick intercepts." width="672" />
<p class="caption">
Figure 6.2: Weights of each chick as a function of age in blue, with the predicted weights in orange. A quadratic population growth curve was fitted with random chick intercepts.
</p>
</div>
<p>The predictions don’t look that bad, but you will notice that for some chicks (e.g. 13,19,35) the slope of the predicted growth seems either to shallow, or too steep. Let’s think about the model more carefully. Ignoring diet for now the model for <span class="math inline">\(\texttt{Chick}\)</span> <span class="math inline">\(i\)</span> at <span class="math inline">\(\texttt{Time}\)</span> <span class="math inline">\(j\)</span> is</p>
<p><span class="math inline">\(\texttt{Weight}_{ij} = \beta_{0} + \beta_{1}\texttt{Time}_{j} + \beta_{2}\texttt{Time}^{2}_{j} + u^{(0)}_{i} + e_{ij}\)</span></p>
<p>The population growth curve is slightly convex because the quadratic term for time is positive, and the predictions for each chick are parallel to this curve. By fitting chick as a random effect we have allowed variation in the intercept only, and often this is not enough. To account for this we can start by fitting <code>us(1+time):Chick</code>. The linear model inside the variance function has two parameters, an intercept (<code>1</code>) and a regression slope associated with <code>Time</code> which define the set of interactions:</p>
<p><span class="math display">\[\begin{array}{c|rrrrrc}
&amp;{\color{red}{\texttt{Chick1}}}&amp;{\color{red}{\texttt{Chick2}}}&amp;{\color{red}{\texttt{Chick3}}}&amp;\dots\\
\hline\\
{\color{blue}{\texttt{(Intercept)}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick1}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick2}}}&amp;{\color{blue}{\texttt{(Intercept)}}}.{\color{red}{\texttt{Chick3}}}&amp;\dots\\
{\color{blue}{\texttt{Time}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick1}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick2}}}&amp;{\color{blue}{\texttt{Time}}}.{\color{red}{\texttt{Chick3}}}&amp;\dots\\
\end{array}\]</span></p>
<p>Each chick now has an intercept and a slope, and because we have used the <code>us</code> function we are estimating the <span class="math inline">\(2\times2\)</span> matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{Chick}}}}=
\left[
\begin{array}{cc}
\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}}}\\
\end{array}
\right]\]</span></p>
<p><span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}\)</span> is the amount of variation in intercepts between chicks, and <span class="math inline">\(\sigma^{2}_{\color{blue}{\texttt{Time}}}\)</span> is the amount of variation in the regression slopes between chicks. If the <code>idh</code> function had been used the covariance would have been set to zero and we could have interpreted variation in intercepts as variation in overall size, and variation in slopes as variation in growth rate. However, there is often covariance between intercepts and slopes and it is usually a good idea to use the <code>us</code> function and estimate them. We shall do so:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="cont-int.html#cb207-1" tabindex="-1"></a>mweight<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> Time <span class="sc">+</span> <span class="fu">I</span>(Time<span class="sc">^</span><span class="dv">2</span>), <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> Time)<span class="sc">:</span>Chick,</span>
<span id="cb207-2"><a href="cont-int.html#cb207-2" tabindex="-1"></a>    <span class="at">data =</span> ChickWeight, <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight)</span>
<span id="cb207-3"><a href="cont-int.html#cb207-3" tabindex="-1"></a><span class="fu">summary</span>(mweight<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
##  Iterations = 3001:12991
##  Thinning interval  = 10
##  Sample size  = 1000 
## 
##  DIC: 4543.854 
## 
##  G-structure:  ~us(1 + Time):Chick
## 
##                               post.mean l-95% CI u-95% CI eff.samp
## (Intercept):(Intercept).Chick    158.30   84.561   239.79     1000
## Time:(Intercept).Chick           -43.18  -64.961   -26.39     1000
## (Intercept):Time.Chick           -43.18  -64.961   -26.39     1000
## Time:Time.Chick                   13.77    8.555    18.98     1000
## 
##  R-structure:  ~units
## 
##       post.mean l-95% CI u-95% CI eff.samp
## units       133    115.9    149.4    979.3
## 
##  Location effects: weight ~ Diet + Time + I(Time^2) 
## 
##             post.mean l-95% CI u-95% CI eff.samp  pMCMC    
## (Intercept)   35.0741  30.1811  39.9477     1000 &lt;0.001 ***
## Diet2          2.7961  -2.7455   8.5063     1178  0.296    
## Diet3          1.7282  -3.7379   8.0472     1000  0.556    
## Diet4          8.9893   3.7404  14.7044     1000  0.004 ** 
## Time           5.7291   4.7104   6.8659     1000 &lt;0.001 ***
## I(Time^2)      0.1294   0.1073   0.1546     1000 &lt;0.001 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Again we can get the predicted weights from this model and we can see that the fit is much better (See Figure <a href="cont-int.html#fig:CWpred-2">6.3</a>).</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="cont-int.html#cb209-1" tabindex="-1"></a><span class="fu">xyplot</span>(weight <span class="sc">+</span> <span class="fu">predict</span>(mweight<span class="fl">.2</span>, <span class="at">marginal =</span> <span class="cn">NULL</span>) <span class="sc">~</span> Time <span class="sc">|</span> Chick, <span class="at">data =</span> ChickWeight,</span>
<span id="cb209-2"><a href="cont-int.html#cb209-2" tabindex="-1"></a>    <span class="at">distribute.type =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;l&quot;</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CWpred-2"></span>
<img src="_bookdown_files/fig/CWpred-2-1.png" alt="Weights of each chick as a function of age in blue, with the predicted weights in orange. A quadratic population growth curve was fitted with a first order random regression for chicks (i.e. a random intercept-slope model)." width="672" />
<p class="caption">
Figure 6.3: Weights of each chick as a function of age in blue, with the predicted weights in orange. A quadratic population growth curve was fitted with a first order random regression for chicks (i.e. a random intercept-slope model).
</p>
</div>
<p>If we write down the model for this data we have</p>
<p><span class="math inline">\(\texttt{Weight}_{ij} = \beta_{0} + \beta_{1}\texttt{Time}_{j} + \beta_{2}\texttt{Time}^{2}_{j} + u^{(0)}_{i} + u^{(1)}_{i}\texttt{Time}_{j}+e_{ij}\)</span></p>
<p>In theory we could fit higher order random regressions (data and prior permitting). For example, fitting <code>random=~us(1+Time+I(Time^2)):Chick</code> would allow the quadratic term for each Chick to deviate from the population mean and we would be estimating the <span class="math inline">\(3\times3\)</span> covariance matrix:</p>
<p><span class="math display">\[{\bf V}_{{\color{red}{\texttt{Chick}}}}=
\left[
\begin{array}{ccc}
\sigma^{2}_{\color{blue}{\texttt{(Intercept)}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time^{2}}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time}}}&amp;\sigma_{\color{blue}{\texttt{Time}, \texttt{Time^{2}}}}\\
\sigma_{\color{blue}{\texttt{(Intercept)}, \texttt{Time^2}}}&amp;\sigma_{\color{blue}{\texttt{Time}, \texttt{Time^{2}}}}&amp;\sigma^{2}_{\color{blue}{\texttt{Time^2}}}\\
\end{array}
\right]\]</span></p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="cont-int.html#cb210-1" tabindex="-1"></a><span class="fu">plot</span>(mweight<span class="fl">.2</span><span class="sc">$</span>VCV[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)], <span class="at">density =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mweight-2"></span>
<img src="_bookdown_files/fig/mweight-2-1.png" alt="MCMC trace for the chick covariance components from model \texttt{mweight.2}. The lower and upper panels are the intercept and slope variance components respectively, and the middle panel the intercept-slope covariance." width="672" />
<p class="caption">
Figure 6.4: MCMC trace for the chick covariance components from model . The lower and upper panels are the intercept and slope variance components respectively, and the middle panel the intercept-slope covariance.
</p>
</div>
<p>The traces look OKish for the chick (co)variance matrices (Figure <a href="#fig:RR2VCV"><strong>??</strong></a> but if we look at the trace for the correlation</p>
<div class="figure"><span style="display:block;" id="fig:mweight-2-r"></span>
<img src="_bookdown_files/fig/mweight-2-r-1.png" alt="MCMC summary plots for the chick covariance components from model \texttt{mweight.2}. The lower and upper plots are the intercept and slope variance components respectively, and the middle two plots are the intercept-slope covariance." width="672" />
<p class="caption">
Figure 6.5: MCMC summary plots for the chick covariance components from model . The lower and upper plots are the intercept and slope variance components respectively, and the middle two plots are the intercept-slope covariance.
</p>
</div>
<p>we see it is a lot worse and we should run it for longer in order to sample the posterior adequately. Ill-conditoned….</p>
<div id="RRcentering" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Mean centring<a href="cont-int.html#RRcentering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="cont-int.html#cb211-1" tabindex="-1"></a>ChickWeight<span class="sc">$</span>TimeC <span class="ot">&lt;-</span> ChickWeight<span class="sc">$</span>Time <span class="sc">-</span> <span class="dv">10</span></span>
<span id="cb211-2"><a href="cont-int.html#cb211-2" tabindex="-1"></a>mweight<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(weight <span class="sc">~</span> Diet <span class="sc">+</span> TimeC, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(<span class="dv">1</span> <span class="sc">+</span> TimeC)<span class="sc">:</span>Chick, <span class="at">data =</span> ChickWeight,</span>
<span id="cb211-3"><a href="cont-int.html#cb211-3" tabindex="-1"></a>    <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> prior.weight)</span></code></pre></div>
</div>
<div id="expected-variances-and-covariances" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Expected Variances and Covariances<a href="cont-int.html#expected-variances-and-covariances" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One under-appreciated facet of random regression models is that when a polynomial of order <span class="math inline">\(n\)</span> is fitted, the variance is predicted to change as a polynomial of order <span class="math inline">\(n+1\)</span>. Consequently, part of the information for estimating the random effects (e.g. slopes) may come from a mismatch between the (conditional) distribution assumed for the response and it’s actual distribution.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="cont-int.html#cb212-1" tabindex="-1"></a>Grumpy<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Grumpy<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;grumpy&quot;</span>)</span>
<span id="cb212-2"><a href="cont-int.html#cb212-2" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(y <span class="sc">~</span> type, <span class="at">random =</span> <span class="sc">~</span><span class="fu">us</span>(x)<span class="sc">:</span>photo, <span class="at">data =</span> Grumpy, <span class="at">prior =</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">IW</span>(<span class="dv">1</span>,</span>
<span id="cb212-3"><a href="cont-int.html#cb212-3" tabindex="-1"></a>    <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">IW</span>(<span class="dv">1</span>, <span class="fl">0.002</span>)))</span></code></pre></div>
<p>Conversely,</p>
</div>
</div>
<div id="user-defined-sec" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> User-defined Design Matrices<a href="cont-int.html#user-defined-sec" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math inline">\(\texttt{MCMCglmm}\)</span> generally uses <span class="math inline">\(\texttt{model.matrix}\)</span>, or a native equivalent, when evaluating a model formula to obtain the design matrices. Sometimes R formula syntax is not flexible enough to generate the appropriate design matrix. However, if a random-effect design matrix can be generated, it is possible to fit the model by exploiting the <span class="math inline">\(\texttt{idv}\)</span> variance structure. However, the parameters defined by the formula in the <span class="math inline">\(\texttt{idv}\)</span> structure should not be interacted with another factor. Consider the term <code>~idv(z1+z2+z3+z4):1</code> and let’s set up the table of random effects as we have before:</p>
<p><span class="math display">\[\begin{array}{c|c}
&amp;{\color{red}{\texttt{(Intercept)}}}\\
\hline\\
{\color{blue}{\texttt{z1}}}&amp;{\color{blue}{\texttt{z1}}}.{\color{red}{\texttt{(Intercept)}}}\\
{\color{blue}{\texttt{z2}}}&amp;{\color{blue}{\texttt{z2}}}.{\color{red}{\texttt{(Intercept)}}}\\
{\color{blue}{\texttt{z3}}}&amp;{\color{blue}{\texttt{z3}}}.{\color{red}{\texttt{(Intercept)}}}\\
{\color{blue}{\texttt{z4}}}&amp;{\color{blue}{\texttt{z4}}}.{\color{red}{\texttt{(Intercept)}}}\\
\end{array}\]</span></p>
<p>An <span class="math inline">\(\texttt{idv}\)</span> structure, like an <span class="math inline">\(\texttt{idh}\)</span> structure, assumes no correlation between effects on different rows: the <span class="math inline">\(\texttt{id}\)</span> in <span class="math inline">\(\texttt{idh}\)</span> stands for identity matrix. The <span class="math inline">\(\texttt{h}\)</span> in <span class="math inline">\(\texttt{idh}\)</span> stands for heterogeneous and so each row is allowed a different variance. Clearly, with only one effect per row estimating a variance is not feasible. However, with <span class="math inline">\(\texttt{idv}\)</span> the variances are assumed homogenous and so only a single variance (the <span class="math inline">\(\texttt{v}\)</span> in <span class="math inline">\(\texttt{idv}\)</span>) is estimated that is common to all effects. The (four) regression coefficient are then treated exactly like simple random effects: identically and independently distributed with zero mean and a variance to be estimated. When there are many random effects, writing <code>~idv(z1+z2+z3+z4+...z999+z1000):1</code> is going to be painful to write and read. However, you can simply including the design matrix as a matrix in the data-frame and fit it inside the <span class="math inline">\(\texttt{idv}\)</span> structure.</p>
<p>The multi-membership model fitted in Section <a href="cat-int.html#multim-sec">5.2.2</a> is a case in point. In that example, each child had five friends and we would like to fit <span class="math inline">\(\texttt{friend}\)</span> as a random effect that predicts the child’s well-being. We can take a look at the random effect design matrix for that model:</p>
<pre><code>##   A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
## 1 0 1 0 0 0 0 1 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0
## 2 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 1 1 0 0 0 1 0 0
## 3 1 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0
## 4 1 0 0 0 0 0 0 0 1 1 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0
## 5 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0 1 0 0
## 6 0 0 0 1 0 0 0 0 0 0 1 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>The row for each child has five ones indicating their friends. This design matrix cannot be created using a standard R formula and the multi-membership linking function <code>~mm(freind.1+freind.2+freind.3+freind.4+freind.5)</code> was used to create the design matrix. However, if we had the incidence matrix, we could place it in the data-frame and fit an identical model:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="cont-int.html#cb214-1" tabindex="-1"></a>data.friends<span class="sc">$</span>Z <span class="ot">&lt;-</span> Z</span>
<span id="cb214-2"><a href="cont-int.html#cb214-2" tabindex="-1"></a>m.mm2 <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">random =</span> <span class="sc">~</span><span class="fu">idv</span>(Z), <span class="at">data =</span> data.friends, <span class="at">prior =</span> prior.mm)</span></code></pre></div>
<p>Note that there is no need to explicitly interact the <span class="math inline">\(\texttt{idv}\)</span> structure with an intercept (in fact <span class="math inline">\(\texttt{MCMCglmm}\)</span> will complain if you try). In this example, the predictor variables (<span class="math inline">\(\texttt{freind}\)</span>) are categorical, but there is nothing to stop design matrices from being formed using continuous predictors, as we’ll see in the next section on splines.</p>
</div>
<div id="splines" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Splines<a href="cont-int.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The function <span class="math inline">\(\texttt{smspline}\)</span> in <span class="math inline">\(\texttt{lmeSplines}\)</span> can be used to generate design matrices for penalised splines that are transformed such that the random effects are expected to be identically and independently distributed with unknown variance. Using the ideas discussed above for user-specified design matrices (Section <a href="cont-int.html#user-defined-sec">6.2</a>) we can use an <span class="math inline">\(\texttt{idv}\)</span> structure to fit the spline. However, rather than generating the design matrix outside of <span class="math inline">\(\texttt{MCMCglmm}\)</span> and adding it to the data-frame, we can simply use the <span class="math inline">\(\texttt{smspline}\)</span> function inside <span class="math inline">\(\texttt{idv}\)</span>. For example, we can fit a penalised cubic spline to one of the test data sets in <span class="math inline">\(\texttt{lmeSplines}\)</span>:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="cont-int.html#cb215-1" tabindex="-1"></a>spline.prior <span class="ot">=</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="fu">IW</span>(<span class="dv">1</span>, <span class="fl">0.002</span>), <span class="at">G =</span> <span class="fu">F</span>(<span class="dv">1</span>, <span class="dv">1000</span>))</span>
<span id="cb215-2"><a href="cont-int.html#cb215-2" tabindex="-1"></a>m.spline <span class="ot">&lt;-</span> <span class="fu">MCMCglmm</span>(y <span class="sc">~</span> time, <span class="at">random =</span> <span class="sc">~</span><span class="fu">idv</span>(<span class="fu">smspline</span>(time)), <span class="at">data =</span> smSplineEx1,</span>
<span id="cb215-3"><a href="cont-int.html#cb215-3" tabindex="-1"></a>    <span class="at">pr =</span> <span class="cn">TRUE</span>, <span class="at">prior =</span> spline.prior)</span></code></pre></div>
<p>The random effects need to be saved (<code>pr=TRUE</code>) because these are the coefficients of the spline. Similarly, when making a prediction we want to include the spline coefficients in the prediction, rather than marginalising them (Section <a href="ranef.html#ranpred-sec">4.2</a>).</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="cont-int.html#cb216-1" tabindex="-1"></a>p.slpine <span class="ot">&lt;-</span> <span class="fu">predict</span>(m.spline, <span class="at">marginal =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>The model wiggles its way through the data, as splines do …</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="cont-int.html#cb217-1" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> time, <span class="at">data =</span> smSplineEx1)</span>
<span id="cb217-2"><a href="cont-int.html#cb217-2" tabindex="-1"></a><span class="fu">lines</span>(p.slpine <span class="sc">~</span> smSplineEx1<span class="sc">$</span>time)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:spline"></span>
<img src="_bookdown_files/fig/spline-1.png" alt="Data and prediction from a penalised cubic spline fitted to the example data $\texttt{smSplineEx1}$ from $\texttt{lmeSplines}$" width="672" />
<p class="caption">
Figure 6.6: Data and prediction from a penalised cubic spline fitted to the example data <span class="math inline">\(\texttt{smSplineEx1}\)</span> from <span class="math inline">\(\texttt{lmeSplines}\)</span>
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cat-int.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multi.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["MCMCglmm-course-notes.pdf", "MCMCglmm-course-notes.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
